bj_PI = 3.14159 ---@type number real constant
bj_E = 2.71828 ---@type number real constant
bj_CELLWIDTH = 128.0 ---@type number real constant
bj_CLIFFHEIGHT = 128.0 ---@type number real constant
bj_UNIT_FACING = 270.0 ---@type number real constant
bj_RADTODEG = 180.0 / bj_PI ---@type number real constant
bj_DEGTORAD = bj_PI / 180.0 ---@type number real constant
bj_TEXT_DELAY_QUEST = 20.00 ---@type number real constant
bj_TEXT_DELAY_QUESTUPDATE = 20.00 ---@type number real constant
bj_TEXT_DELAY_QUESTDONE = 20.00 ---@type number real constant
bj_TEXT_DELAY_QUESTFAILED = 20.00 ---@type number real constant
bj_TEXT_DELAY_QUESTREQUIREMENT = 20.00 ---@type number real constant
bj_TEXT_DELAY_MISSIONFAILED = 20.00 ---@type number real constant
bj_TEXT_DELAY_ALWAYSHINT = 12.00 ---@type number real constant
bj_TEXT_DELAY_HINT = 12.00 ---@type number real constant
bj_TEXT_DELAY_SECRET = 10.00 ---@type number real constant
bj_TEXT_DELAY_UNITACQUIRED = 15.00 ---@type number real constant
bj_TEXT_DELAY_UNITAVAILABLE = 10.00 ---@type number real constant
bj_TEXT_DELAY_ITEMACQUIRED = 10.00 ---@type number real constant
bj_TEXT_DELAY_WARNING = 12.00 ---@type number real constant
bj_QUEUE_DELAY_QUEST = 5.00 ---@type number real constant
bj_QUEUE_DELAY_HINT = 5.00 ---@type number real constant
bj_QUEUE_DELAY_SECRET = 3.00 ---@type number real constant
bj_HANDICAP_EASY = 60.00 ---@type number real constant
bj_GAME_STARTED_THRESHOLD = 0.01 ---@type number real constant
bj_WAIT_FOR_COND_MIN_INTERVAL = 0.10 ---@type number real constant
bj_POLLED_WAIT_INTERVAL = 0.10 ---@type number real constant
bj_POLLED_WAIT_SKIP_THRESHOLD = 2.00 ---@type number real constant
bj_MAX_INVENTORY = 6 ---@type number integer constant
bj_MAX_PLAYERS = 12 ---@type number integer constant
bj_PLAYER_NEUTRAL_VICTIM = 13 ---@type number integer constant
bj_PLAYER_NEUTRAL_EXTRA = 14 ---@type number integer constant
bj_MAX_PLAYER_SLOTS = 16 ---@type number integer constant
bj_MAX_SKELETONS = 25 ---@type number integer constant
bj_MAX_STOCK_ITEM_SLOTS = 11 ---@type number integer constant
bj_MAX_STOCK_UNIT_SLOTS = 11 ---@type number integer constant
bj_MAX_ITEM_LEVEL = 10 ---@type number integer constant
bj_TOD_DAWN = 6.00 ---@type number real constant
bj_TOD_DUSK = 18.00 ---@type number real constant
bj_MELEE_STARTING_TOD = 8.00 ---@type number real constant
bj_MELEE_STARTING_GOLD_V0 = 750 ---@type number integer constant
bj_MELEE_STARTING_GOLD_V1 = 500 ---@type number integer constant
bj_MELEE_STARTING_LUMBER_V0 = 200 ---@type number integer constant
bj_MELEE_STARTING_LUMBER_V1 = 150 ---@type number integer constant
bj_MELEE_STARTING_HERO_TOKENS = 1 ---@type number integer constant
bj_MELEE_HERO_LIMIT = 3 ---@type number integer constant
bj_MELEE_HERO_TYPE_LIMIT = 1 ---@type number integer constant
bj_MELEE_MINE_SEARCH_RADIUS = 2000 ---@type number real constant
bj_MELEE_CLEAR_UNITS_RADIUS = 1500 ---@type number real constant
bj_MELEE_CRIPPLE_TIMEOUT = 120.00 ---@type number real constant
bj_MELEE_CRIPPLE_MSG_DURATION = 20.00 ---@type number real constant
bj_MELEE_MAX_TWINKED_HEROES_V0 = 3 ---@type number integer constant
bj_MELEE_MAX_TWINKED_HEROES_V1 = 1 ---@type number integer constant
bj_CREEP_ITEM_DELAY = 0.50 ---@type number real constant
bj_STOCK_RESTOCK_INITIAL_DELAY = 120 ---@type number real constant
bj_STOCK_RESTOCK_INTERVAL = 30 ---@type number real constant
bj_STOCK_MAX_ITERATIONS = 20 ---@type number integer constant
bj_MAX_DEST_IN_REGION_EVENTS = 64 ---@type number integer constant
bj_CAMERA_MIN_FARZ = 100 ---@type number integer constant
bj_CAMERA_DEFAULT_DISTANCE = 1650 ---@type number integer constant
bj_CAMERA_DEFAULT_FARZ = 5000 ---@type number integer constant
bj_CAMERA_DEFAULT_AOA = 304 ---@type number integer constant
bj_CAMERA_DEFAULT_FOV = 70 ---@type number integer constant
bj_CAMERA_DEFAULT_ROLL = 0 ---@type number integer constant
bj_CAMERA_DEFAULT_ROTATION = 90 ---@type number integer constant
bj_RESCUE_PING_TIME = 2.00 ---@type number real constant
bj_NOTHING_SOUND_DURATION = 5.00 ---@type number real constant
bj_TRANSMISSION_PING_TIME = 1.00 ---@type number real constant
bj_TRANSMISSION_IND_RED = 255 ---@type number integer constant
bj_TRANSMISSION_IND_BLUE = 255 ---@type number integer constant
bj_TRANSMISSION_IND_GREEN = 255 ---@type number integer constant
bj_TRANSMISSION_IND_ALPHA = 255 ---@type number integer constant
bj_TRANSMISSION_PORT_HANGTIME = 1.50 ---@type number real constant
bj_CINEMODE_INTERFACEFADE = 0.50 ---@type number real constant
bj_CINEMODE_GAMESPEED = MAP_SPEED_NORMAL ---@type gamespeed constant
bj_CINEMODE_VOLUME_UNITMOVEMENT = 0.40 ---@type number real constant
bj_CINEMODE_VOLUME_UNITSOUNDS = 0.00 ---@type number real constant
bj_CINEMODE_VOLUME_COMBAT = 0.40 ---@type number real constant
bj_CINEMODE_VOLUME_SPELLS = 0.40 ---@type number real constant
bj_CINEMODE_VOLUME_UI = 0.00 ---@type number real constant
bj_CINEMODE_VOLUME_MUSIC = 0.55 ---@type number real constant
bj_CINEMODE_VOLUME_AMBIENTSOUNDS = 1.00 ---@type number real constant
bj_CINEMODE_VOLUME_FIRE = 0.60 ---@type number real constant
bj_SPEECH_VOLUME_UNITMOVEMENT = 0.25 ---@type number real constant
bj_SPEECH_VOLUME_UNITSOUNDS = 0.00 ---@type number real constant
bj_SPEECH_VOLUME_COMBAT = 0.25 ---@type number real constant
bj_SPEECH_VOLUME_SPELLS = 0.25 ---@type number real constant
bj_SPEECH_VOLUME_UI = 0.00 ---@type number real constant
bj_SPEECH_VOLUME_MUSIC = 0.55 ---@type number real constant
bj_SPEECH_VOLUME_AMBIENTSOUNDS = 1.00 ---@type number real constant
bj_SPEECH_VOLUME_FIRE = 0.60 ---@type number real constant
bj_SMARTPAN_TRESHOLD_PAN = 500 ---@type number real constant
bj_SMARTPAN_TRESHOLD_SNAP = 3500 ---@type number real constant
bj_MAX_QUEUED_TRIGGERS = 100 ---@type number integer constant
bj_QUEUED_TRIGGER_TIMEOUT = 180.00 ---@type number real constant
bj_CAMPAIGN_INDEX_T = 0 ---@type number integer constant
bj_CAMPAIGN_INDEX_H = 1 ---@type number integer constant
bj_CAMPAIGN_INDEX_U = 2 ---@type number integer constant
bj_CAMPAIGN_INDEX_O = 3 ---@type number integer constant
bj_CAMPAIGN_INDEX_N = 4 ---@type number integer constant
bj_CAMPAIGN_INDEX_XN = 5 ---@type number integer constant
bj_CAMPAIGN_INDEX_XH = 6 ---@type number integer constant
bj_CAMPAIGN_INDEX_XU = 7 ---@type number integer constant
bj_CAMPAIGN_INDEX_XO = 8 ---@type number integer constant
bj_CAMPAIGN_OFFSET_T = 0 ---@type number integer constant
bj_CAMPAIGN_OFFSET_H = 1 ---@type number integer constant
bj_CAMPAIGN_OFFSET_U = 2 ---@type number integer constant
bj_CAMPAIGN_OFFSET_O = 3 ---@type number integer constant
bj_CAMPAIGN_OFFSET_N = 4 ---@type number integer constant
bj_CAMPAIGN_OFFSET_XN = 0 ---@type number integer constant
bj_CAMPAIGN_OFFSET_XH = 1 ---@type number integer constant
bj_CAMPAIGN_OFFSET_XU = 2 ---@type number integer constant
bj_CAMPAIGN_OFFSET_XO = 3 ---@type number integer constant
bj_MISSION_INDEX_T00 = bj_CAMPAIGN_OFFSET_T * 1000 + 0 ---@type number integer constant
bj_MISSION_INDEX_T01 = bj_CAMPAIGN_OFFSET_T * 1000 + 1 ---@type number integer constant
bj_MISSION_INDEX_H00 = bj_CAMPAIGN_OFFSET_H * 1000 + 0 ---@type number integer constant
bj_MISSION_INDEX_H01 = bj_CAMPAIGN_OFFSET_H * 1000 + 1 ---@type number integer constant
bj_MISSION_INDEX_H02 = bj_CAMPAIGN_OFFSET_H * 1000 + 2 ---@type number integer constant
bj_MISSION_INDEX_H03 = bj_CAMPAIGN_OFFSET_H * 1000 + 3 ---@type number integer constant
bj_MISSION_INDEX_H04 = bj_CAMPAIGN_OFFSET_H * 1000 + 4 ---@type number integer constant
bj_MISSION_INDEX_H05 = bj_CAMPAIGN_OFFSET_H * 1000 + 5 ---@type number integer constant
bj_MISSION_INDEX_H06 = bj_CAMPAIGN_OFFSET_H * 1000 + 6 ---@type number integer constant
bj_MISSION_INDEX_H07 = bj_CAMPAIGN_OFFSET_H * 1000 + 7 ---@type number integer constant
bj_MISSION_INDEX_H08 = bj_CAMPAIGN_OFFSET_H * 1000 + 8 ---@type number integer constant
bj_MISSION_INDEX_H09 = bj_CAMPAIGN_OFFSET_H * 1000 + 9 ---@type number integer constant
bj_MISSION_INDEX_H10 = bj_CAMPAIGN_OFFSET_H * 1000 + 10 ---@type number integer constant
bj_MISSION_INDEX_H11 = bj_CAMPAIGN_OFFSET_H * 1000 + 11 ---@type number integer constant
bj_MISSION_INDEX_U00 = bj_CAMPAIGN_OFFSET_U * 1000 + 0 ---@type number integer constant
bj_MISSION_INDEX_U01 = bj_CAMPAIGN_OFFSET_U * 1000 + 1 ---@type number integer constant
bj_MISSION_INDEX_U02 = bj_CAMPAIGN_OFFSET_U * 1000 + 2 ---@type number integer constant
bj_MISSION_INDEX_U03 = bj_CAMPAIGN_OFFSET_U * 1000 + 3 ---@type number integer constant
bj_MISSION_INDEX_U05 = bj_CAMPAIGN_OFFSET_U * 1000 + 4 ---@type number integer constant
bj_MISSION_INDEX_U07 = bj_CAMPAIGN_OFFSET_U * 1000 + 5 ---@type number integer constant
bj_MISSION_INDEX_U08 = bj_CAMPAIGN_OFFSET_U * 1000 + 6 ---@type number integer constant
bj_MISSION_INDEX_U09 = bj_CAMPAIGN_OFFSET_U * 1000 + 7 ---@type number integer constant
bj_MISSION_INDEX_U10 = bj_CAMPAIGN_OFFSET_U * 1000 + 8 ---@type number integer constant
bj_MISSION_INDEX_U11 = bj_CAMPAIGN_OFFSET_U * 1000 + 9 ---@type number integer constant
bj_MISSION_INDEX_O00 = bj_CAMPAIGN_OFFSET_O * 1000 + 0 ---@type number integer constant
bj_MISSION_INDEX_O01 = bj_CAMPAIGN_OFFSET_O * 1000 + 1 ---@type number integer constant
bj_MISSION_INDEX_O02 = bj_CAMPAIGN_OFFSET_O * 1000 + 2 ---@type number integer constant
bj_MISSION_INDEX_O03 = bj_CAMPAIGN_OFFSET_O * 1000 + 3 ---@type number integer constant
bj_MISSION_INDEX_O04 = bj_CAMPAIGN_OFFSET_O * 1000 + 4 ---@type number integer constant
bj_MISSION_INDEX_O05 = bj_CAMPAIGN_OFFSET_O * 1000 + 5 ---@type number integer constant
bj_MISSION_INDEX_O06 = bj_CAMPAIGN_OFFSET_O * 1000 + 6 ---@type number integer constant
bj_MISSION_INDEX_O07 = bj_CAMPAIGN_OFFSET_O * 1000 + 7 ---@type number integer constant
bj_MISSION_INDEX_O08 = bj_CAMPAIGN_OFFSET_O * 1000 + 8 ---@type number integer constant
bj_MISSION_INDEX_O09 = bj_CAMPAIGN_OFFSET_O * 1000 + 9 ---@type number integer constant
bj_MISSION_INDEX_O10 = bj_CAMPAIGN_OFFSET_O * 1000 + 10 ---@type number integer constant
bj_MISSION_INDEX_N00 = bj_CAMPAIGN_OFFSET_N * 1000 + 0 ---@type number integer constant
bj_MISSION_INDEX_N01 = bj_CAMPAIGN_OFFSET_N * 1000 + 1 ---@type number integer constant
bj_MISSION_INDEX_N02 = bj_CAMPAIGN_OFFSET_N * 1000 + 2 ---@type number integer constant
bj_MISSION_INDEX_N03 = bj_CAMPAIGN_OFFSET_N * 1000 + 3 ---@type number integer constant
bj_MISSION_INDEX_N04 = bj_CAMPAIGN_OFFSET_N * 1000 + 4 ---@type number integer constant
bj_MISSION_INDEX_N05 = bj_CAMPAIGN_OFFSET_N * 1000 + 5 ---@type number integer constant
bj_MISSION_INDEX_N06 = bj_CAMPAIGN_OFFSET_N * 1000 + 6 ---@type number integer constant
bj_MISSION_INDEX_N07 = bj_CAMPAIGN_OFFSET_N * 1000 + 7 ---@type number integer constant
bj_MISSION_INDEX_N08 = bj_CAMPAIGN_OFFSET_N * 1000 + 8 ---@type number integer constant
bj_MISSION_INDEX_N09 = bj_CAMPAIGN_OFFSET_N * 1000 + 9 ---@type number integer constant
bj_MISSION_INDEX_XN00 = bj_CAMPAIGN_OFFSET_XN * 1000 + 0 ---@type number integer constant
bj_MISSION_INDEX_XN01 = bj_CAMPAIGN_OFFSET_XN * 1000 + 1 ---@type number integer constant
bj_MISSION_INDEX_XN02 = bj_CAMPAIGN_OFFSET_XN * 1000 + 2 ---@type number integer constant
bj_MISSION_INDEX_XN03 = bj_CAMPAIGN_OFFSET_XN * 1000 + 3 ---@type number integer constant
bj_MISSION_INDEX_XN04 = bj_CAMPAIGN_OFFSET_XN * 1000 + 4 ---@type number integer constant
bj_MISSION_INDEX_XN05 = bj_CAMPAIGN_OFFSET_XN * 1000 + 5 ---@type number integer constant
bj_MISSION_INDEX_XN06 = bj_CAMPAIGN_OFFSET_XN * 1000 + 6 ---@type number integer constant
bj_MISSION_INDEX_XN07 = bj_CAMPAIGN_OFFSET_XN * 1000 + 7 ---@type number integer constant
bj_MISSION_INDEX_XN08 = bj_CAMPAIGN_OFFSET_XN * 1000 + 8 ---@type number integer constant
bj_MISSION_INDEX_XN09 = bj_CAMPAIGN_OFFSET_XN * 1000 + 9 ---@type number integer constant
bj_MISSION_INDEX_XN10 = bj_CAMPAIGN_OFFSET_XN * 1000 + 10 ---@type number integer constant
bj_MISSION_INDEX_XH00 = bj_CAMPAIGN_OFFSET_XH * 1000 + 0 ---@type number integer constant
bj_MISSION_INDEX_XH01 = bj_CAMPAIGN_OFFSET_XH * 1000 + 1 ---@type number integer constant
bj_MISSION_INDEX_XH02 = bj_CAMPAIGN_OFFSET_XH * 1000 + 2 ---@type number integer constant
bj_MISSION_INDEX_XH03 = bj_CAMPAIGN_OFFSET_XH * 1000 + 3 ---@type number integer constant
bj_MISSION_INDEX_XH04 = bj_CAMPAIGN_OFFSET_XH * 1000 + 4 ---@type number integer constant
bj_MISSION_INDEX_XH05 = bj_CAMPAIGN_OFFSET_XH * 1000 + 5 ---@type number integer constant
bj_MISSION_INDEX_XH06 = bj_CAMPAIGN_OFFSET_XH * 1000 + 6 ---@type number integer constant
bj_MISSION_INDEX_XH07 = bj_CAMPAIGN_OFFSET_XH * 1000 + 7 ---@type number integer constant
bj_MISSION_INDEX_XH08 = bj_CAMPAIGN_OFFSET_XH * 1000 + 8 ---@type number integer constant
bj_MISSION_INDEX_XH09 = bj_CAMPAIGN_OFFSET_XH * 1000 + 9 ---@type number integer constant
bj_MISSION_INDEX_XU00 = bj_CAMPAIGN_OFFSET_XU * 1000 + 0 ---@type number integer constant
bj_MISSION_INDEX_XU01 = bj_CAMPAIGN_OFFSET_XU * 1000 + 1 ---@type number integer constant
bj_MISSION_INDEX_XU02 = bj_CAMPAIGN_OFFSET_XU * 1000 + 2 ---@type number integer constant
bj_MISSION_INDEX_XU03 = bj_CAMPAIGN_OFFSET_XU * 1000 + 3 ---@type number integer constant
bj_MISSION_INDEX_XU04 = bj_CAMPAIGN_OFFSET_XU * 1000 + 4 ---@type number integer constant
bj_MISSION_INDEX_XU05 = bj_CAMPAIGN_OFFSET_XU * 1000 + 5 ---@type number integer constant
bj_MISSION_INDEX_XU06 = bj_CAMPAIGN_OFFSET_XU * 1000 + 6 ---@type number integer constant
bj_MISSION_INDEX_XU07 = bj_CAMPAIGN_OFFSET_XU * 1000 + 7 ---@type number integer constant
bj_MISSION_INDEX_XU08 = bj_CAMPAIGN_OFFSET_XU * 1000 + 8 ---@type number integer constant
bj_MISSION_INDEX_XU09 = bj_CAMPAIGN_OFFSET_XU * 1000 + 9 ---@type number integer constant
bj_MISSION_INDEX_XU10 = bj_CAMPAIGN_OFFSET_XU * 1000 + 10 ---@type number integer constant
bj_MISSION_INDEX_XU11 = bj_CAMPAIGN_OFFSET_XU * 1000 + 11 ---@type number integer constant
bj_MISSION_INDEX_XU12 = bj_CAMPAIGN_OFFSET_XU * 1000 + 12 ---@type number integer constant
bj_MISSION_INDEX_XU13 = bj_CAMPAIGN_OFFSET_XU * 1000 + 13 ---@type number integer constant
bj_MISSION_INDEX_XO00 = bj_CAMPAIGN_OFFSET_XO * 1000 + 0 ---@type number integer constant
bj_CINEMATICINDEX_TOP = 0 ---@type number integer constant
bj_CINEMATICINDEX_HOP = 1 ---@type number integer constant
bj_CINEMATICINDEX_HED = 2 ---@type number integer constant
bj_CINEMATICINDEX_OOP = 3 ---@type number integer constant
bj_CINEMATICINDEX_OED = 4 ---@type number integer constant
bj_CINEMATICINDEX_UOP = 5 ---@type number integer constant
bj_CINEMATICINDEX_UED = 6 ---@type number integer constant
bj_CINEMATICINDEX_NOP = 7 ---@type number integer constant
bj_CINEMATICINDEX_NED = 8 ---@type number integer constant
bj_CINEMATICINDEX_XOP = 9 ---@type number integer constant
bj_CINEMATICINDEX_XED = 10 ---@type number integer constant
bj_ALLIANCE_UNALLIED = 0 ---@type number integer constant
bj_ALLIANCE_UNALLIED_VISION = 1 ---@type number integer constant
bj_ALLIANCE_ALLIED = 2 ---@type number integer constant
bj_ALLIANCE_ALLIED_VISION = 3 ---@type number integer constant
bj_ALLIANCE_ALLIED_UNITS = 4 ---@type number integer constant
bj_ALLIANCE_ALLIED_ADVUNITS = 5 ---@type number integer constant
bj_ALLIANCE_NEUTRAL = 6 ---@type number integer constant
bj_ALLIANCE_NEUTRAL_VISION = 7 ---@type number integer constant
bj_KEYEVENTTYPE_DEPRESS = 0 ---@type number integer constant
bj_KEYEVENTTYPE_RELEASE = 1 ---@type number integer constant
bj_KEYEVENTKEY_LEFT = 0 ---@type number integer constant
bj_KEYEVENTKEY_RIGHT = 1 ---@type number integer constant
bj_KEYEVENTKEY_DOWN = 2 ---@type number integer constant
bj_KEYEVENTKEY_UP = 3 ---@type number integer constant
bj_TIMETYPE_ADD = 0 ---@type number integer constant
bj_TIMETYPE_SET = 1 ---@type number integer constant
bj_TIMETYPE_SUB = 2 ---@type number integer constant
bj_CAMERABOUNDS_ADJUST_ADD = 0 ---@type number integer constant
bj_CAMERABOUNDS_ADJUST_SUB = 1 ---@type number integer constant
bj_QUESTTYPE_REQ_DISCOVERED = 0 ---@type number integer constant
bj_QUESTTYPE_REQ_UNDISCOVERED = 1 ---@type number integer constant
bj_QUESTTYPE_OPT_DISCOVERED = 2 ---@type number integer constant
bj_QUESTTYPE_OPT_UNDISCOVERED = 3 ---@type number integer constant
bj_QUESTMESSAGE_DISCOVERED = 0 ---@type number integer constant
bj_QUESTMESSAGE_UPDATED = 1 ---@type number integer constant
bj_QUESTMESSAGE_COMPLETED = 2 ---@type number integer constant
bj_QUESTMESSAGE_FAILED = 3 ---@type number integer constant
bj_QUESTMESSAGE_REQUIREMENT = 4 ---@type number integer constant
bj_QUESTMESSAGE_MISSIONFAILED = 5 ---@type number integer constant
bj_QUESTMESSAGE_ALWAYSHINT = 6 ---@type number integer constant
bj_QUESTMESSAGE_HINT = 7 ---@type number integer constant
bj_QUESTMESSAGE_SECRET = 8 ---@type number integer constant
bj_QUESTMESSAGE_UNITACQUIRED = 9 ---@type number integer constant
bj_QUESTMESSAGE_UNITAVAILABLE = 10 ---@type number integer constant
bj_QUESTMESSAGE_ITEMACQUIRED = 11 ---@type number integer constant
bj_QUESTMESSAGE_WARNING = 12 ---@type number integer constant
bj_SORTTYPE_SORTBYVALUE = 0 ---@type number integer constant
bj_SORTTYPE_SORTBYPLAYER = 1 ---@type number integer constant
bj_SORTTYPE_SORTBYLABEL = 2 ---@type number integer constant
bj_CINEFADETYPE_FADEIN = 0 ---@type number integer constant
bj_CINEFADETYPE_FADEOUT = 1 ---@type number integer constant
bj_CINEFADETYPE_FADEOUTIN = 2 ---@type number integer constant
bj_REMOVEBUFFS_POSITIVE = 0 ---@type number integer constant
bj_REMOVEBUFFS_NEGATIVE = 1 ---@type number integer constant
bj_REMOVEBUFFS_ALL = 2 ---@type number integer constant
bj_REMOVEBUFFS_NONTLIFE = 3 ---@type number integer constant
bj_BUFF_POLARITY_POSITIVE = 0 ---@type number integer constant
bj_BUFF_POLARITY_NEGATIVE = 1 ---@type number integer constant
bj_BUFF_POLARITY_EITHER = 2 ---@type number integer constant
bj_BUFF_RESIST_MAGIC = 0 ---@type number integer constant
bj_BUFF_RESIST_PHYSICAL = 1 ---@type number integer constant
bj_BUFF_RESIST_EITHER = 2 ---@type number integer constant
bj_BUFF_RESIST_BOTH = 3 ---@type number integer constant
bj_HEROSTAT_STR = 0 ---@type number integer constant
bj_HEROSTAT_AGI = 1 ---@type number integer constant
bj_HEROSTAT_INT = 2 ---@type number integer constant
bj_MODIFYMETHOD_ADD = 0 ---@type number integer constant
bj_MODIFYMETHOD_SUB = 1 ---@type number integer constant
bj_MODIFYMETHOD_SET = 2 ---@type number integer constant
bj_UNIT_STATE_METHOD_ABSOLUTE = 0 ---@type number integer constant
bj_UNIT_STATE_METHOD_RELATIVE = 1 ---@type number integer constant
bj_UNIT_STATE_METHOD_DEFAULTS = 2 ---@type number integer constant
bj_UNIT_STATE_METHOD_MAXIMUM = 3 ---@type number integer constant
bj_GATEOPERATION_CLOSE = 0 ---@type number integer constant
bj_GATEOPERATION_OPEN = 1 ---@type number integer constant
bj_GATEOPERATION_DESTROY = 2 ---@type number integer constant
bj_GAMECACHE_BOOLEAN = 0 ---@type number integer constant
bj_GAMECACHE_INTEGER = 1 ---@type number integer constant
bj_GAMECACHE_REAL = 2 ---@type number integer constant
bj_GAMECACHE_UNIT = 3 ---@type number integer constant
bj_GAMECACHE_STRING = 4 ---@type number integer constant
bj_HASHTABLE_BOOLEAN = 0 ---@type number integer constant
bj_HASHTABLE_INTEGER = 1 ---@type number integer constant
bj_HASHTABLE_REAL = 2 ---@type number integer constant
bj_HASHTABLE_STRING = 3 ---@type number integer constant
bj_HASHTABLE_HANDLE = 4 ---@type number integer constant
bj_ITEM_STATUS_HIDDEN = 0 ---@type number integer constant
bj_ITEM_STATUS_OWNED = 1 ---@type number integer constant
bj_ITEM_STATUS_INVULNERABLE = 2 ---@type number integer constant
bj_ITEM_STATUS_POWERUP = 3 ---@type number integer constant
bj_ITEM_STATUS_SELLABLE = 4 ---@type number integer constant
bj_ITEM_STATUS_PAWNABLE = 5 ---@type number integer constant
bj_ITEMCODE_STATUS_POWERUP = 0 ---@type number integer constant
bj_ITEMCODE_STATUS_SELLABLE = 1 ---@type number integer constant
bj_ITEMCODE_STATUS_PAWNABLE = 2 ---@type number integer constant
bj_MINIMAPPINGSTYLE_SIMPLE = 0 ---@type number integer constant
bj_MINIMAPPINGSTYLE_FLASHY = 1 ---@type number integer constant
bj_MINIMAPPINGSTYLE_ATTACK = 2 ---@type number integer constant
bj_CORPSE_MAX_DEATH_TIME = 8.00 ---@type number real constant
bj_CORPSETYPE_FLESH = 0 ---@type number integer constant
bj_CORPSETYPE_BONE = 1 ---@type number integer constant
bj_ELEVATOR_BLOCKER_CODE = FourCC('DTep') ---@type number integer constant
bj_ELEVATOR_CODE01 = FourCC('DTrf') ---@type number integer constant
bj_ELEVATOR_CODE02 = FourCC('DTrx') ---@type number integer constant
bj_ELEVATOR_WALL_TYPE_ALL = 0 ---@type number integer constant
bj_ELEVATOR_WALL_TYPE_EAST = 1 ---@type number integer constant
bj_ELEVATOR_WALL_TYPE_NORTH = 2 ---@type number integer constant
bj_ELEVATOR_WALL_TYPE_SOUTH = 3 ---@type number integer constant
bj_ELEVATOR_WALL_TYPE_WEST = 4 ---@type number integer constant
bj_FORCE_ALL_PLAYERS = nil ---@type force
bj_FORCE_PLAYER = {} ---@type force
bj_MELEE_MAX_TWINKED_HEROES = 0 ---@type number integer
bj_mapInitialPlayableArea = nil ---@type rect
bj_mapInitialCameraBounds = nil ---@type rect
bj_forLoopAIndex = 0 ---@type number integer
bj_forLoopBIndex = 0 ---@type number integer
bj_forLoopAIndexEnd = 0 ---@type number integer
bj_forLoopBIndexEnd = 0 ---@type number integer
bj_slotControlReady = false ---@type boolean
bj_slotControlUsed = {} ---@type boolean[]
bj_slotControl = {} ---@type mapcontrol
bj_gameStartedTimer = nil ---@type timer
bj_gameStarted = false ---@type boolean
bj_volumeGroupsTimer = CreateTimer() ---@type timer
bj_isSinglePlayer = false ---@type boolean
bj_dncSoundsDay = nil ---@type trigger
bj_dncSoundsNight = nil ---@type trigger
bj_dayAmbientSound = nil ---@type sound
bj_nightAmbientSound = nil ---@type sound
bj_dncSoundsDawn = nil ---@type trigger
bj_dncSoundsDusk = nil ---@type trigger
bj_dawnSound = nil ---@type sound
bj_duskSound = nil ---@type sound
bj_useDawnDuskSounds = true ---@type boolean
bj_dncIsDaytime = false ---@type boolean
bj_rescueSound = nil ---@type sound
bj_questDiscoveredSound = nil ---@type sound
bj_questUpdatedSound = nil ---@type sound
bj_questCompletedSound = nil ---@type sound
bj_questFailedSound = nil ---@type sound
bj_questHintSound = nil ---@type sound
bj_questSecretSound = nil ---@type sound
bj_questItemAcquiredSound = nil ---@type sound
bj_questWarningSound = nil ---@type sound
bj_victoryDialogSound = nil ---@type sound
bj_defeatDialogSound = nil ---@type sound
bj_stockItemPurchased = nil ---@type trigger
bj_stockUpdateTimer = nil ---@type timer
bj_stockAllowedPermanent = {} ---@type boolean[]
bj_stockAllowedCharged = {} ---@type boolean[]
bj_stockAllowedArtifact = {} ---@type boolean[]
bj_stockPickedItemLevel = 0 ---@type number integer
bj_stockPickedItemType = nil ---@type itemtype
bj_meleeVisibilityTrained = nil ---@type trigger
bj_meleeVisibilityIsDay = true ---@type boolean
bj_meleeGrantHeroItems = false ---@type boolean
bj_meleeNearestMineToLoc = nil ---@type location
bj_meleeNearestMine = nil ---@type unit
bj_meleeNearestMineDist = 0.00 ---@type number real
bj_meleeGameOver = false ---@type boolean
bj_meleeDefeated = {} ---@type boolean[]
bj_meleeVictoried = {} ---@type boolean[]
bj_ghoul = {} ---@type unit
bj_crippledTimer = {} ---@type timer
bj_crippledTimerWindows = {} ---@type timerdialog
bj_playerIsCrippled = {} ---@type boolean[]
bj_playerIsExposed = {} ---@type boolean[]
bj_finishSoonAllExposed = false ---@type boolean
bj_finishSoonTimerDialog = nil ---@type timerdialog
bj_meleeTwinkedHeroes = {} ---@type number[] integer
bj_rescueUnitBehavior = nil ---@type trigger
bj_rescueChangeColorUnit = true ---@type boolean
bj_rescueChangeColorBldg = true ---@type boolean
bj_cineSceneEndingTimer = nil ---@type timer
bj_cineSceneLastSound = nil ---@type sound
bj_cineSceneBeingSkipped = nil ---@type trigger
bj_cineModePriorSpeed = MAP_SPEED_NORMAL ---@type gamespeed
bj_cineModePriorFogSetting = false ---@type boolean
bj_cineModePriorMaskSetting = false ---@type boolean
bj_cineModeAlreadyIn = false ---@type boolean
bj_cineModePriorDawnDusk = false ---@type boolean
bj_cineModeSavedSeed = 0 ---@type number integer
bj_cineFadeFinishTimer = nil ---@type timer
bj_cineFadeContinueTimer = nil ---@type timer
bj_cineFadeContinueRed = 0 ---@type number real
bj_cineFadeContinueGreen = 0 ---@type number real
bj_cineFadeContinueBlue = 0 ---@type number real
bj_cineFadeContinueTrans = 0 ---@type number real
bj_cineFadeContinueDuration = 0 ---@type number real
bj_cineFadeContinueTex = "" ---@type string
bj_queuedExecTotal = 0 ---@type number integer
bj_queuedExecTriggers = {} ---@type trigger
bj_queuedExecUseConds = {} ---@type boolean[]
bj_queuedExecTimeoutTimer = CreateTimer() ---@type timer
bj_queuedExecTimeout = nil ---@type trigger
bj_destInRegionDiesCount = 0 ---@type number integer
bj_destInRegionDiesTrig = nil ---@type trigger
bj_groupCountUnits = 0 ---@type number integer
bj_forceCountPlayers = 0 ---@type number integer
bj_groupEnumTypeId = 0 ---@type number integer
bj_groupEnumOwningPlayer = nil ---@type player
bj_groupAddGroupDest = nil ---@type group
bj_groupRemoveGroupDest = nil ---@type group
bj_groupRandomConsidered = 0 ---@type number integer
bj_groupRandomCurrentPick = nil ---@type unit
bj_groupLastCreatedDest = nil ---@type group
bj_randomSubGroupGroup = nil ---@type group
bj_randomSubGroupWant = 0 ---@type number integer
bj_randomSubGroupTotal = 0 ---@type number integer
bj_randomSubGroupChance = 0 ---@type number real
bj_destRandomConsidered = 0 ---@type number integer
bj_destRandomCurrentPick = nil ---@type destructable
bj_elevatorWallBlocker = nil ---@type destructable
bj_elevatorNeighbor = nil ---@type destructable
bj_itemRandomConsidered = 0 ---@type number integer
bj_itemRandomCurrentPick = nil ---@type item
bj_forceRandomConsidered = 0 ---@type number integer
bj_forceRandomCurrentPick = nil ---@type player
bj_makeUnitRescuableUnit = nil ---@type unit
bj_makeUnitRescuableFlag = true ---@type boolean
bj_pauseAllUnitsFlag = true ---@type boolean
bj_enumDestructableCenter = nil ---@type location
bj_enumDestructableRadius = 0 ---@type number real
bj_setPlayerTargetColor = nil ---@type playercolor
bj_isUnitGroupDeadResult = true ---@type boolean
bj_isUnitGroupEmptyResult = true ---@type boolean
bj_isUnitGroupInRectResult = true ---@type boolean
bj_isUnitGroupInRectRect = nil ---@type rect
bj_changeLevelShowScores = false ---@type boolean
bj_changeLevelMapName = nil ---@type string
bj_suspendDecayFleshGroup = CreateGroup() ---@type group
bj_suspendDecayBoneGroup = CreateGroup() ---@type group
bj_delayedSuspendDecayTimer = CreateTimer() ---@type timer
bj_delayedSuspendDecayTrig = nil ---@type trigger
bj_livingPlayerUnitsTypeId = 0 ---@type number integer
bj_lastDyingWidget = nil ---@type widget
bj_randDistCount = 0 ---@type number integer
bj_randDistID = {} ---@type number[] integer
bj_randDistChance = {} ---@type number[] integer
bj_lastCreatedUnit = nil ---@type unit
bj_lastCreatedItem = nil ---@type item
bj_lastRemovedItem = nil ---@type item
bj_lastHauntedGoldMine = nil ---@type unit
bj_lastCreatedDestructable = nil ---@type destructable
bj_lastCreatedGroup = CreateGroup() ---@type group
bj_lastCreatedFogModifier = nil ---@type fogmodifier
bj_lastCreatedEffect = nil ---@type effect
bj_lastCreatedWeatherEffect = nil ---@type weathereffect
bj_lastCreatedTerrainDeformation = nil ---@type terraindeformation
bj_lastCreatedQuest = nil ---@type quest
bj_lastCreatedQuestItem = nil ---@type questitem
bj_lastCreatedDefeatCondition = nil ---@type defeatcondition
bj_lastStartedTimer = CreateTimer() ---@type timer
bj_lastCreatedTimerDialog = nil ---@type timerdialog
bj_lastCreatedLeaderboard = nil ---@type leaderboard
bj_lastCreatedMultiboard = nil ---@type multiboard
bj_lastPlayedSound = nil ---@type sound
bj_lastPlayedMusic = "" ---@type string
bj_lastTransmissionDuration = 0 ---@type number real
bj_lastCreatedGameCache = nil ---@type gamecache
bj_lastCreatedHashtable = nil ---@type hashtable
bj_lastLoadedUnit = nil ---@type unit
bj_lastCreatedButton = nil ---@type button
bj_lastReplacedUnit = nil ---@type unit
bj_lastCreatedTextTag = nil ---@type texttag
bj_lastCreatedLightning = nil ---@type lightning
bj_lastCreatedImage = nil ---@type image
bj_lastCreatedUbersplat = nil ---@type ubersplat
filterIssueHauntOrderAtLocBJ = nil ---@type boolexpr
filterEnumDestructablesInCircleBJ = nil ---@type boolexpr
filterGetUnitsInRectOfPlayer = nil ---@type boolexpr
filterGetUnitsOfTypeIdAll = nil ---@type boolexpr
filterGetUnitsOfPlayerAndTypeId = nil ---@type boolexpr
filterMeleeTrainedUnitIsHeroBJ = nil ---@type boolexpr
filterLivingPlayerUnitsOfTypeId = nil ---@type boolexpr
bj_wantDestroyGroup = false ---@type boolean


---@param msg string
function BJDebugMsg(msg)
	local i = 0 ---@type number integer
	while(true) do
		DisplayTimedTextToPlayer(Player(i), 0, 0, 60, msg)
		i = i + 1
		if (i == bj_MAX_PLAYERS) then break end
	end
end

---@param a number real
---@param b number real
---@return number real
function RMinBJ(a, b)
	if (a < b) then
		return a
	else
		return b
	end
end

---@param a number real
---@param b number real
---@return number real
function RMaxBJ(a, b)
	if (a < b) then
		return b
	else
		return a
	end
end

---@param a number real
---@return number real
function RAbsBJ(a)
	if (a >= 0) then
		return a
	else
		return -a
	end
end

---@param a number real
---@return number real
function RSignBJ(a)
	if (a >= 0.0) then
		return 1.0
	else
		return -1.0
	end
end

---@param a number integer
---@param b number integer
---@return number integer
function IMinBJ(a, b)
	if (a < b) then
		return a
	else
		return b
	end
end

---@param a number integer
---@param b number integer
---@return number integer
function IMaxBJ(a, b)
	if (a < b) then
		return b
	else
		return a
	end
end

---@param a number integer
---@return number integer
function IAbsBJ(a)
	if (a >= 0) then
		return a
	else
		return -a
	end
end

---@param a number integer
---@return number integer
function ISignBJ(a)
	if (a >= 0) then
		return 1
	else
		return -1
	end
end

---@param degrees number real
---@return number real
function SinBJ(degrees)
	return Sin(degrees * bj_DEGTORAD)
end

---@param degrees number real
---@return number real
function CosBJ(degrees)
	return Cos(degrees * bj_DEGTORAD)
end

---@param degrees number real
---@return number real
function TanBJ(degrees)
	return Tan(degrees * bj_DEGTORAD)
end

---@param degrees number real
---@return number real
function AsinBJ(degrees)
	return Asin(degrees) * bj_RADTODEG
end

---@param degrees number real
---@return number real
function AcosBJ(degrees)
	return Acos(degrees) * bj_RADTODEG
end

---@param degrees number real
---@return number real
function AtanBJ(degrees)
	return Atan(degrees) * bj_RADTODEG
end

---@param y number real
---@param x number real
---@return number real
function Atan2BJ(y, x)
	return Atan2(y, x) * bj_RADTODEG
end

---@param locA location
---@param locB location
---@return number real
function AngleBetweenPoints(locA, locB)
	return bj_RADTODEG * Atan2(GetLocationY(locB) - GetLocationY(locA), GetLocationX(locB) - GetLocationX(locA))
end

---@param locA location
---@param locB location
---@return number real
function DistanceBetweenPoints(locA, locB)
	local dx = GetLocationX(locB) - GetLocationX(locA) ---@type number real
	local dy = GetLocationY(locB) - GetLocationY(locA) ---@type number real
	return SquareRoot(dx * dx + dy * dy)
end

---@param source location
---@param dist number real
---@param angle number real
---@return location
function PolarProjectionBJ(source, dist, angle)
	local x = GetLocationX(source) + dist * Cos(angle * bj_DEGTORAD) ---@type number real
	local y = GetLocationY(source) + dist * Sin(angle * bj_DEGTORAD) ---@type number real
	return Location(x, y)
end

---@return number real
function GetRandomDirectionDeg()
	return GetRandomReal(0, 360)
end

---@return number real
function GetRandomPercentageBJ()
	return GetRandomReal(0, 100)
end

---@param whichRect rect
---@return location
function GetRandomLocInRect(whichRect)
	return Location(GetRandomReal(GetRectMinX(whichRect), GetRectMaxX(whichRect)), GetRandomReal(GetRectMinY(whichRect), GetRectMaxY(whichRect)))
end

---@param dividend number integer
---@param divisor number integer
---@return number integer
function ModuloInteger(dividend, divisor)
	local modulus = dividend - (dividend / divisor) * divisor ---@type number integer
	if (modulus < 0) then
		modulus = modulus + divisor
	end
	return modulus
end

---@param dividend number real
---@param divisor number real
---@return number real
function ModuloReal(dividend, divisor)
	local modulus = dividend - I2R(R2I(dividend / divisor)) * divisor ---@type number real
	if (modulus < 0) then
		modulus = modulus + divisor
	end
	return modulus
end

---@param loc location
---@param dx number real
---@param dy number real
---@return location
function OffsetLocation(loc, dx, dy)
	return Location(GetLocationX(loc) + dx, GetLocationY(loc) + dy)
end

---@param r rect
---@param dx number real
---@param dy number real
---@return rect
function OffsetRectBJ(r, dx, dy)
	return Rect(GetRectMinX(r) + dx, GetRectMinY(r) + dy, GetRectMaxX(r) + dx, GetRectMaxY(r) + dy)
end

---@param center location
---@param width number real
---@param height number real
---@return rect
function RectFromCenterSizeBJ(center, width, height)
	local x = GetLocationX(center) ---@type number real
	local y = GetLocationY(center) ---@type number real
	return Rect(x - width * 0.5, y - height * 0.5, x + width * 0.5, y + height * 0.5)
end

---@param r rect
---@param x number real
---@param y number real
---@return boolean
function RectContainsCoords(r, x, y)
	return (GetRectMinX(r) <= x) and (x <= GetRectMaxX(r)) and (GetRectMinY(r) <= y) and (y <= GetRectMaxY(r))
end

---@param r rect
---@param loc location
---@return boolean
function RectContainsLoc(r, loc)
	return RectContainsCoords(r, GetLocationX(loc), GetLocationY(loc))
end

---@param r rect
---@param whichUnit unit
---@return boolean
function RectContainsUnit(r, whichUnit)
	return RectContainsCoords(r, GetUnitX(whichUnit), GetUnitY(whichUnit))
end

---@param whichItem item
---@param r rect
---@return boolean
function RectContainsItem(whichItem, r)
	if (whichItem == nil) then
		return false
	end
	if (IsItemOwned(whichItem)) then
		return false
	end
	return RectContainsCoords(r, GetItemX(whichItem), GetItemY(whichItem))
end

---@param trig trigger
function ConditionalTriggerExecute(trig)
	if TriggerEvaluate(trig) then
		TriggerExecute(trig)
	end
end

---@param trig trigger
---@param checkConditions boolean
---@return boolean
function TriggerExecuteBJ(trig, checkConditions)
	if checkConditions then
		if not (TriggerEvaluate(trig)) then
			return false
		end
	end
	TriggerExecute(trig)
	return true
end

---@param trig trigger
---@param checkConditions boolean
---@return boolean
function PostTriggerExecuteBJ(trig, checkConditions)
	if checkConditions then
		if not (TriggerEvaluate(trig)) then
			return false
		end
	end
	TriggerRegisterTimerEvent(trig, 0, false)
	return true
end

function QueuedTriggerCheck()
	local s = "TrigQueue Check " ---@type string
	local i ---@type number integer
	i = 0
	while(true) do
		if (i >= bj_queuedExecTotal) then break end
		s = s .. "q[" .. I2S(i) .. "]="
		if (bj_queuedExecTriggers[i] == nil) then
			s = s .. "null "
		else
			s = s .. "x "
		end
		i = i + 1
	end
	s = s .. "(" .. I2S(bj_queuedExecTotal) .. " total)"
	DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, 600, s)
end

---@param trig trigger
---@return number integer
function QueuedTriggerGetIndex(trig)
	local index = 0 ---@type number integer
	while(true) do
		if (index >= bj_queuedExecTotal) then break end
		if (bj_queuedExecTriggers[index] == trig) then
			return index
		end
		index = index + 1
	end
	return -1
end

---@param trigIndex number integer
---@return boolean
function QueuedTriggerRemoveByIndex(trigIndex)
	local index ---@type number integer
	if (trigIndex >= bj_queuedExecTotal) then
		return false
	end
	bj_queuedExecTotal = bj_queuedExecTotal - 1
	index = trigIndex
	while(true) do
		if (index >= bj_queuedExecTotal) then break end
		bj_queuedExecTriggers[index] = bj_queuedExecTriggers[index + 1]
		bj_queuedExecUseConds[index] = bj_queuedExecUseConds[index + 1]
		index = index + 1
	end
	return true
end

---@return boolean
function QueuedTriggerAttemptExec()
	while(true) do
		if (bj_queuedExecTotal == 0) then break end
		if TriggerExecuteBJ(bj_queuedExecTriggers[0], bj_queuedExecUseConds[0]) then
			TimerStart(bj_queuedExecTimeoutTimer, bj_QUEUED_TRIGGER_TIMEOUT, false, nil)
			return true
		end
		QueuedTriggerRemoveByIndex(0)
	end
	return false
end

---@param trig trigger
---@param checkConditions boolean
---@return boolean
function QueuedTriggerAddBJ(trig, checkConditions)
	if (bj_queuedExecTotal >= bj_MAX_QUEUED_TRIGGERS) then
		return false
	end
	bj_queuedExecTriggers[bj_queuedExecTotal] = trig
	bj_queuedExecUseConds[bj_queuedExecTotal] = checkConditions
	bj_queuedExecTotal = bj_queuedExecTotal + 1
	if (bj_queuedExecTotal == 1) then
		QueuedTriggerAttemptExec()
	end
	return true
end

---@param trig trigger
function QueuedTriggerRemoveBJ(trig)
	local index ---@type number integer
	local trigIndex ---@type number integer
	local trigExecuted ---@type boolean
	trigIndex = QueuedTriggerGetIndex(trig)
	if (trigIndex == -1) then
		return
	end
	QueuedTriggerRemoveByIndex(trigIndex)
	if (trigIndex == 0) then
		PauseTimer(bj_queuedExecTimeoutTimer)
		QueuedTriggerAttemptExec()
	end
end

function QueuedTriggerDoneBJ()
	local index ---@type number integer
	if (bj_queuedExecTotal <= 0) then
		return
	end
	QueuedTriggerRemoveByIndex(0)
	PauseTimer(bj_queuedExecTimeoutTimer)
	QueuedTriggerAttemptExec()
end

function QueuedTriggerClearBJ()
	PauseTimer(bj_queuedExecTimeoutTimer)
	bj_queuedExecTotal = 0
end

function QueuedTriggerClearInactiveBJ()
	bj_queuedExecTotal = IMinBJ(bj_queuedExecTotal, 1)
end

---@return number integer
function QueuedTriggerCountBJ()
	return bj_queuedExecTotal
end

---@return boolean
function IsTriggerQueueEmptyBJ()
	return bj_queuedExecTotal <= 0
end

---@param trig trigger
---@return boolean
function IsTriggerQueuedBJ(trig)
	return QueuedTriggerGetIndex(trig) ~= -1
end

---@return number integer
function GetForLoopIndexA()
	return bj_forLoopAIndex
end

---@param newIndex number integer
function SetForLoopIndexA(newIndex)
	bj_forLoopAIndex = newIndex
end

---@return number integer
function GetForLoopIndexB()
	return bj_forLoopBIndex
end

---@param newIndex number integer
function SetForLoopIndexB(newIndex)
	bj_forLoopBIndex = newIndex
end

---@param duration number real
function PolledWait(duration)
	local t ---@type timer
	local timeRemaining ---@type number real
	if (duration > 0) then
		t = CreateTimer()
		TimerStart(t, duration, false, nil)
		while(true) do
			timeRemaining = TimerGetRemaining(t)
			if (timeRemaining <= 0) then break end
			if (timeRemaining > bj_POLLED_WAIT_SKIP_THRESHOLD) then
				TriggerSleepAction(0.1 * timeRemaining)
			else
				TriggerSleepAction(bj_POLLED_WAIT_INTERVAL)
			end
		end
		DestroyTimer(t)
	end
end

---@param flag boolean
---@param valueA number integer
---@param valueB number integer
---@return number integer
function IntegerTertiaryOp(flag, valueA, valueB)
	if flag then
		return valueA
	else
		return valueB
	end
end

function DoNothing()
end

---@param commentString string
function CommentString(commentString)
end

---@param theString string
---@return string
function StringIdentity(theString)
	return GetLocalizedString(theString)
end

---@param valueA boolean
---@param valueB boolean
---@return boolean
function GetBooleanAnd(valueA, valueB)
	return valueA and valueB
end

---@param valueA boolean
---@param valueB boolean
---@return boolean
function GetBooleanOr(valueA, valueB)
	return valueA or valueB
end

---@param percentage number real
---@param max number integer
---@return number integer
function PercentToInt(percentage, max)
	local result = R2I(percentage * I2R(max) * 0.01) ---@type number integer
	if (result < 0) then
		result = 0
	elseif (result < 0) then
		result = max
	end
	return result
end

---@param percentage number real
---@return number integer
function PercentTo255(percentage)
	return PercentToInt(percentage, 255)
end

---@return number real
function GetTimeOfDay()
	return GetFloatGameState(GAME_STATE_TIME_OF_DAY)
end

---@param whatTime number real
function SetTimeOfDay(whatTime)
	SetFloatGameState(GAME_STATE_TIME_OF_DAY, whatTime)
end

---@param scalePercent number real
function SetTimeOfDayScalePercentBJ(scalePercent)
	SetTimeOfDayScale(scalePercent * 0.01)
end

---@return number real
function GetTimeOfDayScalePercentBJ()
	return GetTimeOfDayScale() * 100
end

---@param soundName string
function PlaySound(soundName)
	local soundHandle = CreateSound(soundName, false, false, true, 12700, 12700, "") ---@type sound
	StartSound(soundHandle)
	KillSoundWhenDone(soundHandle)
end

---@param A location
---@param B location
---@return boolean
function CompareLocationsBJ(A, B)
	return GetLocationX(A) == GetLocationX(B) and GetLocationY(A) == GetLocationY(B)
end

---@param A rect
---@param B rect
---@return boolean
function CompareRectsBJ(A, B)
	return GetRectMinX(A) == GetRectMinX(B) and GetRectMinY(A) == GetRectMinY(B) and GetRectMaxX(A) == GetRectMaxX(B) and GetRectMaxY(A) == GetRectMaxY(B)
end

---@param center location
---@param radius number real
---@return rect
function GetRectFromCircleBJ(center, radius)
	local centerX = GetLocationX(center) ---@type number real
	local centerY = GetLocationY(center) ---@type number real
	return Rect(centerX - radius, centerY - radius, centerX + radius, centerY + radius)
end

---@return camerasetup
function GetCurrentCameraSetup()
	local theCam = CreateCameraSetup() ---@type camerasetup
	local duration = 0 ---@type number real
	CameraSetupSetField(theCam, CAMERA_FIELD_TARGET_DISTANCE, GetCameraField(CAMERA_FIELD_TARGET_DISTANCE), duration)
	CameraSetupSetField(theCam, CAMERA_FIELD_FARZ, GetCameraField(CAMERA_FIELD_FARZ), duration)
	CameraSetupSetField(theCam, CAMERA_FIELD_ZOFFSET, GetCameraField(CAMERA_FIELD_ZOFFSET), duration)
	CameraSetupSetField(theCam, CAMERA_FIELD_ANGLE_OF_ATTACK, bj_RADTODEG * GetCameraField(CAMERA_FIELD_ANGLE_OF_ATTACK), duration)
	CameraSetupSetField(theCam, CAMERA_FIELD_FIELD_OF_VIEW, bj_RADTODEG * GetCameraField(CAMERA_FIELD_FIELD_OF_VIEW), duration)
	CameraSetupSetField(theCam, CAMERA_FIELD_ROLL, bj_RADTODEG * GetCameraField(CAMERA_FIELD_ROLL), duration)
	CameraSetupSetField(theCam, CAMERA_FIELD_ROTATION, bj_RADTODEG * GetCameraField(CAMERA_FIELD_ROTATION), duration)
	CameraSetupSetDestPosition(theCam, GetCameraTargetPositionX(), GetCameraTargetPositionY(), duration)
	return theCam
end

---@param doPan boolean
---@param whichSetup camerasetup
---@param whichPlayer player
---@param duration number real
function CameraSetupApplyForPlayer(doPan, whichSetup, whichPlayer, duration)
	if (GetLocalPlayer() == whichPlayer) then
		CameraSetupApplyForceDuration(whichSetup, doPan, duration)
	end
end

---@param whichField camerafield
---@param whichSetup camerasetup
---@return number real
function CameraSetupGetFieldSwap(whichField, whichSetup)
	return CameraSetupGetField(whichSetup, whichField)
end

---@param whichPlayer player
---@param whichField camerafield
---@param value number real
---@param duration number real
function SetCameraFieldForPlayer(whichPlayer, whichField, value, duration)
	if (GetLocalPlayer() == whichPlayer) then
		SetCameraField(whichField, value, duration)
	end
end

---@param whichPlayer player
---@param whichUnit unit
---@param xoffset number real
---@param yoffset number real
---@param inheritOrientation boolean
function SetCameraTargetControllerNoZForPlayer(whichPlayer, whichUnit, xoffset, yoffset, inheritOrientation)
	if (GetLocalPlayer() == whichPlayer) then
		SetCameraTargetController(whichUnit, xoffset, yoffset, inheritOrientation)
	end
end

---@param whichPlayer player
---@param x number real
---@param y number real
function SetCameraPositionForPlayer(whichPlayer, x, y)
	if (GetLocalPlayer() == whichPlayer) then
		SetCameraPosition(x, y)
	end
end

---@param whichPlayer player
---@param loc location
function SetCameraPositionLocForPlayer(whichPlayer, loc)
	if (GetLocalPlayer() == whichPlayer) then
		SetCameraPosition(GetLocationX(loc), GetLocationY(loc))
	end
end

---@param degrees number real
---@param loc location
---@param whichPlayer player
---@param duration number real
function RotateCameraAroundLocBJ(degrees, loc, whichPlayer, duration)
	if (GetLocalPlayer() == whichPlayer) then
		SetCameraRotateMode(GetLocationX(loc), GetLocationY(loc), bj_DEGTORAD * degrees, duration)
	end
end

---@param whichPlayer player
---@param x number real
---@param y number real
function PanCameraToForPlayer(whichPlayer, x, y)
	if (GetLocalPlayer() == whichPlayer) then
		PanCameraTo(x, y)
	end
end

---@param whichPlayer player
---@param loc location
function PanCameraToLocForPlayer(whichPlayer, loc)
	if (GetLocalPlayer() == whichPlayer) then
		PanCameraTo(GetLocationX(loc), GetLocationY(loc))
	end
end

---@param whichPlayer player
---@param x number real
---@param y number real
---@param duration number real
function PanCameraToTimedForPlayer(whichPlayer, x, y, duration)
	if (GetLocalPlayer() == whichPlayer) then
		PanCameraToTimed(x, y, duration)
	end
end

---@param whichPlayer player
---@param loc location
---@param duration number real
function PanCameraToTimedLocForPlayer(whichPlayer, loc, duration)
	if (GetLocalPlayer() == whichPlayer) then
		PanCameraToTimed(GetLocationX(loc), GetLocationY(loc), duration)
	end
end

---@param whichPlayer player
---@param loc location
---@param zOffset number real
---@param duration number real
function PanCameraToTimedLocWithZForPlayer(whichPlayer, loc, zOffset, duration)
	if (GetLocalPlayer() == whichPlayer) then
		PanCameraToTimedWithZ(GetLocationX(loc), GetLocationY(loc), zOffset, duration)
	end
end

---@param whichPlayer player
---@param loc location
---@param duration number real
function SmartCameraPanBJ(whichPlayer, loc, duration)
	local dist ---@type number real
	if (GetLocalPlayer() == whichPlayer) then
		dist = DistanceBetweenPoints(loc, GetCameraTargetPositionLoc())
		if (dist >= bj_SMARTPAN_TRESHOLD_SNAP) then
			PanCameraToTimed(GetLocationX(loc), GetLocationY(loc), 0)
		elseif (dist >= bj_SMARTPAN_TRESHOLD_SNAP) then
			PanCameraToTimed(GetLocationX(loc), GetLocationY(loc), duration)
		else
		end
	end
end

---@param whichPlayer player
---@param cameraModelFile string
function SetCinematicCameraForPlayer(whichPlayer, cameraModelFile)
	if (GetLocalPlayer() == whichPlayer) then
		SetCinematicCamera(cameraModelFile)
	end
end

---@param whichPlayer player
---@param duration number real
function ResetToGameCameraForPlayer(whichPlayer, duration)
	if (GetLocalPlayer() == whichPlayer) then
		ResetToGameCamera(duration)
	end
end

---@param whichPlayer player
---@param magnitude number real
---@param velocity number real
function CameraSetSourceNoiseForPlayer(whichPlayer, magnitude, velocity)
	if (GetLocalPlayer() == whichPlayer) then
		CameraSetSourceNoise(magnitude, velocity)
	end
end

---@param whichPlayer player
---@param magnitude number real
---@param velocity number real
function CameraSetTargetNoiseForPlayer(whichPlayer, magnitude, velocity)
	if (GetLocalPlayer() == whichPlayer) then
		CameraSetTargetNoise(magnitude, velocity)
	end
end

---@param whichPlayer player
---@param magnitude number real
function CameraSetEQNoiseForPlayer(whichPlayer, magnitude)
	local richter = magnitude ---@type number real
	if (richter > 5.0) then
		richter = 5.0
	end
	if (richter < 2.0) then
		richter = 2.0
	end
	if (GetLocalPlayer() == whichPlayer) then
		CameraSetTargetNoiseEx(magnitude * 2.0, magnitude * Pow(10, richter), true)
		CameraSetSourceNoiseEx(magnitude * 2.0, magnitude * Pow(10, richter), true)
	end
end

---@param whichPlayer player
function CameraClearNoiseForPlayer(whichPlayer)
	if (GetLocalPlayer() == whichPlayer) then
		CameraSetSourceNoise(0, 0)
		CameraSetTargetNoise(0, 0)
	end
end

---@return rect
function GetCurrentCameraBoundsMapRectBJ()
	return Rect(GetCameraBoundMinX(), GetCameraBoundMinY(), GetCameraBoundMaxX(), GetCameraBoundMaxY())
end

---@return rect
function GetCameraBoundsMapRect()
	return bj_mapInitialCameraBounds
end

---@return rect
function GetPlayableMapRect()
	return bj_mapInitialPlayableArea
end

---@return rect
function GetEntireMapRect()
	return GetWorldBounds()
end

---@param r rect
function SetCameraBoundsToRect(r)
	local minX = GetRectMinX(r) ---@type number real
	local minY = GetRectMinY(r) ---@type number real
	local maxX = GetRectMaxX(r) ---@type number real
	local maxY = GetRectMaxY(r) ---@type number real
	SetCameraBounds(minX, minY, minX, maxY, maxX, maxY, maxX, minY)
end

---@param whichPlayer player
---@param r rect
function SetCameraBoundsToRectForPlayerBJ(whichPlayer, r)
	if (GetLocalPlayer() == whichPlayer) then
		SetCameraBoundsToRect(r)
	end
end

---@param adjustMethod number integer
---@param dxWest number real
---@param dxEast number real
---@param dyNorth number real
---@param dySouth number real
function AdjustCameraBoundsBJ(adjustMethod, dxWest, dxEast, dyNorth, dySouth)
	local minX = 0 ---@type number real
	local minY = 0 ---@type number real
	local maxX = 0 ---@type number real
	local maxY = 0 ---@type number real
	local scale = 0 ---@type number real
	if (adjustMethod == bj_CAMERABOUNDS_ADJUST_ADD) then
		scale = 1
	elseif (adjustMethod == bj_CAMERABOUNDS_ADJUST_ADD) then
		scale = -1
	else
		return
	end
	minX = GetCameraBoundMinX() - scale * dxWest
	maxX = GetCameraBoundMaxX() + scale * dxEast
	minY = GetCameraBoundMinY() - scale * dySouth
	maxY = GetCameraBoundMaxY() + scale * dyNorth
	if (maxX < minX) then
		minX = (minX + maxX) * 0.5
		maxX = minX
	end
	if (maxY < minY) then
		minY = (minY + maxY) * 0.5
		maxY = minY
	end
	SetCameraBounds(minX, minY, minX, maxY, maxX, maxY, maxX, minY)
end

---@param adjustMethod number integer
---@param whichPlayer player
---@param dxWest number real
---@param dxEast number real
---@param dyNorth number real
---@param dySouth number real
function AdjustCameraBoundsForPlayerBJ(adjustMethod, whichPlayer, dxWest, dxEast, dyNorth, dySouth)
	if (GetLocalPlayer() == whichPlayer) then
		AdjustCameraBoundsBJ(adjustMethod, dxWest, dxEast, dyNorth, dySouth)
	end
end

---@param whichPlayer player
---@param x number real
---@param y number real
function SetCameraQuickPositionForPlayer(whichPlayer, x, y)
	if (GetLocalPlayer() == whichPlayer) then
		SetCameraQuickPosition(x, y)
	end
end

---@param whichPlayer player
---@param loc location
function SetCameraQuickPositionLocForPlayer(whichPlayer, loc)
	if (GetLocalPlayer() == whichPlayer) then
		SetCameraQuickPosition(GetLocationX(loc), GetLocationY(loc))
	end
end

---@param loc location
function SetCameraQuickPositionLoc(loc)
	SetCameraQuickPosition(GetLocationX(loc), GetLocationY(loc))
end

---@param whichPlayer player
function StopCameraForPlayerBJ(whichPlayer)
	if (GetLocalPlayer() == whichPlayer) then
		StopCamera()
	end
end

---@param whichPlayer player
---@param whichUnit unit
---@param xoffset number real
---@param yoffset number real
function SetCameraOrientControllerForPlayerBJ(whichPlayer, whichUnit, xoffset, yoffset)
	if (GetLocalPlayer() == whichPlayer) then
		SetCameraOrientController(whichUnit, xoffset, yoffset)
	end
end

---@param factor number real
function CameraSetSmoothingFactorBJ(factor)
	CameraSetSmoothingFactor(factor)
end

function CameraResetSmoothingFactorBJ()
	CameraSetSmoothingFactor(0)
end

---@param toForce force
---@param message string
function DisplayTextToForce(toForce, message)
	if (IsPlayerInForce(GetLocalPlayer(), toForce)) then
		DisplayTextToPlayer(GetLocalPlayer(), 0, 0, message)
	end
end

---@param toForce force
---@param duration number real
---@param message string
function DisplayTimedTextToForce(toForce, duration, message)
	if (IsPlayerInForce(GetLocalPlayer(), toForce)) then
		DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, duration, message)
	end
end

---@param toForce force
function ClearTextMessagesBJ(toForce)
	if (IsPlayerInForce(GetLocalPlayer(), toForce)) then
		ClearTextMessages()
	end
end

---@param source string
---@param start number integer
---@param kp number integer
---@return string
function SubStringBJ(source, start, kp)
	return SubString(source, start - 1, kp)
end

---@param h handle
---@return number integer
function GetHandleIdBJ(h)
	return GetHandleId(h)
end

---@param s string
---@return number integer
function StringHashBJ(s)
	return StringHash(s)
end

---@param trig trigger
---@param timeout number real
---@return event
function TriggerRegisterTimerEventPeriodic(trig, timeout)
	return TriggerRegisterTimerEvent(trig, timeout, true)
end

---@param trig trigger
---@param timeout number real
---@return event
function TriggerRegisterTimerEventSingle(trig, timeout)
	return TriggerRegisterTimerEvent(trig, timeout, false)
end

---@param trig trigger
---@param t timer
---@return event
function TriggerRegisterTimerExpireEventBJ(trig, t)
	return TriggerRegisterTimerExpireEvent(trig, t)
end

---@param trig trigger
---@param whichPlayer player
---@param whichEvent playerunitevent
---@return event
function TriggerRegisterPlayerUnitEventSimple(trig, whichPlayer, whichEvent)
	return TriggerRegisterPlayerUnitEvent(trig, whichPlayer, whichEvent, nil)
end

---@param trig trigger
---@param whichEvent playerunitevent
function TriggerRegisterAnyUnitEventBJ(trig, whichEvent)
	local index ---@type number integer
	index = 0
	while(true) do
		TriggerRegisterPlayerUnitEvent(trig, Player(index), whichEvent, nil)
		index = index + 1
		if (index == bj_MAX_PLAYER_SLOTS) then break end
	end
end

---@param trig trigger
---@param whichPlayer player
---@param selected boolean
---@return event
function TriggerRegisterPlayerSelectionEventBJ(trig, whichPlayer, selected)
	if selected then
		return TriggerRegisterPlayerUnitEvent(trig, whichPlayer, EVENT_PLAYER_UNIT_SELECTED, nil)
	else
		return TriggerRegisterPlayerUnitEvent(trig, whichPlayer, EVENT_PLAYER_UNIT_DESELECTED, nil)
	end
end

---@param trig trigger
---@param whichPlayer player
---@param keType number integer
---@param keKey number integer
---@return event
function TriggerRegisterPlayerKeyEventBJ(trig, whichPlayer, keType, keKey)
	if (keType == bj_KEYEVENTTYPE_DEPRESS) then
		if (keKey == bj_KEYEVENTKEY_LEFT) then
			return TriggerRegisterPlayerEvent(trig, whichPlayer, EVENT_PLAYER_ARROW_LEFT_DOWN)
		elseif (keKey == bj_KEYEVENTKEY_LEFT) then
			return TriggerRegisterPlayerEvent(trig, whichPlayer, EVENT_PLAYER_ARROW_RIGHT_DOWN)
		elseif (keKey == bj_KEYEVENTKEY_LEFT) then
			return TriggerRegisterPlayerEvent(trig, whichPlayer, EVENT_PLAYER_ARROW_DOWN_DOWN)
		elseif (keKey == bj_KEYEVENTKEY_LEFT) then
			return TriggerRegisterPlayerEvent(trig, whichPlayer, EVENT_PLAYER_ARROW_UP_DOWN)
		else
			return nil
		end
	elseif (keType == bj_KEYEVENTTYPE_DEPRESS) then
		if (keKey == bj_KEYEVENTKEY_LEFT) then
			return TriggerRegisterPlayerEvent(trig, whichPlayer, EVENT_PLAYER_ARROW_LEFT_UP)
		elseif (keKey == bj_KEYEVENTKEY_LEFT) then
			return TriggerRegisterPlayerEvent(trig, whichPlayer, EVENT_PLAYER_ARROW_RIGHT_UP)
		elseif (keKey == bj_KEYEVENTKEY_LEFT) then
			return TriggerRegisterPlayerEvent(trig, whichPlayer, EVENT_PLAYER_ARROW_DOWN_UP)
		elseif (keKey == bj_KEYEVENTKEY_LEFT) then
			return TriggerRegisterPlayerEvent(trig, whichPlayer, EVENT_PLAYER_ARROW_UP_UP)
		else
			return nil
		end
	else
		return nil
	end
end

---@param trig trigger
---@param whichPlayer player
---@return event
function TriggerRegisterPlayerEventVictory(trig, whichPlayer)
	return TriggerRegisterPlayerEvent(trig, whichPlayer, EVENT_PLAYER_VICTORY)
end

---@param trig trigger
---@param whichPlayer player
---@return event
function TriggerRegisterPlayerEventDefeat(trig, whichPlayer)
	return TriggerRegisterPlayerEvent(trig, whichPlayer, EVENT_PLAYER_DEFEAT)
end

---@param trig trigger
---@param whichPlayer player
---@return event
function TriggerRegisterPlayerEventLeave(trig, whichPlayer)
	return TriggerRegisterPlayerEvent(trig, whichPlayer, EVENT_PLAYER_LEAVE)
end

---@param trig trigger
---@param whichPlayer player
---@return event
function TriggerRegisterPlayerEventAllianceChanged(trig, whichPlayer)
	return TriggerRegisterPlayerEvent(trig, whichPlayer, EVENT_PLAYER_ALLIANCE_CHANGED)
end

---@param trig trigger
---@param whichPlayer player
---@return event
function TriggerRegisterPlayerEventEndCinematic(trig, whichPlayer)
	return TriggerRegisterPlayerEvent(trig, whichPlayer, EVENT_PLAYER_END_CINEMATIC)
end

---@param trig trigger
---@param opcode limitop
---@param limitval number real
---@return event
function TriggerRegisterGameStateEventTimeOfDay(trig, opcode, limitval)
	return TriggerRegisterGameStateEvent(trig, GAME_STATE_TIME_OF_DAY, opcode, limitval)
end

---@param trig trigger
---@param whichRegion region
---@return event
function TriggerRegisterEnterRegionSimple(trig, whichRegion)
	return TriggerRegisterEnterRegion(trig, whichRegion, nil)
end

---@param trig trigger
---@param whichRegion region
---@return event
function TriggerRegisterLeaveRegionSimple(trig, whichRegion)
	return TriggerRegisterLeaveRegion(trig, whichRegion, nil)
end

---@param trig trigger
---@param r rect
---@return event
function TriggerRegisterEnterRectSimple(trig, r)
	local rectRegion = CreateRegion() ---@type region
	RegionAddRect(rectRegion, r)
	return TriggerRegisterEnterRegion(trig, rectRegion, nil)
end

---@param trig trigger
---@param r rect
---@return event
function TriggerRegisterLeaveRectSimple(trig, r)
	local rectRegion = CreateRegion() ---@type region
	RegionAddRect(rectRegion, r)
	return TriggerRegisterLeaveRegion(trig, rectRegion, nil)
end

---@param trig trigger
---@param whichUnit unit
---@param condition boolexpr
---@param range number real
---@return event
function TriggerRegisterDistanceBetweenUnits(trig, whichUnit, condition, range)
	return TriggerRegisterUnitInRange(trig, whichUnit, range, condition)
end

---@param trig trigger
---@param range number real
---@param whichUnit unit
---@return event
function TriggerRegisterUnitInRangeSimple(trig, range, whichUnit)
	return TriggerRegisterUnitInRange(trig, whichUnit, range, nil)
end

---@param trig trigger
---@param whichUnit unit
---@param opcode limitop
---@param limitval number real
---@return event
function TriggerRegisterUnitLifeEvent(trig, whichUnit, opcode, limitval)
	return TriggerRegisterUnitStateEvent(trig, whichUnit, UNIT_STATE_LIFE, opcode, limitval)
end

---@param trig trigger
---@param whichUnit unit
---@param opcode limitop
---@param limitval number real
---@return event
function TriggerRegisterUnitManaEvent(trig, whichUnit, opcode, limitval)
	return TriggerRegisterUnitStateEvent(trig, whichUnit, UNIT_STATE_MANA, opcode, limitval)
end

---@param trig trigger
---@param whichDialog dialog
---@return event
function TriggerRegisterDialogEventBJ(trig, whichDialog)
	return TriggerRegisterDialogEvent(trig, whichDialog)
end

---@param trig trigger
---@return event
function TriggerRegisterShowSkillEventBJ(trig)
	return TriggerRegisterGameEvent(trig, EVENT_GAME_SHOW_SKILL)
end

---@param trig trigger
---@return event
function TriggerRegisterBuildSubmenuEventBJ(trig)
	return TriggerRegisterGameEvent(trig, EVENT_GAME_BUILD_SUBMENU)
end

---@param trig trigger
---@return event
function TriggerRegisterGameLoadedEventBJ(trig)
	return TriggerRegisterGameEvent(trig, EVENT_GAME_LOADED)
end

---@param trig trigger
---@return event
function TriggerRegisterGameSavedEventBJ(trig)
	return TriggerRegisterGameEvent(trig, EVENT_GAME_SAVE)
end

function RegisterDestDeathInRegionEnum()
	bj_destInRegionDiesCount = bj_destInRegionDiesCount + 1
	if (bj_destInRegionDiesCount <= bj_MAX_DEST_IN_REGION_EVENTS) then
		TriggerRegisterDeathEvent(bj_destInRegionDiesTrig, GetEnumDestructable())
	end
end

---@param trig trigger
---@param r rect
function TriggerRegisterDestDeathInRegionEvent(trig, r)
	bj_destInRegionDiesTrig = trig
	bj_destInRegionDiesCount = 0
	EnumDestructablesInRect(r, nil, RegisterDestDeathInRegionEnum)
end

---@param where rect
---@param effectID number integer
---@return weathereffect
function AddWeatherEffectSaveLast(where, effectID)
	bj_lastCreatedWeatherEffect = AddWeatherEffect(where, effectID)
	return bj_lastCreatedWeatherEffect
end

---@return weathereffect
function GetLastCreatedWeatherEffect()
	return bj_lastCreatedWeatherEffect
end

---@param whichWeatherEffect weathereffect
function RemoveWeatherEffectBJ(whichWeatherEffect)
	RemoveWeatherEffect(whichWeatherEffect)
end

---@param duration number real
---@param permanent boolean
---@param where location
---@param radius number real
---@param depth number real
---@return terraindeformation
function TerrainDeformationCraterBJ(duration, permanent, where, radius, depth)
	bj_lastCreatedTerrainDeformation = TerrainDeformCrater(GetLocationX(where), GetLocationY(where), radius, depth, R2I(duration * 1000), permanent)
	return bj_lastCreatedTerrainDeformation
end

---@param duration number real
---@param limitNeg boolean
---@param where location
---@param startRadius number real
---@param endRadius number real
---@param depth number real
---@param wavePeriod number real
---@param waveWidth number real
---@return terraindeformation
function TerrainDeformationRippleBJ(duration, limitNeg, where, startRadius, endRadius, depth, wavePeriod, waveWidth)
	local spaceWave ---@type number real
	local timeWave ---@type number real
	local radiusRatio ---@type number real
	if (endRadius <= 0 or waveWidth <= 0 or wavePeriod <= 0) then
		return nil
	end
	timeWave = 2.0 * duration / wavePeriod
	spaceWave = 2.0 * endRadius / waveWidth
	radiusRatio = startRadius / endRadius
	bj_lastCreatedTerrainDeformation = TerrainDeformRipple(GetLocationX(where), GetLocationY(where), endRadius, depth, R2I(duration * 1000), 1, spaceWave, timeWave, radiusRatio, limitNeg)
	return bj_lastCreatedTerrainDeformation
end

---@param duration number real
---@param source location
---@param target location
---@param radius number real
---@param depth number real
---@param trailDelay number real
---@return terraindeformation
function TerrainDeformationWaveBJ(duration, source, target, radius, depth, trailDelay)
	local distance ---@type number real
	local dirX ---@type number real
	local dirY ---@type number real
	local speed ---@type number real
	distance = DistanceBetweenPoints(source, target)
	if (distance == 0 or duration <= 0) then
		return nil
	end
	dirX = (GetLocationX(target) - GetLocationX(source)) / distance
	dirY = (GetLocationY(target) - GetLocationY(source)) / distance
	speed = distance / duration
	bj_lastCreatedTerrainDeformation = TerrainDeformWave(GetLocationX(source), GetLocationY(source), dirX, dirY, distance, speed, radius, depth, R2I(trailDelay * 1000), 1)
	return bj_lastCreatedTerrainDeformation
end

---@param duration number real
---@param where location
---@param radius number real
---@param minDelta number real
---@param maxDelta number real
---@param updateInterval number real
---@return terraindeformation
function TerrainDeformationRandomBJ(duration, where, radius, minDelta, maxDelta, updateInterval)
	bj_lastCreatedTerrainDeformation = TerrainDeformRandom(GetLocationX(where), GetLocationY(where), radius, minDelta, maxDelta, R2I(duration * 1000), R2I(updateInterval * 1000))
	return bj_lastCreatedTerrainDeformation
end

---@param deformation terraindeformation
---@param duration number real
function TerrainDeformationStopBJ(deformation, duration)
	TerrainDeformStop(deformation, R2I(duration * 1000))
end

---@return terraindeformation
function GetLastCreatedTerrainDeformation()
	return bj_lastCreatedTerrainDeformation
end

---@param codeName string
---@param where1 location
---@param where2 location
---@return lightning
function AddLightningLoc(codeName, where1, where2)
	bj_lastCreatedLightning = AddLightningEx(codeName, true, GetLocationX(where1), GetLocationY(where1), GetLocationZ(where1), GetLocationX(where2), GetLocationY(where2), GetLocationZ(where2))
	return bj_lastCreatedLightning
end

---@param whichBolt lightning
---@return boolean
function DestroyLightningBJ(whichBolt)
	return DestroyLightning(whichBolt)
end

---@param whichBolt lightning
---@param where1 location
---@param where2 location
---@return boolean
function MoveLightningLoc(whichBolt, where1, where2)
	return MoveLightningEx(whichBolt, true, GetLocationX(where1), GetLocationY(where1), GetLocationZ(where1), GetLocationX(where2), GetLocationY(where2), GetLocationZ(where2))
end

---@param whichBolt lightning
---@return number real
function GetLightningColorABJ(whichBolt)
	return GetLightningColorA(whichBolt)
end

---@param whichBolt lightning
---@return number real
function GetLightningColorRBJ(whichBolt)
	return GetLightningColorR(whichBolt)
end

---@param whichBolt lightning
---@return number real
function GetLightningColorGBJ(whichBolt)
	return GetLightningColorG(whichBolt)
end

---@param whichBolt lightning
---@return number real
function GetLightningColorBBJ(whichBolt)
	return GetLightningColorB(whichBolt)
end

---@param whichBolt lightning
---@param r number real
---@param g number real
---@param b number real
---@param a number real
---@return boolean
function SetLightningColorBJ(whichBolt, r, g, b, a)
	return SetLightningColor(whichBolt, r, g, b, a)
end

---@return lightning
function GetLastCreatedLightningBJ()
	return bj_lastCreatedLightning
end

---@param abilcode number integer
---@param t effecttype
---@param index number integer
---@return string
function GetAbilityEffectBJ(abilcode, t, index)
	return GetAbilityEffectById(abilcode, t, index)
end

---@param abilcode number integer
---@param t soundtype
---@return string
function GetAbilitySoundBJ(abilcode, t)
	return GetAbilitySoundById(abilcode, t)
end

---@param where location
---@return number integer
function GetTerrainCliffLevelBJ(where)
	return GetTerrainCliffLevel(GetLocationX(where), GetLocationY(where))
end

---@param where location
---@return number integer
function GetTerrainTypeBJ(where)
	return GetTerrainType(GetLocationX(where), GetLocationY(where))
end

---@param where location
---@return number integer
function GetTerrainVarianceBJ(where)
	return GetTerrainVariance(GetLocationX(where), GetLocationY(where))
end

---@param where location
---@param terrainType number integer
---@param variation number integer
---@param area number integer
---@param shape number integer
function SetTerrainTypeBJ(where, terrainType, variation, area, shape)
	SetTerrainType(GetLocationX(where), GetLocationY(where), terrainType, variation, area, shape)
end

---@param where location
---@param t pathingtype
---@return boolean
function IsTerrainPathableBJ(where, t)
	return IsTerrainPathable(GetLocationX(where), GetLocationY(where), t)
end

---@param where location
---@param t pathingtype
---@param flag boolean
function SetTerrainPathableBJ(where, t, flag)
	SetTerrainPathable(GetLocationX(where), GetLocationY(where), t, flag)
end

---@param red number real
---@param green number real
---@param blue number real
---@param transparency number real
function SetWaterBaseColorBJ(red, green, blue, transparency)
	SetWaterBaseColor(PercentTo255(red), PercentTo255(green), PercentTo255(blue), PercentTo255(100.0 - transparency))
end

---@param whichPlayer player
---@param whichFogState fogstate
---@param r rect
---@param afterUnits boolean
---@return fogmodifier
function CreateFogModifierRectSimple(whichPlayer, whichFogState, r, afterUnits)
	bj_lastCreatedFogModifier = CreateFogModifierRect(whichPlayer, whichFogState, r, true, afterUnits)
	return bj_lastCreatedFogModifier
end

---@param whichPlayer player
---@param whichFogState fogstate
---@param center location
---@param radius number real
---@param afterUnits boolean
---@return fogmodifier
function CreateFogModifierRadiusLocSimple(whichPlayer, whichFogState, center, radius, afterUnits)
	bj_lastCreatedFogModifier = CreateFogModifierRadiusLoc(whichPlayer, whichFogState, center, radius, true, afterUnits)
	return bj_lastCreatedFogModifier
end

---@param enabled boolean
---@param whichPlayer player
---@param whichFogState fogstate
---@param r rect
---@return fogmodifier
function CreateFogModifierRectBJ(enabled, whichPlayer, whichFogState, r)
	bj_lastCreatedFogModifier = CreateFogModifierRect(whichPlayer, whichFogState, r, true, false)
	if enabled then
		FogModifierStart(bj_lastCreatedFogModifier)
	end
	return bj_lastCreatedFogModifier
end

---@param enabled boolean
---@param whichPlayer player
---@param whichFogState fogstate
---@param center location
---@param radius number real
---@return fogmodifier
function CreateFogModifierRadiusLocBJ(enabled, whichPlayer, whichFogState, center, radius)
	bj_lastCreatedFogModifier = CreateFogModifierRadiusLoc(whichPlayer, whichFogState, center, radius, true, false)
	if enabled then
		FogModifierStart(bj_lastCreatedFogModifier)
	end
	return bj_lastCreatedFogModifier
end

---@return fogmodifier
function GetLastCreatedFogModifier()
	return bj_lastCreatedFogModifier
end

function FogEnableOn()
	FogEnable(true)
end

function FogEnableOff()
	FogEnable(false)
end

function FogMaskEnableOn()
	FogMaskEnable(true)
end

function FogMaskEnableOff()
	FogMaskEnable(false)
end

---@param flag boolean
function UseTimeOfDayBJ(flag)
	SuspendTimeOfDay(not flag)
end

---@param style number integer
---@param zstart number real
---@param zend number real
---@param density number real
---@param red number real
---@param green number real
---@param blue number real
function SetTerrainFogExBJ(style, zstart, zend, density, red, green, blue)
	SetTerrainFogEx(style, zstart, zend, density, red * 0.01, green * 0.01, blue * 0.01)
end

function ResetTerrainFogBJ()
	ResetTerrainFog()
end

---@param animName string
---@param doodadID number integer
---@param radius number real
---@param center location
function SetDoodadAnimationBJ(animName, doodadID, radius, center)
	SetDoodadAnimation(GetLocationX(center), GetLocationY(center), radius, doodadID, false, animName, false)
end

---@param animName string
---@param doodadID number integer
---@param r rect
function SetDoodadAnimationRectBJ(animName, doodadID, r)
	SetDoodadAnimationRect(r, doodadID, animName, false)
end

---@param add boolean
---@param animProperties string
---@param whichUnit unit
function AddUnitAnimationPropertiesBJ(add, animProperties, whichUnit)
	AddUnitAnimationProperties(whichUnit, animProperties, add)
end

---@param file string
---@param size number real
---@param where location
---@param zOffset number real
---@param imageType number integer
---@return image
function CreateImageBJ(file, size, where, zOffset, imageType)
	bj_lastCreatedImage = CreateImage(file, size, size, size, GetLocationX(where), GetLocationY(where), zOffset, 0, 0, 0, imageType)
	return bj_lastCreatedImage
end

---@param flag boolean
---@param whichImage image
function ShowImageBJ(flag, whichImage)
	ShowImage(whichImage, flag)
end

---@param whichImage image
---@param where location
---@param zOffset number real
function SetImagePositionBJ(whichImage, where, zOffset)
	SetImagePosition(whichImage, GetLocationX(where), GetLocationY(where), zOffset)
end

---@param whichImage image
---@param red number real
---@param green number real
---@param blue number real
---@param alpha number real
function SetImageColorBJ(whichImage, red, green, blue, alpha)
	SetImageColor(whichImage, PercentTo255(red), PercentTo255(green), PercentTo255(blue), PercentTo255(100.0 - alpha))
end

---@return image
function GetLastCreatedImage()
	return bj_lastCreatedImage
end

---@param where location
---@param name string
---@param red number real
---@param green number real
---@param blue number real
---@param alpha number real
---@param forcePaused boolean
---@param noBirthTime boolean
---@return ubersplat
function CreateUbersplatBJ(where, name, red, green, blue, alpha, forcePaused, noBirthTime)
	bj_lastCreatedUbersplat = CreateUbersplat(GetLocationX(where), GetLocationY(where), name, PercentTo255(red), PercentTo255(green), PercentTo255(blue), PercentTo255(100.0 - alpha), forcePaused, noBirthTime)
	return bj_lastCreatedUbersplat
end

---@param flag boolean
---@param whichSplat ubersplat
function ShowUbersplatBJ(flag, whichSplat)
	ShowUbersplat(whichSplat, flag)
end

---@return ubersplat
function GetLastCreatedUbersplat()
	return bj_lastCreatedUbersplat
end

---@param soundHandle sound
function PlaySoundBJ(soundHandle)
	bj_lastPlayedSound = soundHandle
	if (soundHandle ~= nil) then
		StartSound(soundHandle)
	end
end

---@param soundHandle sound
---@param fadeOut boolean
function StopSoundBJ(soundHandle, fadeOut)
	StopSound(soundHandle, false, fadeOut)
end

---@param soundHandle sound
---@param volumePercent number real
function SetSoundVolumeBJ(soundHandle, volumePercent)
	SetSoundVolume(soundHandle, PercentToInt(volumePercent, 127))
end

---@param newOffset number real
---@param soundHandle sound
function SetSoundOffsetBJ(newOffset, soundHandle)
	SetSoundPlayPosition(soundHandle, R2I(newOffset * 1000))
end

---@param soundHandle sound
---@param cutoff number real
function SetSoundDistanceCutoffBJ(soundHandle, cutoff)
	SetSoundDistanceCutoff(soundHandle, cutoff)
end

---@param soundHandle sound
---@param pitch number real
function SetSoundPitchBJ(soundHandle, pitch)
	SetSoundPitch(soundHandle, pitch)
end

---@param soundHandle sound
---@param loc location
---@param z number real
function SetSoundPositionLocBJ(soundHandle, loc, z)
	SetSoundPosition(soundHandle, GetLocationX(loc), GetLocationY(loc), z)
end

---@param soundHandle sound
---@param whichUnit unit
function AttachSoundToUnitBJ(soundHandle, whichUnit)
	AttachSoundToUnit(soundHandle, whichUnit)
end

---@param soundHandle sound
---@param inside number real
---@param outside number real
---@param outsideVolumePercent number real
function SetSoundConeAnglesBJ(soundHandle, inside, outside, outsideVolumePercent)
	SetSoundConeAngles(soundHandle, inside, outside, PercentToInt(outsideVolumePercent, 127))
end

---@param soundHandle sound
function KillSoundWhenDoneBJ(soundHandle)
	KillSoundWhenDone(soundHandle)
end

---@param soundHandle sound
---@param volumePercent number real
---@param loc location
---@param z number real
function PlaySoundAtPointBJ(soundHandle, volumePercent, loc, z)
	SetSoundPositionLocBJ(soundHandle, loc, z)
	SetSoundVolumeBJ(soundHandle, volumePercent)
	PlaySoundBJ(soundHandle)
end

---@param soundHandle sound
---@param volumePercent number real
---@param whichUnit unit
function PlaySoundOnUnitBJ(soundHandle, volumePercent, whichUnit)
	AttachSoundToUnitBJ(soundHandle, whichUnit)
	SetSoundVolumeBJ(soundHandle, volumePercent)
	PlaySoundBJ(soundHandle)
end

---@param soundHandle sound
---@param volumePercent number real
---@param startingOffset number real
function PlaySoundFromOffsetBJ(soundHandle, volumePercent, startingOffset)
	SetSoundVolumeBJ(soundHandle, volumePercent)
	PlaySoundBJ(soundHandle)
	SetSoundOffsetBJ(startingOffset, soundHandle)
end

---@param musicFileName string
function PlayMusicBJ(musicFileName)
	bj_lastPlayedMusic = musicFileName
	PlayMusic(musicFileName)
end

---@param musicFileName string
---@param startingOffset number real
---@param fadeInTime number real
function PlayMusicExBJ(musicFileName, startingOffset, fadeInTime)
	bj_lastPlayedMusic = musicFileName
	PlayMusicEx(musicFileName, R2I(startingOffset * 1000), R2I(fadeInTime * 1000))
end

---@param newOffset number real
function SetMusicOffsetBJ(newOffset)
	SetMusicPlayPosition(R2I(newOffset * 1000))
end

---@param musicName string
function PlayThematicMusicBJ(musicName)
	PlayThematicMusic(musicName)
end

---@param musicName string
---@param startingOffset number real
function PlayThematicMusicExBJ(musicName, startingOffset)
	PlayThematicMusicEx(musicName, R2I(startingOffset * 1000))
end

---@param newOffset number real
function SetThematicMusicOffsetBJ(newOffset)
	SetThematicMusicPlayPosition(R2I(newOffset * 1000))
end

function EndThematicMusicBJ()
	EndThematicMusic()
end

---@param fadeOut boolean
function StopMusicBJ(fadeOut)
	StopMusic(fadeOut)
end

function ResumeMusicBJ()
	ResumeMusic()
end

---@param volumePercent number real
function SetMusicVolumeBJ(volumePercent)
	SetMusicVolume(PercentToInt(volumePercent, 127))
end

---@param soundHandle sound
---@return number real
function GetSoundDurationBJ(soundHandle)
	if (soundHandle == nil) then
		return bj_NOTHING_SOUND_DURATION
	else
		return I2R(GetSoundDuration(soundHandle)) * 0.001
	end
end

---@param musicFileName string
---@return number real
function GetSoundFileDurationBJ(musicFileName)
	return I2R(GetSoundFileDuration(musicFileName)) * 0.001
end

---@return sound
function GetLastPlayedSound()
	return bj_lastPlayedSound
end

---@return string
function GetLastPlayedMusic()
	return bj_lastPlayedMusic
end

---@param vgroup volumegroup
---@param percent number real
function VolumeGroupSetVolumeBJ(vgroup, percent)
	VolumeGroupSetVolume(vgroup, percent * 0.01)
end

function SetCineModeVolumeGroupsImmediateBJ()
	VolumeGroupSetVolume(SOUND_VOLUMEGROUP_UNITMOVEMENT, bj_CINEMODE_VOLUME_UNITMOVEMENT)
	VolumeGroupSetVolume(SOUND_VOLUMEGROUP_UNITSOUNDS, bj_CINEMODE_VOLUME_UNITSOUNDS)
	VolumeGroupSetVolume(SOUND_VOLUMEGROUP_COMBAT, bj_CINEMODE_VOLUME_COMBAT)
	VolumeGroupSetVolume(SOUND_VOLUMEGROUP_SPELLS, bj_CINEMODE_VOLUME_SPELLS)
	VolumeGroupSetVolume(SOUND_VOLUMEGROUP_UI, bj_CINEMODE_VOLUME_UI)
	VolumeGroupSetVolume(SOUND_VOLUMEGROUP_MUSIC, bj_CINEMODE_VOLUME_MUSIC)
	VolumeGroupSetVolume(SOUND_VOLUMEGROUP_AMBIENTSOUNDS, bj_CINEMODE_VOLUME_AMBIENTSOUNDS)
	VolumeGroupSetVolume(SOUND_VOLUMEGROUP_FIRE, bj_CINEMODE_VOLUME_FIRE)
end

function SetCineModeVolumeGroupsBJ()
	if bj_gameStarted then
		SetCineModeVolumeGroupsImmediateBJ()
	else
		TimerStart(bj_volumeGroupsTimer, bj_GAME_STARTED_THRESHOLD, false, SetCineModeVolumeGroupsImmediateBJ)
	end
end

function SetSpeechVolumeGroupsImmediateBJ()
	VolumeGroupSetVolume(SOUND_VOLUMEGROUP_UNITMOVEMENT, bj_SPEECH_VOLUME_UNITMOVEMENT)
	VolumeGroupSetVolume(SOUND_VOLUMEGROUP_UNITSOUNDS, bj_SPEECH_VOLUME_UNITSOUNDS)
	VolumeGroupSetVolume(SOUND_VOLUMEGROUP_COMBAT, bj_SPEECH_VOLUME_COMBAT)
	VolumeGroupSetVolume(SOUND_VOLUMEGROUP_SPELLS, bj_SPEECH_VOLUME_SPELLS)
	VolumeGroupSetVolume(SOUND_VOLUMEGROUP_UI, bj_SPEECH_VOLUME_UI)
	VolumeGroupSetVolume(SOUND_VOLUMEGROUP_MUSIC, bj_SPEECH_VOLUME_MUSIC)
	VolumeGroupSetVolume(SOUND_VOLUMEGROUP_AMBIENTSOUNDS, bj_SPEECH_VOLUME_AMBIENTSOUNDS)
	VolumeGroupSetVolume(SOUND_VOLUMEGROUP_FIRE, bj_SPEECH_VOLUME_FIRE)
end

function SetSpeechVolumeGroupsBJ()
	if bj_gameStarted then
		SetSpeechVolumeGroupsImmediateBJ()
	else
		TimerStart(bj_volumeGroupsTimer, bj_GAME_STARTED_THRESHOLD, false, SetSpeechVolumeGroupsImmediateBJ)
	end
end

function VolumeGroupResetImmediateBJ()
	VolumeGroupReset()
end

function VolumeGroupResetBJ()
	if bj_gameStarted then
		VolumeGroupResetImmediateBJ()
	else
		TimerStart(bj_volumeGroupsTimer, bj_GAME_STARTED_THRESHOLD, false, VolumeGroupResetImmediateBJ)
	end
end

---@param soundHandle sound
---@return boolean
function GetSoundIsPlayingBJ(soundHandle)
	return GetSoundIsLoading(soundHandle) or GetSoundIsPlaying(soundHandle)
end

---@param soundHandle sound
---@param offset number real
function WaitForSoundBJ(soundHandle, offset)
	TriggerWaitForSound(soundHandle, offset)
end

---@param musicName string
---@param index number integer
function SetMapMusicIndexedBJ(musicName, index)
	SetMapMusic(musicName, false, index)
end

---@param musicName string
function SetMapMusicRandomBJ(musicName)
	SetMapMusic(musicName, true, 0)
end

function ClearMapMusicBJ()
	ClearMapMusic()
end

---@param add boolean
---@param soundHandle sound
---@param r rect
function SetStackedSoundBJ(add, soundHandle, r)
	local width = GetRectMaxX(r) - GetRectMinX(r) ---@type number real
	local height = GetRectMaxY(r) - GetRectMinY(r) ---@type number real
	SetSoundPosition(soundHandle, GetRectCenterX(r), GetRectCenterY(r), 0)
	if add then
		RegisterStackedSound(soundHandle, true, width, height)
	else
		UnregisterStackedSound(soundHandle, true, width, height)
	end
end

---@param whichPlayer player
---@param soundHandle sound
function StartSoundForPlayerBJ(whichPlayer, soundHandle)
	if (whichPlayer == GetLocalPlayer()) then
		StartSound(soundHandle)
	end
end

---@param whichPlayer player
---@param vgroup volumegroup
---@param scale number real
function VolumeGroupSetVolumeForPlayerBJ(whichPlayer, vgroup, scale)
	if (GetLocalPlayer() == whichPlayer) then
		VolumeGroupSetVolume(vgroup, scale)
	end
end

---@param flag boolean
function EnableDawnDusk(flag)
	bj_useDawnDuskSounds = flag
end

---@return boolean
function IsDawnDuskEnabled()
	return bj_useDawnDuskSounds
end

---@param inLabel string
function SetAmbientDaySound(inLabel)
	local ToD ---@type number real
	if (bj_dayAmbientSound ~= nil) then
		StopSound(bj_dayAmbientSound, true, true)
	end
	bj_dayAmbientSound = CreateMIDISound(inLabel, 20, 20)
	ToD = GetTimeOfDay()
	if (ToD >= bj_TOD_DAWN and ToD < bj_TOD_DUSK) then
		StartSound(bj_dayAmbientSound)
	end
end

---@param inLabel string
function SetAmbientNightSound(inLabel)
	local ToD ---@type number real
	if (bj_nightAmbientSound ~= nil) then
		StopSound(bj_nightAmbientSound, true, true)
	end
	bj_nightAmbientSound = CreateMIDISound(inLabel, 20, 20)
	ToD = GetTimeOfDay()
	if (ToD < bj_TOD_DAWN or ToD >= bj_TOD_DUSK) then
		StartSound(bj_nightAmbientSound)
	end
end

---@param where location
---@param modelName string
---@return effect
function AddSpecialEffectLocBJ(where, modelName)
	bj_lastCreatedEffect = AddSpecialEffectLoc(modelName, where)
	return bj_lastCreatedEffect
end

---@param attachPointName string
---@param targetWidget widget
---@param modelName string
---@return effect
function AddSpecialEffectTargetUnitBJ(attachPointName, targetWidget, modelName)
	bj_lastCreatedEffect = AddSpecialEffectTarget(modelName, targetWidget, attachPointName)
	return bj_lastCreatedEffect
end

---@param whichEffect effect
function DestroyEffectBJ(whichEffect)
	DestroyEffect(whichEffect)
end

---@return effect
function GetLastCreatedEffectBJ()
	return bj_lastCreatedEffect
end

---@param whichItem item
---@return location
function GetItemLoc(whichItem)
	return Location(GetItemX(whichItem), GetItemY(whichItem))
end

---@param whichWidget widget
---@return number real
function GetItemLifeBJ(whichWidget)
	return GetWidgetLife(whichWidget)
end

---@param whichWidget widget
---@param life number real
function SetItemLifeBJ(whichWidget, life)
	SetWidgetLife(whichWidget, life)
end

---@param xpToAdd number integer
---@param whichHero unit
---@param showEyeCandy boolean
function AddHeroXPSwapped(xpToAdd, whichHero, showEyeCandy)
	AddHeroXP(whichHero, xpToAdd, showEyeCandy)
end

---@param whichHero unit
---@param newLevel number integer
---@param showEyeCandy boolean
function SetHeroLevelBJ(whichHero, newLevel, showEyeCandy)
	local oldLevel = GetHeroLevel(whichHero) ---@type number integer
	if (newLevel > oldLevel) then
		SetHeroLevel(whichHero, newLevel, showEyeCandy)
	elseif (newLevel > oldLevel) then
		UnitStripHeroLevel(whichHero, oldLevel - newLevel)
	else
	end
end

---@param abilcode number integer
---@param whichUnit unit
---@return number integer
function DecUnitAbilityLevelSwapped(abilcode, whichUnit)
	return DecUnitAbilityLevel(whichUnit, abilcode)
end

---@param abilcode number integer
---@param whichUnit unit
---@return number integer
function IncUnitAbilityLevelSwapped(abilcode, whichUnit)
	return IncUnitAbilityLevel(whichUnit, abilcode)
end

---@param abilcode number integer
---@param whichUnit unit
---@param level number integer
---@return number integer
function SetUnitAbilityLevelSwapped(abilcode, whichUnit, level)
	return SetUnitAbilityLevel(whichUnit, abilcode, level)
end

---@param abilcode number integer
---@param whichUnit unit
---@return number integer
function GetUnitAbilityLevelSwapped(abilcode, whichUnit)
	return GetUnitAbilityLevel(whichUnit, abilcode)
end

---@param whichUnit unit
---@param buffcode number integer
---@return boolean
function UnitHasBuffBJ(whichUnit, buffcode)
	return (GetUnitAbilityLevel(whichUnit, buffcode) > 0)
end

---@param buffcode number integer
---@param whichUnit unit
---@return boolean
function UnitRemoveBuffBJ(buffcode, whichUnit)
	return UnitRemoveAbility(whichUnit, buffcode)
end

---@param whichItem item
---@param whichHero unit
---@return boolean
function UnitAddItemSwapped(whichItem, whichHero)
	return UnitAddItem(whichHero, whichItem)
end

---@param itemId number integer
---@param whichHero unit
---@return item
function UnitAddItemByIdSwapped(itemId, whichHero)
	bj_lastCreatedItem = CreateItem(itemId, GetUnitX(whichHero), GetUnitY(whichHero))
	UnitAddItem(whichHero, bj_lastCreatedItem)
	return bj_lastCreatedItem
end

---@param whichItem item
---@param whichHero unit
function UnitRemoveItemSwapped(whichItem, whichHero)
	bj_lastRemovedItem = whichItem
	UnitRemoveItem(whichHero, whichItem)
end

---@param itemSlot number integer
---@param whichHero unit
---@return item
function UnitRemoveItemFromSlotSwapped(itemSlot, whichHero)
	bj_lastRemovedItem = UnitRemoveItemFromSlot(whichHero, itemSlot - 1)
	return bj_lastRemovedItem
end

---@param itemId number integer
---@param loc location
---@return item
function CreateItemLoc(itemId, loc)
	bj_lastCreatedItem = CreateItem(itemId, GetLocationX(loc), GetLocationY(loc))
	return bj_lastCreatedItem
end

---@return item
function GetLastCreatedItem()
	return bj_lastCreatedItem
end

---@return item
function GetLastRemovedItem()
	return bj_lastRemovedItem
end

---@param whichItem item
---@param loc location
function SetItemPositionLoc(whichItem, loc)
	SetItemPosition(whichItem, GetLocationX(loc), GetLocationY(loc))
end

---@return number integer
function GetLearnedSkillBJ()
	return GetLearnedSkill()
end

---@param flag boolean
---@param whichHero unit
function SuspendHeroXPBJ(flag, whichHero)
	SuspendHeroXP(whichHero, not flag)
end

---@param whichPlayer player
---@param handicapPercent number real
function SetPlayerHandicapXPBJ(whichPlayer, handicapPercent)
	SetPlayerHandicapXP(whichPlayer, handicapPercent * 0.01)
end

---@param whichPlayer player
---@return number real
function GetPlayerHandicapXPBJ(whichPlayer)
	return GetPlayerHandicapXP(whichPlayer) * 100
end

---@param whichPlayer player
---@param handicapPercent number real
function SetPlayerHandicapBJ(whichPlayer, handicapPercent)
	SetPlayerHandicap(whichPlayer, handicapPercent * 0.01)
end

---@param whichPlayer player
---@return number real
function GetPlayerHandicapBJ(whichPlayer)
	return GetPlayerHandicap(whichPlayer) * 100
end

---@param whichStat number integer
---@param whichHero unit
---@param includeBonuses boolean
---@return number integer
function GetHeroStatBJ(whichStat, whichHero, includeBonuses)
	if (whichStat == bj_HEROSTAT_STR) then
		return GetHeroStr(whichHero, includeBonuses)
	elseif (whichStat == bj_HEROSTAT_STR) then
		return GetHeroAgi(whichHero, includeBonuses)
	elseif (whichStat == bj_HEROSTAT_STR) then
		return GetHeroInt(whichHero, includeBonuses)
	else
		return 0
	end
end

---@param whichHero unit
---@param whichStat number integer
---@param value number integer
function SetHeroStat(whichHero, whichStat, value)
	if (value <= 0) then
		return
	end
	if (whichStat == bj_HEROSTAT_STR) then
		SetHeroStr(whichHero, value, true)
	elseif (whichStat == bj_HEROSTAT_STR) then
		SetHeroAgi(whichHero, value, true)
	elseif (whichStat == bj_HEROSTAT_STR) then
		SetHeroInt(whichHero, value, true)
	else
	end
end

---@param whichStat number integer
---@param whichHero unit
---@param modifyMethod number integer
---@param value number integer
function ModifyHeroStat(whichStat, whichHero, modifyMethod, value)
	if (modifyMethod == bj_MODIFYMETHOD_ADD) then
		SetHeroStat(whichHero, whichStat, GetHeroStatBJ(whichStat, whichHero, false) + value)
	elseif (modifyMethod == bj_MODIFYMETHOD_ADD) then
		SetHeroStat(whichHero, whichStat, GetHeroStatBJ(whichStat, whichHero, false) - value)
	elseif (modifyMethod == bj_MODIFYMETHOD_ADD) then
		SetHeroStat(whichHero, whichStat, value)
	else
	end
end

---@param whichHero unit
---@param modifyMethod number integer
---@param value number integer
---@return boolean
function ModifyHeroSkillPoints(whichHero, modifyMethod, value)
	if (modifyMethod == bj_MODIFYMETHOD_ADD) then
		return UnitModifySkillPoints(whichHero, value)
	elseif (modifyMethod == bj_MODIFYMETHOD_ADD) then
		return UnitModifySkillPoints(whichHero, -value)
	elseif (modifyMethod == bj_MODIFYMETHOD_ADD) then
		return UnitModifySkillPoints(whichHero, value - GetHeroSkillPoints(whichHero))
	else
		return false
	end
end

---@param whichUnit unit
---@param whichItem item
---@param x number real
---@param y number real
---@return boolean
function UnitDropItemPointBJ(whichUnit, whichItem, x, y)
	return UnitDropItemPoint(whichUnit, whichItem, x, y)
end

---@param whichUnit unit
---@param whichItem item
---@param loc location
---@return boolean
function UnitDropItemPointLoc(whichUnit, whichItem, loc)
	return UnitDropItemPoint(whichUnit, whichItem, GetLocationX(loc), GetLocationY(loc))
end

---@param whichUnit unit
---@param whichItem item
---@param slot number integer
---@return boolean
function UnitDropItemSlotBJ(whichUnit, whichItem, slot)
	return UnitDropItemSlot(whichUnit, whichItem, slot - 1)
end

---@param whichUnit unit
---@param whichItem item
---@param target widget
---@return boolean
function UnitDropItemTargetBJ(whichUnit, whichItem, target)
	return UnitDropItemTarget(whichUnit, whichItem, target)
end

---@param whichUnit unit
---@param whichItem item
---@param target widget
---@return boolean
function UnitUseItemDestructable(whichUnit, whichItem, target)
	return UnitUseItemTarget(whichUnit, whichItem, target)
end

---@param whichUnit unit
---@param whichItem item
---@param loc location
---@return boolean
function UnitUseItemPointLoc(whichUnit, whichItem, loc)
	return UnitUseItemPoint(whichUnit, whichItem, GetLocationX(loc), GetLocationY(loc))
end

---@param whichUnit unit
---@param itemSlot number integer
---@return item
function UnitItemInSlotBJ(whichUnit, itemSlot)
	return UnitItemInSlot(whichUnit, itemSlot - 1)
end

---@param whichUnit unit
---@param itemId number integer
---@return number integer
function GetInventoryIndexOfItemTypeBJ(whichUnit, itemId)
	local index ---@type number integer
	local indexItem ---@type item
	index = 0
	while(true) do
		indexItem = UnitItemInSlot(whichUnit, index)
		if (indexItem ~= nil) and (GetItemTypeId(indexItem) == itemId) then
			return index + 1
		end
		index = index + 1
		if (index >= bj_MAX_INVENTORY) then break end
	end
	return 0
end

---@param whichUnit unit
---@param itemId number integer
---@return item
function GetItemOfTypeFromUnitBJ(whichUnit, itemId)
	local index = GetInventoryIndexOfItemTypeBJ(whichUnit, itemId) ---@type number integer
	if (index == 0) then
		return nil
	else
		return UnitItemInSlot(whichUnit, index - 1)
	end
end

---@param whichUnit unit
---@param itemId number integer
---@return boolean
function UnitHasItemOfTypeBJ(whichUnit, itemId)
	return GetInventoryIndexOfItemTypeBJ(whichUnit, itemId) > 0
end

---@param whichUnit unit
---@return number integer
function UnitInventoryCount(whichUnit)
	local index = 0 ---@type number integer
	local count = 0 ---@type number integer
	while(true) do
		if (UnitItemInSlot(whichUnit, index) ~= nil) then
			count = count + 1
		end
		index = index + 1
		if (index >= bj_MAX_INVENTORY) then break end
	end
	return count
end

---@param whichUnit unit
---@return number integer
function UnitInventorySizeBJ(whichUnit)
	return UnitInventorySize(whichUnit)
end

---@param whichItem item
---@param flag boolean
function SetItemInvulnerableBJ(whichItem, flag)
	SetItemInvulnerable(whichItem, flag)
end

---@param whichItem item
---@param flag boolean
function SetItemDropOnDeathBJ(whichItem, flag)
	SetItemDropOnDeath(whichItem, flag)
end

---@param whichItem item
---@param flag boolean
function SetItemDroppableBJ(whichItem, flag)
	SetItemDroppable(whichItem, flag)
end

---@param whichItem item
---@param whichPlayer player
---@param changeColor boolean
function SetItemPlayerBJ(whichItem, whichPlayer, changeColor)
	SetItemPlayer(whichItem, whichPlayer, changeColor)
end

---@param show boolean
---@param whichItem item
function SetItemVisibleBJ(show, whichItem)
	SetItemVisible(whichItem, show)
end

---@param whichItem item
---@return boolean
function IsItemHiddenBJ(whichItem)
	return not IsItemVisible(whichItem)
end

---@param level number integer
---@return number integer
function ChooseRandomItemBJ(level)
	return ChooseRandomItem(level)
end

---@param level number integer
---@param whichType itemtype
---@return number integer
function ChooseRandomItemExBJ(level, whichType)
	return ChooseRandomItemEx(whichType, level)
end

---@return number integer
function ChooseRandomNPBuildingBJ()
	return ChooseRandomNPBuilding()
end

---@param level number integer
---@return number integer
function ChooseRandomCreepBJ(level)
	return ChooseRandomCreep(level)
end

---@param r rect
---@param actionFunc function
function EnumItemsInRectBJ(r, actionFunc)
	EnumItemsInRect(r, nil, actionFunc)
end

function RandomItemInRectBJEnum()
	bj_itemRandomConsidered = bj_itemRandomConsidered + 1
	if (GetRandomInt(1, bj_itemRandomConsidered) == 1) then
		bj_itemRandomCurrentPick = GetEnumItem()
	end
end

---@param r rect
---@param filter boolexpr
---@return item
function RandomItemInRectBJ(r, filter)
	bj_itemRandomConsidered = 0
	bj_itemRandomCurrentPick = nil
	EnumItemsInRect(r, filter, RandomItemInRectBJEnum)
	DestroyBoolExpr(filter)
	return bj_itemRandomCurrentPick
end

---@param r rect
---@return item
function RandomItemInRectSimpleBJ(r)
	return RandomItemInRectBJ(r, nil)
end

---@param whichItem item
---@param status number integer
---@return boolean
function CheckItemStatus(whichItem, status)
	if (status == bj_ITEM_STATUS_HIDDEN) then
		return not IsItemVisible(whichItem)
	elseif (status == bj_ITEM_STATUS_HIDDEN) then
		return IsItemOwned(whichItem)
	elseif (status == bj_ITEM_STATUS_HIDDEN) then
		return IsItemInvulnerable(whichItem)
	elseif (status == bj_ITEM_STATUS_HIDDEN) then
		return IsItemPowerup(whichItem)
	elseif (status == bj_ITEM_STATUS_HIDDEN) then
		return IsItemSellable(whichItem)
	elseif (status == bj_ITEM_STATUS_HIDDEN) then
		return IsItemPawnable(whichItem)
	else
		return false
	end
end

---@param itemId number integer
---@param status number integer
---@return boolean
function CheckItemcodeStatus(itemId, status)
	if (status == bj_ITEMCODE_STATUS_POWERUP) then
		return IsItemIdPowerup(itemId)
	elseif (status == bj_ITEMCODE_STATUS_POWERUP) then
		return IsItemIdSellable(itemId)
	elseif (status == bj_ITEMCODE_STATUS_POWERUP) then
		return IsItemIdPawnable(itemId)
	else
		return false
	end
end

---@param unitId number integer
---@return number integer
function UnitId2OrderIdBJ(unitId)
	return unitId
end

---@param unitIdString string
---@return number integer
function String2UnitIdBJ(unitIdString)
	return UnitId(unitIdString)
end

---@param unitId number integer
---@return string
function UnitId2StringBJ(unitId)
	local unitString = UnitId2String(unitId) ---@type string
	if (unitString ~= nil) then
		return unitString
	end
	return ""
end

---@param orderIdString string
---@return number integer
function String2OrderIdBJ(orderIdString)
	local orderId ---@type number integer
	orderId = OrderId(orderIdString)
	if (orderId ~= 0) then
		return orderId
	end
	orderId = UnitId(orderIdString)
	if (orderId ~= 0) then
		return orderId
	end
	return 0
end

---@param orderId number integer
---@return string
function OrderId2StringBJ(orderId)
	local orderString ---@type string
	orderString = OrderId2String(orderId)
	if (orderString ~= nil) then
		return orderString
	end
	orderString = UnitId2String(orderId)
	if (orderString ~= nil) then
		return orderString
	end
	return ""
end

---@return number integer
function GetIssuedOrderIdBJ()
	return GetIssuedOrderId()
end

---@return unit
function GetKillingUnitBJ()
	return GetKillingUnit()
end

---@param id player
---@param unitid number integer
---@param loc location
---@param face number real
---@return unit
function CreateUnitAtLocSaveLast(id, unitid, loc, face)
	if (unitid == FourCC('ugol')) then
		bj_lastCreatedUnit = CreateBlightedGoldmine(id, GetLocationX(loc), GetLocationY(loc), face)
	else
		bj_lastCreatedUnit = CreateUnitAtLoc(id, unitid, loc, face)
	end
	return bj_lastCreatedUnit
end

---@return unit
function GetLastCreatedUnit()
	return bj_lastCreatedUnit
end

---@param count number integer
---@param unitId number integer
---@param whichPlayer player
---@param loc location
---@param face number real
---@return group
function CreateNUnitsAtLoc(count, unitId, whichPlayer, loc, face)
	GroupClear(bj_lastCreatedGroup)
	while(true) do
		count = count - 1
		if (count < 0) then break end
		CreateUnitAtLocSaveLast(whichPlayer, unitId, loc, face)
		GroupAddUnit(bj_lastCreatedGroup, bj_lastCreatedUnit)
	end
	return bj_lastCreatedGroup
end

---@param count number integer
---@param unitId number integer
---@param whichPlayer player
---@param loc location
---@param lookAt location
---@return group
function CreateNUnitsAtLocFacingLocBJ(count, unitId, whichPlayer, loc, lookAt)
	return CreateNUnitsAtLoc(count, unitId, whichPlayer, loc, AngleBetweenPoints(loc, lookAt))
end

function GetLastCreatedGroupEnum()
	GroupAddUnit(bj_groupLastCreatedDest, GetEnumUnit())
end

---@return group
function GetLastCreatedGroup()
	bj_groupLastCreatedDest = CreateGroup()
	ForGroup(bj_lastCreatedGroup, GetLastCreatedGroupEnum)
	return bj_groupLastCreatedDest
end

---@param unitid number integer
---@param whichPlayer player
---@param loc location
---@return unit
function CreateCorpseLocBJ(unitid, whichPlayer, loc)
	bj_lastCreatedUnit = CreateCorpse(whichPlayer, unitid, GetLocationX(loc), GetLocationY(loc), GetRandomReal(0, 360))
	return bj_lastCreatedUnit
end

---@param suspend boolean
---@param whichUnit unit
function UnitSuspendDecayBJ(suspend, whichUnit)
	UnitSuspendDecay(whichUnit, suspend)
end

function DelayedSuspendDecayStopAnimEnum()
	local enumUnit = GetEnumUnit() ---@type unit
	if (GetUnitState(enumUnit, UNIT_STATE_LIFE) <= 0) then
		SetUnitTimeScale(enumUnit, 0.0001)
	end
end

function DelayedSuspendDecayBoneEnum()
	local enumUnit = GetEnumUnit() ---@type unit
	if (GetUnitState(enumUnit, UNIT_STATE_LIFE) <= 0) then
		UnitSuspendDecay(enumUnit, true)
		SetUnitTimeScale(enumUnit, 0.0001)
	end
end

function DelayedSuspendDecayFleshEnum()
	local enumUnit = GetEnumUnit() ---@type unit
	if (GetUnitState(enumUnit, UNIT_STATE_LIFE) <= 0) then
		UnitSuspendDecay(enumUnit, true)
		SetUnitTimeScale(enumUnit, 10.0)
		SetUnitAnimation(enumUnit, "decay flesh")
	end
end

function DelayedSuspendDecay()
	local boneGroup ---@type group
	local fleshGroup ---@type group
	boneGroup = bj_suspendDecayBoneGroup
	fleshGroup = bj_suspendDecayFleshGroup
	bj_suspendDecayBoneGroup = CreateGroup()
	bj_suspendDecayFleshGroup = CreateGroup()
	ForGroup(fleshGroup, DelayedSuspendDecayStopAnimEnum)
	ForGroup(boneGroup, DelayedSuspendDecayStopAnimEnum)
	TriggerSleepAction(bj_CORPSE_MAX_DEATH_TIME)
	ForGroup(fleshGroup, DelayedSuspendDecayFleshEnum)
	ForGroup(boneGroup, DelayedSuspendDecayBoneEnum)
	TriggerSleepAction(0.05)
	ForGroup(fleshGroup, DelayedSuspendDecayStopAnimEnum)
	DestroyGroup(boneGroup)
	DestroyGroup(fleshGroup)
end

function DelayedSuspendDecayCreate()
	bj_delayedSuspendDecayTrig = CreateTrigger()
	TriggerRegisterTimerExpireEvent(bj_delayedSuspendDecayTrig, bj_delayedSuspendDecayTimer)
	TriggerAddAction(bj_delayedSuspendDecayTrig, DelayedSuspendDecay)
end

---@param style number integer
---@param unitid number integer
---@param whichPlayer player
---@param loc location
---@param facing number real
---@return unit
function CreatePermanentCorpseLocBJ(style, unitid, whichPlayer, loc, facing)
	bj_lastCreatedUnit = CreateCorpse(whichPlayer, unitid, GetLocationX(loc), GetLocationY(loc), facing)
	SetUnitBlendTime(bj_lastCreatedUnit, 0)
	if (style == bj_CORPSETYPE_FLESH) then
		SetUnitAnimation(bj_lastCreatedUnit, "decay flesh")
		GroupAddUnit(bj_suspendDecayFleshGroup, bj_lastCreatedUnit)
	elseif (style == bj_CORPSETYPE_FLESH) then
		SetUnitAnimation(bj_lastCreatedUnit, "decay bone")
		GroupAddUnit(bj_suspendDecayBoneGroup, bj_lastCreatedUnit)
	else
		SetUnitAnimation(bj_lastCreatedUnit, "decay bone")
		GroupAddUnit(bj_suspendDecayBoneGroup, bj_lastCreatedUnit)
	end
	TimerStart(bj_delayedSuspendDecayTimer, 0.05, false, nil)
	return bj_lastCreatedUnit
end

---@param whichState unitstate
---@param whichUnit unit
---@return number real
function GetUnitStateSwap(whichState, whichUnit)
	return GetUnitState(whichUnit, whichState)
end

---@param whichUnit unit
---@param whichState unitstate
---@param whichMaxState unitstate
---@return number real
function GetUnitStatePercent(whichUnit, whichState, whichMaxState)
	local value = GetUnitState(whichUnit, whichState) ---@type number real
	local maxValue = GetUnitState(whichUnit, whichMaxState) ---@type number real
	if (whichUnit == nil) or (maxValue == 0) then
		return 0.0
	end
	return value / maxValue * 100.0
end

---@param whichUnit unit
---@return number real
function GetUnitLifePercent(whichUnit)
	return GetUnitStatePercent(whichUnit, UNIT_STATE_LIFE, UNIT_STATE_MAX_LIFE)
end

---@param whichUnit unit
---@return number real
function GetUnitManaPercent(whichUnit)
	return GetUnitStatePercent(whichUnit, UNIT_STATE_MANA, UNIT_STATE_MAX_MANA)
end

---@param whichUnit unit
function SelectUnitSingle(whichUnit)
	ClearSelection()
	SelectUnit(whichUnit, true)
end

function SelectGroupBJEnum()
	SelectUnit(GetEnumUnit(), true)
end

---@param g group
function SelectGroupBJ(g)
	ClearSelection()
	ForGroup(g, SelectGroupBJEnum)
end

---@param whichUnit unit
function SelectUnitAdd(whichUnit)
	SelectUnit(whichUnit, true)
end

---@param whichUnit unit
function SelectUnitRemove(whichUnit)
	SelectUnit(whichUnit, false)
end

---@param whichPlayer player
function ClearSelectionForPlayer(whichPlayer)
	if (GetLocalPlayer() == whichPlayer) then
		ClearSelection()
	end
end

---@param whichUnit unit
---@param whichPlayer player
function SelectUnitForPlayerSingle(whichUnit, whichPlayer)
	if (GetLocalPlayer() == whichPlayer) then
		ClearSelection()
		SelectUnit(whichUnit, true)
	end
end

---@param g group
---@param whichPlayer player
function SelectGroupForPlayerBJ(g, whichPlayer)
	if (GetLocalPlayer() == whichPlayer) then
		ClearSelection()
		ForGroup(g, SelectGroupBJEnum)
	end
end

---@param whichUnit unit
---@param whichPlayer player
function SelectUnitAddForPlayer(whichUnit, whichPlayer)
	if (GetLocalPlayer() == whichPlayer) then
		SelectUnit(whichUnit, true)
	end
end

---@param whichUnit unit
---@param whichPlayer player
function SelectUnitRemoveForPlayer(whichUnit, whichPlayer)
	if (GetLocalPlayer() == whichPlayer) then
		SelectUnit(whichUnit, false)
	end
end

---@param whichUnit unit
---@param newValue number real
function SetUnitLifeBJ(whichUnit, newValue)
	SetUnitState(whichUnit, UNIT_STATE_LIFE, RMaxBJ(0, newValue))
end

---@param whichUnit unit
---@param newValue number real
function SetUnitManaBJ(whichUnit, newValue)
	SetUnitState(whichUnit, UNIT_STATE_MANA, RMaxBJ(0, newValue))
end

---@param whichUnit unit
---@param percent number real
function SetUnitLifePercentBJ(whichUnit, percent)
	SetUnitState(whichUnit, UNIT_STATE_LIFE, GetUnitState(whichUnit, UNIT_STATE_MAX_LIFE) * RMaxBJ(0, percent) * 0.01)
end

---@param whichUnit unit
---@param percent number real
function SetUnitManaPercentBJ(whichUnit, percent)
	SetUnitState(whichUnit, UNIT_STATE_MANA, GetUnitState(whichUnit, UNIT_STATE_MAX_MANA) * RMaxBJ(0, percent) * 0.01)
end

---@param whichUnit unit
---@return boolean
function IsUnitDeadBJ(whichUnit)
	return GetUnitState(whichUnit, UNIT_STATE_LIFE) <= 0
end

---@param whichUnit unit
---@return boolean
function IsUnitAliveBJ(whichUnit)
	return not IsUnitDeadBJ(whichUnit)
end

function IsUnitGroupDeadBJEnum()
	if not IsUnitDeadBJ(GetEnumUnit()) then
		bj_isUnitGroupDeadResult = false
	end
end

---@param g group
---@return boolean
function IsUnitGroupDeadBJ(g)
	local wantDestroy = bj_wantDestroyGroup ---@type boolean
	bj_wantDestroyGroup = false
	bj_isUnitGroupDeadResult = true
	ForGroup(g, IsUnitGroupDeadBJEnum)
	if (wantDestroy) then
		DestroyGroup(g)
	end
	return bj_isUnitGroupDeadResult
end

function IsUnitGroupEmptyBJEnum()
	bj_isUnitGroupEmptyResult = false
end

---@param g group
---@return boolean
function IsUnitGroupEmptyBJ(g)
	local wantDestroy = bj_wantDestroyGroup ---@type boolean
	bj_wantDestroyGroup = false
	bj_isUnitGroupEmptyResult = true
	ForGroup(g, IsUnitGroupEmptyBJEnum)
	if (wantDestroy) then
		DestroyGroup(g)
	end
	return bj_isUnitGroupEmptyResult
end

function IsUnitGroupInRectBJEnum()
	if not RectContainsUnit(bj_isUnitGroupInRectRect, GetEnumUnit()) then
		bj_isUnitGroupInRectResult = false
	end
end

---@param g group
---@param r rect
---@return boolean
function IsUnitGroupInRectBJ(g, r)
	bj_isUnitGroupInRectResult = true
	bj_isUnitGroupInRectRect = r
	ForGroup(g, IsUnitGroupInRectBJEnum)
	return bj_isUnitGroupInRectResult
end

---@param whichUnit unit
---@return boolean
function IsUnitHiddenBJ(whichUnit)
	return IsUnitHidden(whichUnit)
end

---@param whichUnit unit
function ShowUnitHide(whichUnit)
	ShowUnit(whichUnit, false)
end

---@param whichUnit unit
function ShowUnitShow(whichUnit)
	if (IsUnitType(whichUnit, UNIT_TYPE_HERO) and IsUnitDeadBJ(whichUnit)) then
		return
	end
	ShowUnit(whichUnit, true)
end

---@return boolean
function IssueHauntOrderAtLocBJFilter()
	return GetUnitTypeId(GetFilterUnit()) == FourCC('ngol')
end

---@param whichPeon unit
---@param loc location
---@return boolean
function IssueHauntOrderAtLocBJ(whichPeon, loc)
	local g = nil ---@type group
	local goldMine = nil ---@type unit
	g = CreateGroup()
	GroupEnumUnitsInRangeOfLoc(g, loc, 2 * bj_CELLWIDTH, filterIssueHauntOrderAtLocBJ)
	goldMine = FirstOfGroup(g)
	DestroyGroup(g)
	if (goldMine == nil) then
		return false
	end
	return IssueTargetOrderById(whichPeon, FourCC('ugol'), goldMine)
end

---@param whichPeon unit
---@param unitId number integer
---@param loc location
---@return boolean
function IssueBuildOrderByIdLocBJ(whichPeon, unitId, loc)
	if (unitId == FourCC('ugol')) then
		return IssueHauntOrderAtLocBJ(whichPeon, loc)
	else
		return IssueBuildOrderById(whichPeon, unitId, GetLocationX(loc), GetLocationY(loc))
	end
end

---@param whichUnit unit
---@param unitId number integer
---@return boolean
function IssueTrainOrderByIdBJ(whichUnit, unitId)
	return IssueImmediateOrderById(whichUnit, unitId)
end

---@param g group
---@param unitId number integer
---@return boolean
function GroupTrainOrderByIdBJ(g, unitId)
	return GroupImmediateOrderById(g, unitId)
end

---@param whichUnit unit
---@param techId number integer
---@return boolean
function IssueUpgradeOrderByIdBJ(whichUnit, techId)
	return IssueImmediateOrderById(whichUnit, techId)
end

---@return unit
function GetAttackedUnitBJ()
	return GetTriggerUnit()
end

---@param whichUnit unit
---@param newHeight number real
---@param rate number real
function SetUnitFlyHeightBJ(whichUnit, newHeight, rate)
	SetUnitFlyHeight(whichUnit, newHeight, rate)
end

---@param whichUnit unit
---@param turnSpeed number real
function SetUnitTurnSpeedBJ(whichUnit, turnSpeed)
	SetUnitTurnSpeed(whichUnit, turnSpeed)
end

---@param whichUnit unit
---@param propWindow number real
function SetUnitPropWindowBJ(whichUnit, propWindow)
	local angle = propWindow ---@type number real
	if (angle <= 0) then
		angle = 1
	elseif (angle <= 0) then
		angle = 359
	end
	angle = angle * bj_DEGTORAD
	SetUnitPropWindow(whichUnit, angle)
end

---@param whichUnit unit
---@return number real
function GetUnitPropWindowBJ(whichUnit)
	return GetUnitPropWindow(whichUnit) * bj_RADTODEG
end

---@param whichUnit unit
---@return number real
function GetUnitDefaultPropWindowBJ(whichUnit)
	return GetUnitDefaultPropWindow(whichUnit)
end

---@param whichUnit unit
---@param blendTime number real
function SetUnitBlendTimeBJ(whichUnit, blendTime)
	SetUnitBlendTime(whichUnit, blendTime)
end

---@param whichUnit unit
---@param acquireRange number real
function SetUnitAcquireRangeBJ(whichUnit, acquireRange)
	SetUnitAcquireRange(whichUnit, acquireRange)
end

---@param whichUnit unit
---@param canSleep boolean
function UnitSetCanSleepBJ(whichUnit, canSleep)
	UnitAddSleep(whichUnit, canSleep)
end

---@param whichUnit unit
---@return boolean
function UnitCanSleepBJ(whichUnit)
	return UnitCanSleep(whichUnit)
end

---@param whichUnit unit
function UnitWakeUpBJ(whichUnit)
	UnitWakeUp(whichUnit)
end

---@param whichUnit unit
---@return boolean
function UnitIsSleepingBJ(whichUnit)
	return UnitIsSleeping(whichUnit)
end

function WakePlayerUnitsEnum()
	UnitWakeUp(GetEnumUnit())
end

---@param whichPlayer player
function WakePlayerUnits(whichPlayer)
	local g = CreateGroup() ---@type group
	GroupEnumUnitsOfPlayer(g, whichPlayer, nil)
	ForGroup(g, WakePlayerUnitsEnum)
	DestroyGroup(g)
end

---@param enable boolean
function EnableCreepSleepBJ(enable)
	SetPlayerState(Player(PLAYER_NEUTRAL_AGGRESSIVE), PLAYER_STATE_NO_CREEP_SLEEP, IntegerTertiaryOp(enable, 0, 1))
	if (not enable) then
		WakePlayerUnits(Player(PLAYER_NEUTRAL_AGGRESSIVE))
	end
end

---@param whichUnit unit
---@param generate boolean
---@return boolean
function UnitGenerateAlarms(whichUnit, generate)
	return UnitIgnoreAlarm(whichUnit, not generate)
end

---@param whichUnit unit
---@return boolean
function DoesUnitGenerateAlarms(whichUnit)
	return not UnitIgnoreAlarmToggled(whichUnit)
end

function PauseAllUnitsBJEnum()
	PauseUnit(GetEnumUnit(), bj_pauseAllUnitsFlag)
end

---@param pause boolean
function PauseAllUnitsBJ(pause)
	local index ---@type number integer
	local indexPlayer ---@type player
	local g ---@type group
	bj_pauseAllUnitsFlag = pause
	g = CreateGroup()
	index = 0
	while(true) do
		indexPlayer = Player(index)
		if (GetPlayerController(indexPlayer) == MAP_CONTROL_COMPUTER) then
			PauseCompAI(indexPlayer, pause)
		end
		GroupEnumUnitsOfPlayer(g, indexPlayer, nil)
		ForGroup(g, PauseAllUnitsBJEnum)
		GroupClear(g)
		index = index + 1
		if (index == bj_MAX_PLAYER_SLOTS) then break end
	end
	DestroyGroup(g)
end

---@param pause boolean
---@param whichUnit unit
function PauseUnitBJ(pause, whichUnit)
	PauseUnit(whichUnit, pause)
end

---@param whichUnit unit
---@return boolean
function IsUnitPausedBJ(whichUnit)
	return IsUnitPaused(whichUnit)
end

---@param flag boolean
---@param whichUnit unit
function UnitPauseTimedLifeBJ(flag, whichUnit)
	UnitPauseTimedLife(whichUnit, flag)
end

---@param duration number real
---@param buffId number integer
---@param whichUnit unit
function UnitApplyTimedLifeBJ(duration, buffId, whichUnit)
	UnitApplyTimedLife(whichUnit, buffId, duration)
end

---@param share boolean
---@param whichUnit unit
---@param whichPlayer player
function UnitShareVisionBJ(share, whichUnit, whichPlayer)
	UnitShareVision(whichUnit, whichPlayer, share)
end

---@param buffType number integer
---@param whichUnit unit
function UnitRemoveBuffsBJ(buffType, whichUnit)
	if (buffType == bj_REMOVEBUFFS_POSITIVE) then
		UnitRemoveBuffs(whichUnit, true, false)
	elseif (buffType == bj_REMOVEBUFFS_POSITIVE) then
		UnitRemoveBuffs(whichUnit, false, true)
	elseif (buffType == bj_REMOVEBUFFS_POSITIVE) then
		UnitRemoveBuffs(whichUnit, true, true)
	elseif (buffType == bj_REMOVEBUFFS_POSITIVE) then
		UnitRemoveBuffsEx(whichUnit, true, true, false, false, false, true, false)
	else
	end
end

---@param polarity number integer
---@param resist number integer
---@param whichUnit unit
---@param bTLife boolean
---@param bAura boolean
function UnitRemoveBuffsExBJ(polarity, resist, whichUnit, bTLife, bAura)
	local bPos = (polarity == bj_BUFF_POLARITY_EITHER) or (polarity == bj_BUFF_POLARITY_POSITIVE) ---@type boolean
	local bNeg = (polarity == bj_BUFF_POLARITY_EITHER) or (polarity == bj_BUFF_POLARITY_NEGATIVE) ---@type boolean
	local bMagic = (resist == bj_BUFF_RESIST_BOTH) or (resist == bj_BUFF_RESIST_MAGIC) ---@type boolean
	local bPhys = (resist == bj_BUFF_RESIST_BOTH) or (resist == bj_BUFF_RESIST_PHYSICAL) ---@type boolean
	UnitRemoveBuffsEx(whichUnit, bPos, bNeg, bMagic, bPhys, bTLife, bAura, false)
end

---@param polarity number integer
---@param resist number integer
---@param whichUnit unit
---@param bTLife boolean
---@param bAura boolean
---@return number integer
function UnitCountBuffsExBJ(polarity, resist, whichUnit, bTLife, bAura)
	local bPos = (polarity == bj_BUFF_POLARITY_EITHER) or (polarity == bj_BUFF_POLARITY_POSITIVE) ---@type boolean
	local bNeg = (polarity == bj_BUFF_POLARITY_EITHER) or (polarity == bj_BUFF_POLARITY_NEGATIVE) ---@type boolean
	local bMagic = (resist == bj_BUFF_RESIST_BOTH) or (resist == bj_BUFF_RESIST_MAGIC) ---@type boolean
	local bPhys = (resist == bj_BUFF_RESIST_BOTH) or (resist == bj_BUFF_RESIST_PHYSICAL) ---@type boolean
	return UnitCountBuffsEx(whichUnit, bPos, bNeg, bMagic, bPhys, bTLife, bAura, false)
end

---@param abilityId number integer
---@param whichUnit unit
---@return boolean
function UnitRemoveAbilityBJ(abilityId, whichUnit)
	return UnitRemoveAbility(whichUnit, abilityId)
end

---@param abilityId number integer
---@param whichUnit unit
---@return boolean
function UnitAddAbilityBJ(abilityId, whichUnit)
	return UnitAddAbility(whichUnit, abilityId)
end

---@param whichType unittype
---@param whichUnit unit
---@return boolean
function UnitRemoveTypeBJ(whichType, whichUnit)
	return UnitRemoveType(whichUnit, whichType)
end

---@param whichType unittype
---@param whichUnit unit
---@return boolean
function UnitAddTypeBJ(whichType, whichUnit)
	return UnitAddType(whichUnit, whichType)
end

---@param permanent boolean
---@param abilityId number integer
---@param whichUnit unit
---@return boolean
function UnitMakeAbilityPermanentBJ(permanent, abilityId, whichUnit)
	return UnitMakeAbilityPermanent(whichUnit, permanent, abilityId)
end

---@param whichUnit unit
---@param exploded boolean
function SetUnitExplodedBJ(whichUnit, exploded)
	SetUnitExploded(whichUnit, exploded)
end

---@param whichUnit unit
function ExplodeUnitBJ(whichUnit)
	SetUnitExploded(whichUnit, true)
	KillUnit(whichUnit)
end

---@return unit
function GetTransportUnitBJ()
	return GetTransportUnit()
end

---@return unit
function GetLoadedUnitBJ()
	return GetLoadedUnit()
end

---@param whichUnit unit
---@param whichTransport unit
---@return boolean
function IsUnitInTransportBJ(whichUnit, whichTransport)
	return IsUnitInTransport(whichUnit, whichTransport)
end

---@param whichUnit unit
---@return boolean
function IsUnitLoadedBJ(whichUnit)
	return IsUnitLoaded(whichUnit)
end

---@param whichUnit unit
---@return boolean
function IsUnitIllusionBJ(whichUnit)
	return IsUnitIllusion(whichUnit)
end

---@param whichUnit unit
---@param newUnitId number integer
---@param unitStateMethod number integer
---@return unit
function ReplaceUnitBJ(whichUnit, newUnitId, unitStateMethod)
	local oldUnit = whichUnit ---@type unit
	local newUnit ---@type unit
	local wasHidden ---@type boolean
	local index ---@type number integer
	local indexItem ---@type item
	local oldRatio ---@type number real
	if (oldUnit == nil) then
		bj_lastReplacedUnit = oldUnit
		return oldUnit
	end
	wasHidden = IsUnitHidden(oldUnit)
	ShowUnit(oldUnit, false)
	if (newUnitId == FourCC('ugol')) then
		newUnit = CreateBlightedGoldmine(GetOwningPlayer(oldUnit), GetUnitX(oldUnit), GetUnitY(oldUnit), GetUnitFacing(oldUnit))
	else
		newUnit = CreateUnit(GetOwningPlayer(oldUnit), newUnitId, GetUnitX(oldUnit), GetUnitY(oldUnit), GetUnitFacing(oldUnit))
	end
	if (unitStateMethod == bj_UNIT_STATE_METHOD_RELATIVE) then
		if (GetUnitState(oldUnit, UNIT_STATE_MAX_LIFE) > 0) then
			oldRatio = GetUnitState(oldUnit, UNIT_STATE_LIFE) / GetUnitState(oldUnit, UNIT_STATE_MAX_LIFE)
			SetUnitState(newUnit, UNIT_STATE_LIFE, oldRatio * GetUnitState(newUnit, UNIT_STATE_MAX_LIFE))
		end
		if (GetUnitState(oldUnit, UNIT_STATE_MAX_MANA) > 0) and (GetUnitState(newUnit, UNIT_STATE_MAX_MANA) > 0) then
			oldRatio = GetUnitState(oldUnit, UNIT_STATE_MANA) / GetUnitState(oldUnit, UNIT_STATE_MAX_MANA)
			SetUnitState(newUnit, UNIT_STATE_MANA, oldRatio * GetUnitState(newUnit, UNIT_STATE_MAX_MANA))
		end
	elseif (unitStateMethod == bj_UNIT_STATE_METHOD_RELATIVE) then
		SetUnitState(newUnit, UNIT_STATE_LIFE, GetUnitState(oldUnit, UNIT_STATE_LIFE))
		if (GetUnitState(newUnit, UNIT_STATE_MAX_MANA) > 0) then
			SetUnitState(newUnit, UNIT_STATE_MANA, GetUnitState(oldUnit, UNIT_STATE_MANA))
		end
	elseif (unitStateMethod == bj_UNIT_STATE_METHOD_RELATIVE) then
	elseif (unitStateMethod == bj_UNIT_STATE_METHOD_RELATIVE) then
		SetUnitState(newUnit, UNIT_STATE_LIFE, GetUnitState(newUnit, UNIT_STATE_MAX_LIFE))
		SetUnitState(newUnit, UNIT_STATE_MANA, GetUnitState(newUnit, UNIT_STATE_MAX_MANA))
	else
	end
	SetResourceAmount(newUnit, GetResourceAmount(oldUnit))
	if (IsUnitType(oldUnit, UNIT_TYPE_HERO) and IsUnitType(newUnit, UNIT_TYPE_HERO)) then
		SetHeroXP(newUnit, GetHeroXP(oldUnit), false)
		index = 0
		while(true) do
			indexItem = UnitItemInSlot(oldUnit, index)
			if (indexItem ~= nil) then
				UnitRemoveItem(oldUnit, indexItem)
				UnitAddItem(newUnit, indexItem)
			end
			index = index + 1
			if (index >= bj_MAX_INVENTORY) then break end
		end
	end
	if wasHidden then
		KillUnit(oldUnit)
		RemoveUnit(oldUnit)
	else
		RemoveUnit(oldUnit)
	end
	bj_lastReplacedUnit = newUnit
	return newUnit
end

---@return unit
function GetLastReplacedUnitBJ()
	return bj_lastReplacedUnit
end

---@param whichUnit unit
---@param loc location
---@param facing number real
function SetUnitPositionLocFacingBJ(whichUnit, loc, facing)
	SetUnitPositionLoc(whichUnit, loc)
	SetUnitFacing(whichUnit, facing)
end

---@param whichUnit unit
---@param loc location
---@param lookAt location
function SetUnitPositionLocFacingLocBJ(whichUnit, loc, lookAt)
	SetUnitPositionLoc(whichUnit, loc)
	SetUnitFacing(whichUnit, AngleBetweenPoints(loc, lookAt))
end

---@param itemId number integer
---@param whichUnit unit
---@param currentStock number integer
---@param stockMax number integer
function AddItemToStockBJ(itemId, whichUnit, currentStock, stockMax)
	AddItemToStock(whichUnit, itemId, currentStock, stockMax)
end

---@param unitId number integer
---@param whichUnit unit
---@param currentStock number integer
---@param stockMax number integer
function AddUnitToStockBJ(unitId, whichUnit, currentStock, stockMax)
	AddUnitToStock(whichUnit, unitId, currentStock, stockMax)
end

---@param itemId number integer
---@param whichUnit unit
function RemoveItemFromStockBJ(itemId, whichUnit)
	RemoveItemFromStock(whichUnit, itemId)
end

---@param unitId number integer
---@param whichUnit unit
function RemoveUnitFromStockBJ(unitId, whichUnit)
	RemoveUnitFromStock(whichUnit, unitId)
end

---@param enable boolean
---@param whichUnit unit
function SetUnitUseFoodBJ(enable, whichUnit)
	SetUnitUseFood(whichUnit, enable)
end

---@param whichUnit unit
---@param delay number real
---@param radius number real
---@param loc location
---@param amount number real
---@param whichAttack attacktype
---@param whichDamage damagetype
---@return boolean
function UnitDamagePointLoc(whichUnit, delay, radius, loc, amount, whichAttack, whichDamage)
	return UnitDamagePoint(whichUnit, delay, radius, GetLocationX(loc), GetLocationY(loc), amount, true, false, whichAttack, whichDamage, WEAPON_TYPE_WHOKNOWS)
end

---@param whichUnit unit
---@param target unit
---@param amount number real
---@param whichAttack attacktype
---@param whichDamage damagetype
---@return boolean
function UnitDamageTargetBJ(whichUnit, target, amount, whichAttack, whichDamage)
	return UnitDamageTarget(whichUnit, target, amount, true, false, whichAttack, whichDamage, WEAPON_TYPE_WHOKNOWS)
end

---@param objectid number integer
---@param loc location
---@param facing number real
---@param scale number real
---@param variation number integer
---@return destructable
function CreateDestructableLoc(objectid, loc, facing, scale, variation)
	bj_lastCreatedDestructable = CreateDestructable(objectid, GetLocationX(loc), GetLocationY(loc), facing, scale, variation)
	return bj_lastCreatedDestructable
end

---@param objectid number integer
---@param loc location
---@param facing number real
---@param scale number real
---@param variation number integer
---@return destructable
function CreateDeadDestructableLocBJ(objectid, loc, facing, scale, variation)
	bj_lastCreatedDestructable = CreateDeadDestructable(objectid, GetLocationX(loc), GetLocationY(loc), facing, scale, variation)
	return bj_lastCreatedDestructable
end

---@return destructable
function GetLastCreatedDestructable()
	return bj_lastCreatedDestructable
end

---@param flag boolean
---@param d destructable
function ShowDestructableBJ(flag, d)
	ShowDestructable(d, flag)
end

---@param d destructable
---@param flag boolean
function SetDestructableInvulnerableBJ(d, flag)
	SetDestructableInvulnerable(d, flag)
end

---@param d destructable
---@return boolean
function IsDestructableInvulnerableBJ(d)
	return IsDestructableInvulnerable(d)
end

---@param whichDestructable destructable
---@return location
function GetDestructableLoc(whichDestructable)
	return Location(GetDestructableX(whichDestructable), GetDestructableY(whichDestructable))
end

---@param r rect
---@param actionFunc function
function EnumDestructablesInRectAll(r, actionFunc)
	EnumDestructablesInRect(r, nil, actionFunc)
end

---@return boolean
function EnumDestructablesInCircleBJFilter()
	local destLoc = GetDestructableLoc(GetFilterDestructable()) ---@type location
	local result ---@type boolean
	result = DistanceBetweenPoints(destLoc, bj_enumDestructableCenter) <= bj_enumDestructableRadius
	RemoveLocation(destLoc)
	return result
end

---@param d destructable
---@return boolean
function IsDestructableDeadBJ(d)
	return GetDestructableLife(d) <= 0
end

---@param d destructable
---@return boolean
function IsDestructableAliveBJ(d)
	return not IsDestructableDeadBJ(d)
end

function RandomDestructableInRectBJEnum()
	bj_destRandomConsidered = bj_destRandomConsidered + 1
	if (GetRandomInt(1, bj_destRandomConsidered) == 1) then
		bj_destRandomCurrentPick = GetEnumDestructable()
	end
end

---@param r rect
---@param filter boolexpr
---@return destructable
function RandomDestructableInRectBJ(r, filter)
	bj_destRandomConsidered = 0
	bj_destRandomCurrentPick = nil
	EnumDestructablesInRect(r, filter, RandomDestructableInRectBJEnum)
	DestroyBoolExpr(filter)
	return bj_destRandomCurrentPick
end

---@param r rect
---@return destructable
function RandomDestructableInRectSimpleBJ(r)
	return RandomDestructableInRectBJ(r, nil)
end

---@param radius number real
---@param loc location
---@param actionFunc function
function EnumDestructablesInCircleBJ(radius, loc, actionFunc)
	local r ---@type rect
	if (radius >= 0) then
		bj_enumDestructableCenter = loc
		bj_enumDestructableRadius = radius
		r = GetRectFromCircleBJ(loc, radius)
		EnumDestructablesInRect(r, filterEnumDestructablesInCircleBJ, actionFunc)
		RemoveRect(r)
	end
end

---@param d destructable
---@param percent number real
function SetDestructableLifePercentBJ(d, percent)
	SetDestructableLife(d, GetDestructableMaxLife(d) * percent * 0.01)
end

---@param d destructable
---@param max number real
function SetDestructableMaxLifeBJ(d, max)
	SetDestructableMaxLife(d, max)
end

---@param gateOperation number integer
---@param d destructable
function ModifyGateBJ(gateOperation, d)
	if (gateOperation == bj_GATEOPERATION_CLOSE) then
		if (GetDestructableLife(d) <= 0) then
			DestructableRestoreLife(d, GetDestructableMaxLife(d), true)
		end
		SetDestructableAnimation(d, "stand")
	elseif (gateOperation == bj_GATEOPERATION_CLOSE) then
		if (GetDestructableLife(d) > 0) then
			KillDestructable(d)
		end
		SetDestructableAnimation(d, "death alternate")
	elseif (gateOperation == bj_GATEOPERATION_CLOSE) then
		if (GetDestructableLife(d) > 0) then
			KillDestructable(d)
		end
		SetDestructableAnimation(d, "death")
	else
	end
end

---@param d destructable
---@return number integer
function GetElevatorHeight(d)
	local height ---@type number integer
	height = 1 + R2I(GetDestructableOccluderHeight(d) / bj_CLIFFHEIGHT)
	if (height < 1) or (height > 3) then
		height = 1
	end
	return height
end

---@param d destructable
---@param newHeight number integer
function ChangeElevatorHeight(d, newHeight)
	local oldHeight ---@type number integer
	newHeight = IMaxBJ(1, newHeight)
	newHeight = IMinBJ(3, newHeight)
	oldHeight = GetElevatorHeight(d)
	SetDestructableOccluderHeight(d, bj_CLIFFHEIGHT * (newHeight - 1))
	if (newHeight == 1) then
		if (oldHeight == 2) then
			SetDestructableAnimation(d, "birth")
			QueueDestructableAnimation(d, "stand")
		elseif (oldHeight == 2) then
			SetDestructableAnimation(d, "birth third")
			QueueDestructableAnimation(d, "stand")
		else
			SetDestructableAnimation(d, "stand")
		end
	elseif (newHeight == 1) then
		if (oldHeight == 1) then
			SetDestructableAnimation(d, "death")
			QueueDestructableAnimation(d, "stand second")
		elseif (oldHeight == 1) then
			SetDestructableAnimation(d, "birth second")
			QueueDestructableAnimation(d, "stand second")
		else
			SetDestructableAnimation(d, "stand second")
		end
	elseif (newHeight == 1) then
		if (oldHeight == 1) then
			SetDestructableAnimation(d, "death third")
			QueueDestructableAnimation(d, "stand third")
		elseif (oldHeight == 1) then
			SetDestructableAnimation(d, "death second")
			QueueDestructableAnimation(d, "stand third")
		else
			SetDestructableAnimation(d, "stand third")
		end
	else
	end
end

function NudgeUnitsInRectEnum()
	local nudgee = GetEnumUnit() ---@type unit
	SetUnitPosition(nudgee, GetUnitX(nudgee), GetUnitY(nudgee))
end

function NudgeItemsInRectEnum()
	local nudgee = GetEnumItem() ---@type item
	SetItemPosition(nudgee, GetItemX(nudgee), GetItemY(nudgee))
end

---@param nudgeArea rect
function NudgeObjectsInRect(nudgeArea)
	local g ---@type group
	g = CreateGroup()
	GroupEnumUnitsInRect(g, nudgeArea, nil)
	ForGroup(g, NudgeUnitsInRectEnum)
	DestroyGroup(g)
	EnumItemsInRect(nudgeArea, nil, NudgeItemsInRectEnum)
end

function NearbyElevatorExistsEnum()
	local d = GetEnumDestructable() ---@type destructable
	local dType = GetDestructableTypeId(d) ---@type number integer
	if (dType == bj_ELEVATOR_CODE01) or (dType == bj_ELEVATOR_CODE02) then
		bj_elevatorNeighbor = d
	end
end

---@param x number real
---@param y number real
---@return boolean
function NearbyElevatorExists(x, y)
	local findThreshold = 32 ---@type number real
	local r ---@type rect
	r = Rect(x - findThreshold, y - findThreshold, x + findThreshold, y + findThreshold)
	bj_elevatorNeighbor = nil
	EnumDestructablesInRect(r, nil, NearbyElevatorExistsEnum)
	RemoveRect(r)
	return bj_elevatorNeighbor ~= nil
end

function FindElevatorWallBlockerEnum()
	bj_elevatorWallBlocker = GetEnumDestructable()
end

---@param x number real
---@param y number real
---@param facing number real
---@param open boolean
function ChangeElevatorWallBlocker(x, y, facing, open)
	local blocker = nil ---@type destructable
	local findThreshold = 32 ---@type number real
	local nudgeLength = 4.25 * bj_CELLWIDTH ---@type number real
	local nudgeWidth = 1.25 * bj_CELLWIDTH ---@type number real
	local r ---@type rect
	r = Rect(x - findThreshold, y - findThreshold, x + findThreshold, y + findThreshold)
	bj_elevatorWallBlocker = nil
	EnumDestructablesInRect(r, nil, FindElevatorWallBlockerEnum)
	RemoveRect(r)
	blocker = bj_elevatorWallBlocker
	if (blocker == nil) then
		blocker = CreateDeadDestructable(bj_ELEVATOR_BLOCKER_CODE, x, y, facing, 1, 0)
	elseif (blocker == nil) then
		return
	end
	if (open) then
		if (GetDestructableLife(blocker) > 0) then
			KillDestructable(blocker)
		end
	else
		if (GetDestructableLife(blocker) <= 0) then
			DestructableRestoreLife(blocker, GetDestructableMaxLife(blocker), false)
		end
		if (facing == 0) then
			r = Rect(x - nudgeWidth / 2, y - nudgeLength / 2, x + nudgeWidth / 2, y + nudgeLength / 2)
			NudgeObjectsInRect(r)
			RemoveRect(r)
		elseif (facing == 0) then
			r = Rect(x - nudgeLength / 2, y - nudgeWidth / 2, x + nudgeLength / 2, y + nudgeWidth / 2)
			NudgeObjectsInRect(r)
			RemoveRect(r)
		else
		end
	end
end

---@param open boolean
---@param walls number integer
---@param d destructable
function ChangeElevatorWalls(open, walls, d)
	local x = GetDestructableX(d) ---@type number real
	local y = GetDestructableY(d) ---@type number real
	local distToBlocker = 192 ---@type number real
	local distToNeighbor = 256 ---@type number real
	if (walls == bj_ELEVATOR_WALL_TYPE_ALL) or (walls == bj_ELEVATOR_WALL_TYPE_EAST) then
		if (not NearbyElevatorExists(x + distToNeighbor, y)) then
			ChangeElevatorWallBlocker(x + distToBlocker, y, 0, open)
		end
	end
	if (walls == bj_ELEVATOR_WALL_TYPE_ALL) or (walls == bj_ELEVATOR_WALL_TYPE_NORTH) then
		if (not NearbyElevatorExists(x, y + distToNeighbor)) then
			ChangeElevatorWallBlocker(x, y + distToBlocker, 90, open)
		end
	end
	if (walls == bj_ELEVATOR_WALL_TYPE_ALL) or (walls == bj_ELEVATOR_WALL_TYPE_SOUTH) then
		if (not NearbyElevatorExists(x, y - distToNeighbor)) then
			ChangeElevatorWallBlocker(x, y - distToBlocker, 90, open)
		end
	end
	if (walls == bj_ELEVATOR_WALL_TYPE_ALL) or (walls == bj_ELEVATOR_WALL_TYPE_WEST) then
		if (not NearbyElevatorExists(x - distToNeighbor, y)) then
			ChangeElevatorWallBlocker(x - distToBlocker, y, 0, open)
		end
	end
end

---@param activate boolean
---@param waygate unit
function WaygateActivateBJ(activate, waygate)
	WaygateActivate(waygate, activate)
end

---@param waygate unit
---@return boolean
function WaygateIsActiveBJ(waygate)
	return WaygateIsActive(waygate)
end

---@param waygate unit
---@param loc location
function WaygateSetDestinationLocBJ(waygate, loc)
	WaygateSetDestination(waygate, GetLocationX(loc), GetLocationY(loc))
end

---@param waygate unit
---@return location
function WaygateGetDestinationLocBJ(waygate)
	return Location(WaygateGetDestinationX(waygate), WaygateGetDestinationY(waygate))
end

---@param flag boolean
---@param whichUnit unit
function UnitSetUsesAltIconBJ(flag, whichUnit)
	UnitSetUsesAltIcon(whichUnit, flag)
end

---@param whichPlayer player
---@param key string
function ForceUIKeyBJ(whichPlayer, key)
	if (GetLocalPlayer() == whichPlayer) then
		ForceUIKey(key)
	end
end

---@param whichPlayer player
function ForceUICancelBJ(whichPlayer)
	if (GetLocalPlayer() == whichPlayer) then
		ForceUICancel()
	end
end

---@param whichGroup group
---@param callback function
function ForGroupBJ(whichGroup, callback)
	local wantDestroy = bj_wantDestroyGroup ---@type boolean
	bj_wantDestroyGroup = false
	ForGroup(whichGroup, callback)
	if (wantDestroy) then
		DestroyGroup(whichGroup)
	end
end

---@param whichUnit unit
---@param whichGroup group
function GroupAddUnitSimple(whichUnit, whichGroup)
	GroupAddUnit(whichGroup, whichUnit)
end

---@param whichUnit unit
---@param whichGroup group
function GroupRemoveUnitSimple(whichUnit, whichGroup)
	GroupRemoveUnit(whichGroup, whichUnit)
end

function GroupAddGroupEnum()
	GroupAddUnit(bj_groupAddGroupDest, GetEnumUnit())
end

---@param sourceGroup group
---@param destGroup group
function GroupAddGroup(sourceGroup, destGroup)
	local wantDestroy = bj_wantDestroyGroup ---@type boolean
	bj_wantDestroyGroup = false
	bj_groupAddGroupDest = destGroup
	ForGroup(sourceGroup, GroupAddGroupEnum)
	if (wantDestroy) then
		DestroyGroup(sourceGroup)
	end
end

function GroupRemoveGroupEnum()
	GroupRemoveUnit(bj_groupRemoveGroupDest, GetEnumUnit())
end

---@param sourceGroup group
---@param destGroup group
function GroupRemoveGroup(sourceGroup, destGroup)
	local wantDestroy = bj_wantDestroyGroup ---@type boolean
	bj_wantDestroyGroup = false
	bj_groupRemoveGroupDest = destGroup
	ForGroup(sourceGroup, GroupRemoveGroupEnum)
	if (wantDestroy) then
		DestroyGroup(sourceGroup)
	end
end

---@param whichPlayer player
---@param whichForce force
function ForceAddPlayerSimple(whichPlayer, whichForce)
	ForceAddPlayer(whichForce, whichPlayer)
end

---@param whichPlayer player
---@param whichForce force
function ForceRemovePlayerSimple(whichPlayer, whichForce)
	ForceRemovePlayer(whichForce, whichPlayer)
end

function GroupPickRandomUnitEnum()
	bj_groupRandomConsidered = bj_groupRandomConsidered + 1
	if (GetRandomInt(1, bj_groupRandomConsidered) == 1) then
		bj_groupRandomCurrentPick = GetEnumUnit()
	end
end

---@param whichGroup group
---@return unit
function GroupPickRandomUnit(whichGroup)
	local wantDestroy = bj_wantDestroyGroup ---@type boolean
	bj_wantDestroyGroup = false
	bj_groupRandomConsidered = 0
	bj_groupRandomCurrentPick = nil
	ForGroup(whichGroup, GroupPickRandomUnitEnum)
	if (wantDestroy) then
		DestroyGroup(whichGroup)
	end
	return bj_groupRandomCurrentPick
end

function ForcePickRandomPlayerEnum()
	bj_forceRandomConsidered = bj_forceRandomConsidered + 1
	if (GetRandomInt(1, bj_forceRandomConsidered) == 1) then
		bj_forceRandomCurrentPick = GetEnumPlayer()
	end
end

---@param whichForce force
---@return player
function ForcePickRandomPlayer(whichForce)
	bj_forceRandomConsidered = 0
	bj_forceRandomCurrentPick = nil
	ForForce(whichForce, ForcePickRandomPlayerEnum)
	return bj_forceRandomCurrentPick
end

---@param whichPlayer player
---@param enumFilter boolexpr
---@param enumAction function
function EnumUnitsSelected(whichPlayer, enumFilter, enumAction)
	local g = CreateGroup() ---@type group
	SyncSelections()
	GroupEnumUnitsSelected(g, whichPlayer, enumFilter)
	DestroyBoolExpr(enumFilter)
	ForGroup(g, enumAction)
	DestroyGroup(g)
end

---@param r rect
---@param filter boolexpr
---@return group
function GetUnitsInRectMatching(r, filter)
	local g = CreateGroup() ---@type group
	GroupEnumUnitsInRect(g, r, filter)
	DestroyBoolExpr(filter)
	return g
end

---@param r rect
---@return group
function GetUnitsInRectAll(r)
	return GetUnitsInRectMatching(r, nil)
end

---@return boolean
function GetUnitsInRectOfPlayerFilter()
	return GetOwningPlayer(GetFilterUnit()) == bj_groupEnumOwningPlayer
end

---@param r rect
---@param whichPlayer player
---@return group
function GetUnitsInRectOfPlayer(r, whichPlayer)
	local g = CreateGroup() ---@type group
	bj_groupEnumOwningPlayer = whichPlayer
	GroupEnumUnitsInRect(g, r, filterGetUnitsInRectOfPlayer)
	return g
end

---@param radius number real
---@param whichLocation location
---@param filter boolexpr
---@return group
function GetUnitsInRangeOfLocMatching(radius, whichLocation, filter)
	local g = CreateGroup() ---@type group
	GroupEnumUnitsInRangeOfLoc(g, whichLocation, radius, filter)
	DestroyBoolExpr(filter)
	return g
end

---@param radius number real
---@param whichLocation location
---@return group
function GetUnitsInRangeOfLocAll(radius, whichLocation)
	return GetUnitsInRangeOfLocMatching(radius, whichLocation, nil)
end

---@return boolean
function GetUnitsOfTypeIdAllFilter()
	return GetUnitTypeId(GetFilterUnit()) == bj_groupEnumTypeId
end

---@param unitid number integer
---@return group
function GetUnitsOfTypeIdAll(unitid)
	local result = CreateGroup() ---@type group
	local g = CreateGroup() ---@type group
	local index ---@type number integer
	index = 0
	while(true) do
		bj_groupEnumTypeId = unitid
		GroupClear(g)
		GroupEnumUnitsOfPlayer(g, Player(index), filterGetUnitsOfTypeIdAll)
		GroupAddGroup(g, result)
		index = index + 1
		if (index == bj_MAX_PLAYER_SLOTS) then break end
	end
	DestroyGroup(g)
	return result
end

---@param whichPlayer player
---@param filter boolexpr
---@return group
function GetUnitsOfPlayerMatching(whichPlayer, filter)
	local g = CreateGroup() ---@type group
	GroupEnumUnitsOfPlayer(g, whichPlayer, filter)
	DestroyBoolExpr(filter)
	return g
end

---@param whichPlayer player
---@return group
function GetUnitsOfPlayerAll(whichPlayer)
	return GetUnitsOfPlayerMatching(whichPlayer, nil)
end

---@return boolean
function GetUnitsOfPlayerAndTypeIdFilter()
	return GetUnitTypeId(GetFilterUnit()) == bj_groupEnumTypeId
end

---@param whichPlayer player
---@param unitid number integer
---@return group
function GetUnitsOfPlayerAndTypeId(whichPlayer, unitid)
	local g = CreateGroup() ---@type group
	bj_groupEnumTypeId = unitid
	GroupEnumUnitsOfPlayer(g, whichPlayer, filterGetUnitsOfPlayerAndTypeId)
	return g
end

---@param whichPlayer player
---@return group
function GetUnitsSelectedAll(whichPlayer)
	local g = CreateGroup() ---@type group
	SyncSelections()
	GroupEnumUnitsSelected(g, whichPlayer, nil)
	return g
end

---@param whichPlayer player
---@return force
function GetForceOfPlayer(whichPlayer)
	local f = CreateForce() ---@type force
	ForceAddPlayer(f, whichPlayer)
	return f
end

---@return force
function GetPlayersAll()
	return bj_FORCE_ALL_PLAYERS
end

---@param whichControl mapcontrol
---@return force
function GetPlayersByMapControl(whichControl)
	local f = CreateForce() ---@type force
	local playerIndex ---@type number integer
	local indexPlayer ---@type player
	playerIndex = 0
	while(true) do
		indexPlayer = Player(playerIndex)
		if GetPlayerController(indexPlayer) == whichControl then
			ForceAddPlayer(f, indexPlayer)
		end
		playerIndex = playerIndex + 1
		if (playerIndex == bj_MAX_PLAYER_SLOTS) then break end
	end
	return f
end

---@param whichPlayer player
---@return force
function GetPlayersAllies(whichPlayer)
	local f = CreateForce() ---@type force
	ForceEnumAllies(f, whichPlayer, nil)
	return f
end

---@param whichPlayer player
---@return force
function GetPlayersEnemies(whichPlayer)
	local f = CreateForce() ---@type force
	ForceEnumEnemies(f, whichPlayer, nil)
	return f
end

---@param filter boolexpr
---@return force
function GetPlayersMatching(filter)
	local f = CreateForce() ---@type force
	ForceEnumPlayers(f, filter)
	DestroyBoolExpr(filter)
	return f
end

function CountUnitsInGroupEnum()
	bj_groupCountUnits = bj_groupCountUnits + 1
end

---@param g group
---@return number integer
function CountUnitsInGroup(g)
	local wantDestroy = bj_wantDestroyGroup ---@type boolean
	bj_wantDestroyGroup = false
	bj_groupCountUnits = 0
	ForGroup(g, CountUnitsInGroupEnum)
	if (wantDestroy) then
		DestroyGroup(g)
	end
	return bj_groupCountUnits
end

function CountPlayersInForceEnum()
	bj_forceCountPlayers = bj_forceCountPlayers + 1
end

---@param f force
---@return number integer
function CountPlayersInForceBJ(f)
	bj_forceCountPlayers = 0
	ForForce(f, CountPlayersInForceEnum)
	return bj_forceCountPlayers
end

function GetRandomSubGroupEnum()
	if (bj_randomSubGroupWant > 0) then
		if (bj_randomSubGroupWant >= bj_randomSubGroupTotal) or (GetRandomReal(0, 1) < bj_randomSubGroupChance) then
			GroupAddUnit(bj_randomSubGroupGroup, GetEnumUnit())
			bj_randomSubGroupWant = bj_randomSubGroupWant - 1
		end
	end
	bj_randomSubGroupTotal = bj_randomSubGroupTotal - 1
end

---@param count number integer
---@param sourceGroup group
---@return group
function GetRandomSubGroup(count, sourceGroup)
	local g = CreateGroup() ---@type group
	bj_randomSubGroupGroup = g
	bj_randomSubGroupWant = count
	bj_randomSubGroupTotal = CountUnitsInGroup(sourceGroup)
	if (bj_randomSubGroupWant <= 0 or bj_randomSubGroupTotal <= 0) then
		return g
	end
	bj_randomSubGroupChance = I2R(bj_randomSubGroupWant) / I2R(bj_randomSubGroupTotal)
	ForGroup(sourceGroup, GetRandomSubGroupEnum)
	return g
end

---@return boolean
function LivingPlayerUnitsOfTypeIdFilter()
	local filterUnit = GetFilterUnit() ---@type unit
	return IsUnitAliveBJ(filterUnit) and GetUnitTypeId(filterUnit) == bj_livingPlayerUnitsTypeId
end

---@param unitId number integer
---@param whichPlayer player
---@return number integer
function CountLivingPlayerUnitsOfTypeId(unitId, whichPlayer)
	local g ---@type group
	local matchedCount ---@type number integer
	g = CreateGroup()
	bj_livingPlayerUnitsTypeId = unitId
	GroupEnumUnitsOfPlayer(g, whichPlayer, filterLivingPlayerUnitsOfTypeId)
	matchedCount = CountUnitsInGroup(g)
	DestroyGroup(g)
	return matchedCount
end

---@param whichUnit unit
function ResetUnitAnimation(whichUnit)
	SetUnitAnimation(whichUnit, "stand")
end

---@param whichUnit unit
---@param percentScale number real
function SetUnitTimeScalePercent(whichUnit, percentScale)
	SetUnitTimeScale(whichUnit, percentScale * 0.01)
end

---@param whichUnit unit
---@param percentScaleX number real
---@param percentScaleY number real
---@param percentScaleZ number real
function SetUnitScalePercent(whichUnit, percentScaleX, percentScaleY, percentScaleZ)
	SetUnitScale(whichUnit, percentScaleX * 0.01, percentScaleY * 0.01, percentScaleZ * 0.01)
end

---@param whichUnit unit
---@param red number real
---@param green number real
---@param blue number real
---@param transparency number real
function SetUnitVertexColorBJ(whichUnit, red, green, blue, transparency)
	SetUnitVertexColor(whichUnit, PercentTo255(red), PercentTo255(green), PercentTo255(blue), PercentTo255(100.0 - transparency))
end

---@param whichUnit unit
---@param red number real
---@param green number real
---@param blue number real
---@param transparency number real
function UnitAddIndicatorBJ(whichUnit, red, green, blue, transparency)
	AddIndicator(whichUnit, PercentTo255(red), PercentTo255(green), PercentTo255(blue), PercentTo255(100.0 - transparency))
end

---@param whichDestructable destructable
---@param red number real
---@param green number real
---@param blue number real
---@param transparency number real
function DestructableAddIndicatorBJ(whichDestructable, red, green, blue, transparency)
	AddIndicator(whichDestructable, PercentTo255(red), PercentTo255(green), PercentTo255(blue), PercentTo255(100.0 - transparency))
end

---@param whichItem item
---@param red number real
---@param green number real
---@param blue number real
---@param transparency number real
function ItemAddIndicatorBJ(whichItem, red, green, blue, transparency)
	AddIndicator(whichItem, PercentTo255(red), PercentTo255(green), PercentTo255(blue), PercentTo255(100.0 - transparency))
end

---@param whichUnit unit
---@param target location
---@param duration number real
function SetUnitFacingToFaceLocTimed(whichUnit, target, duration)
	local unitLoc = GetUnitLoc(whichUnit) ---@type location
	SetUnitFacingTimed(whichUnit, AngleBetweenPoints(unitLoc, target), duration)
	RemoveLocation(unitLoc)
end

---@param whichUnit unit
---@param target unit
---@param duration number real
function SetUnitFacingToFaceUnitTimed(whichUnit, target, duration)
	local unitLoc = GetUnitLoc(target) ---@type location
	SetUnitFacingToFaceLocTimed(whichUnit, unitLoc, duration)
	RemoveLocation(unitLoc)
end

---@param whichUnit unit
---@param whichAnimation string
function QueueUnitAnimationBJ(whichUnit, whichAnimation)
	QueueUnitAnimation(whichUnit, whichAnimation)
end

---@param d destructable
---@param whichAnimation string
function SetDestructableAnimationBJ(d, whichAnimation)
	SetDestructableAnimation(d, whichAnimation)
end

---@param d destructable
---@param whichAnimation string
function QueueDestructableAnimationBJ(d, whichAnimation)
	QueueDestructableAnimation(d, whichAnimation)
end

---@param d destructable
---@param percentScale number real
function SetDestAnimationSpeedPercent(d, percentScale)
	SetDestructableAnimationSpeed(d, percentScale * 0.01)
end

---@param flag boolean
---@param whichDialog dialog
---@param whichPlayer player
function DialogDisplayBJ(flag, whichDialog, whichPlayer)
	DialogDisplay(whichPlayer, whichDialog, flag)
end

---@param whichDialog dialog
---@param message string
function DialogSetMessageBJ(whichDialog, message)
	DialogSetMessage(whichDialog, message)
end

---@param whichDialog dialog
---@param buttonText string
---@return button
function DialogAddButtonBJ(whichDialog, buttonText)
	bj_lastCreatedButton = DialogAddButton(whichDialog, buttonText, 0)
	return bj_lastCreatedButton
end

---@param whichDialog dialog
---@param buttonText string
---@param hotkey number integer
---@return button
function DialogAddButtonWithHotkeyBJ(whichDialog, buttonText, hotkey)
	bj_lastCreatedButton = DialogAddButton(whichDialog, buttonText, hotkey)
	return bj_lastCreatedButton
end

---@param whichDialog dialog
function DialogClearBJ(whichDialog)
	DialogClear(whichDialog)
end

---@return button
function GetLastCreatedButtonBJ()
	return bj_lastCreatedButton
end

---@return button
function GetClickedButtonBJ()
	return GetClickedButton()
end

---@return dialog
function GetClickedDialogBJ()
	return GetClickedDialog()
end

---@param sourcePlayer player
---@param whichAllianceSetting alliancetype
---@param value boolean
---@param otherPlayer player
function SetPlayerAllianceBJ(sourcePlayer, whichAllianceSetting, value, otherPlayer)
	if (sourcePlayer == otherPlayer) then
		return
	end
	SetPlayerAlliance(sourcePlayer, otherPlayer, whichAllianceSetting, value)
end

---@param sourcePlayer player
---@param otherPlayer player
---@param flag boolean
function SetPlayerAllianceStateAllyBJ(sourcePlayer, otherPlayer, flag)
	SetPlayerAlliance(sourcePlayer, otherPlayer, ALLIANCE_PASSIVE, flag)
	SetPlayerAlliance(sourcePlayer, otherPlayer, ALLIANCE_HELP_REQUEST, flag)
	SetPlayerAlliance(sourcePlayer, otherPlayer, ALLIANCE_HELP_RESPONSE, flag)
	SetPlayerAlliance(sourcePlayer, otherPlayer, ALLIANCE_SHARED_XP, flag)
	SetPlayerAlliance(sourcePlayer, otherPlayer, ALLIANCE_SHARED_SPELLS, flag)
end

---@param sourcePlayer player
---@param otherPlayer player
---@param flag boolean
function SetPlayerAllianceStateVisionBJ(sourcePlayer, otherPlayer, flag)
	SetPlayerAlliance(sourcePlayer, otherPlayer, ALLIANCE_SHARED_VISION, flag)
end

---@param sourcePlayer player
---@param otherPlayer player
---@param flag boolean
function SetPlayerAllianceStateControlBJ(sourcePlayer, otherPlayer, flag)
	SetPlayerAlliance(sourcePlayer, otherPlayer, ALLIANCE_SHARED_CONTROL, flag)
end

---@param sourcePlayer player
---@param otherPlayer player
---@param flag boolean
function SetPlayerAllianceStateFullControlBJ(sourcePlayer, otherPlayer, flag)
	SetPlayerAlliance(sourcePlayer, otherPlayer, ALLIANCE_SHARED_ADVANCED_CONTROL, flag)
end

---@param sourcePlayer player
---@param otherPlayer player
---@param allianceState number integer
function SetPlayerAllianceStateBJ(sourcePlayer, otherPlayer, allianceState)
	if (sourcePlayer == otherPlayer) then
		return
	end
	if allianceState == bj_ALLIANCE_UNALLIED then
		SetPlayerAllianceStateAllyBJ(sourcePlayer, otherPlayer, false)
		SetPlayerAllianceStateVisionBJ(sourcePlayer, otherPlayer, false)
		SetPlayerAllianceStateControlBJ(sourcePlayer, otherPlayer, false)
		SetPlayerAllianceStateFullControlBJ(sourcePlayer, otherPlayer, false)
	elseif allianceState == bj_ALLIANCE_UNALLIED then
		SetPlayerAllianceStateAllyBJ(sourcePlayer, otherPlayer, false)
		SetPlayerAllianceStateVisionBJ(sourcePlayer, otherPlayer, true)
		SetPlayerAllianceStateControlBJ(sourcePlayer, otherPlayer, false)
		SetPlayerAllianceStateFullControlBJ(sourcePlayer, otherPlayer, false)
	elseif allianceState == bj_ALLIANCE_UNALLIED then
		SetPlayerAllianceStateAllyBJ(sourcePlayer, otherPlayer, true)
		SetPlayerAllianceStateVisionBJ(sourcePlayer, otherPlayer, false)
		SetPlayerAllianceStateControlBJ(sourcePlayer, otherPlayer, false)
		SetPlayerAllianceStateFullControlBJ(sourcePlayer, otherPlayer, false)
	elseif allianceState == bj_ALLIANCE_UNALLIED then
		SetPlayerAllianceStateAllyBJ(sourcePlayer, otherPlayer, true)
		SetPlayerAllianceStateVisionBJ(sourcePlayer, otherPlayer, true)
		SetPlayerAllianceStateControlBJ(sourcePlayer, otherPlayer, false)
		SetPlayerAllianceStateFullControlBJ(sourcePlayer, otherPlayer, false)
	elseif allianceState == bj_ALLIANCE_UNALLIED then
		SetPlayerAllianceStateAllyBJ(sourcePlayer, otherPlayer, true)
		SetPlayerAllianceStateVisionBJ(sourcePlayer, otherPlayer, true)
		SetPlayerAllianceStateControlBJ(sourcePlayer, otherPlayer, true)
		SetPlayerAllianceStateFullControlBJ(sourcePlayer, otherPlayer, false)
	elseif allianceState == bj_ALLIANCE_UNALLIED then
		SetPlayerAllianceStateAllyBJ(sourcePlayer, otherPlayer, true)
		SetPlayerAllianceStateVisionBJ(sourcePlayer, otherPlayer, true)
		SetPlayerAllianceStateControlBJ(sourcePlayer, otherPlayer, true)
		SetPlayerAllianceStateFullControlBJ(sourcePlayer, otherPlayer, true)
	elseif allianceState == bj_ALLIANCE_UNALLIED then
		SetPlayerAllianceStateAllyBJ(sourcePlayer, otherPlayer, false)
		SetPlayerAllianceStateVisionBJ(sourcePlayer, otherPlayer, false)
		SetPlayerAllianceStateControlBJ(sourcePlayer, otherPlayer, false)
		SetPlayerAllianceStateFullControlBJ(sourcePlayer, otherPlayer, false)
		SetPlayerAlliance(sourcePlayer, otherPlayer, ALLIANCE_PASSIVE, true)
	elseif allianceState == bj_ALLIANCE_UNALLIED then
		SetPlayerAllianceStateAllyBJ(sourcePlayer, otherPlayer, false)
		SetPlayerAllianceStateVisionBJ(sourcePlayer, otherPlayer, true)
		SetPlayerAllianceStateControlBJ(sourcePlayer, otherPlayer, false)
		SetPlayerAllianceStateFullControlBJ(sourcePlayer, otherPlayer, false)
		SetPlayerAlliance(sourcePlayer, otherPlayer, ALLIANCE_PASSIVE, true)
	else
	end
end

---@param sourceForce force
---@param targetForce force
---@param allianceState number integer
function SetForceAllianceStateBJ(sourceForce, targetForce, allianceState)
	local sourceIndex ---@type number integer
	local targetIndex ---@type number integer
	sourceIndex = 0
	while(true) do
		if (sourceForce == bj_FORCE_ALL_PLAYERS or IsPlayerInForce(Player(sourceIndex), sourceForce)) then
			targetIndex = 0
			while(true) do
				if (targetForce == bj_FORCE_ALL_PLAYERS or IsPlayerInForce(Player(targetIndex), targetForce)) then
					SetPlayerAllianceStateBJ(Player(sourceIndex), Player(targetIndex), allianceState)
				end
				targetIndex = targetIndex + 1
				if (targetIndex == bj_MAX_PLAYER_SLOTS) then break end
			end
		end
		sourceIndex = sourceIndex + 1
		if (sourceIndex == bj_MAX_PLAYER_SLOTS) then break end
	end
end

---@param playerA player
---@param playerB player
---@return boolean
function PlayersAreCoAllied(playerA, playerB)
	if (playerA == playerB) then
		return true
	end
	if GetPlayerAlliance(playerA, playerB, ALLIANCE_PASSIVE) then
		if GetPlayerAlliance(playerB, playerA, ALLIANCE_PASSIVE) then
			return true
		end
	end
	return false
end

---@param whichPlayer player
function ShareEverythingWithTeamAI(whichPlayer)
	local playerIndex ---@type number integer
	local indexPlayer ---@type player
	playerIndex = 0
	while(true) do
		indexPlayer = Player(playerIndex)
		if (PlayersAreCoAllied(whichPlayer, indexPlayer) and whichPlayer ~= indexPlayer) then
			if (GetPlayerController(indexPlayer) == MAP_CONTROL_COMPUTER) then
				SetPlayerAlliance(whichPlayer, indexPlayer, ALLIANCE_SHARED_VISION, true)
				SetPlayerAlliance(whichPlayer, indexPlayer, ALLIANCE_SHARED_CONTROL, true)
				SetPlayerAlliance(whichPlayer, indexPlayer, ALLIANCE_SHARED_ADVANCED_CONTROL, true)
			end
		end
		playerIndex = playerIndex + 1
		if (playerIndex == bj_MAX_PLAYERS) then break end
	end
end

---@param whichPlayer player
function ShareEverythingWithTeam(whichPlayer)
	local playerIndex ---@type number integer
	local indexPlayer ---@type player
	playerIndex = 0
	while(true) do
		indexPlayer = Player(playerIndex)
		if (PlayersAreCoAllied(whichPlayer, indexPlayer) and whichPlayer ~= indexPlayer) then
			SetPlayerAlliance(whichPlayer, indexPlayer, ALLIANCE_SHARED_VISION, true)
			SetPlayerAlliance(whichPlayer, indexPlayer, ALLIANCE_SHARED_CONTROL, true)
			SetPlayerAlliance(indexPlayer, whichPlayer, ALLIANCE_SHARED_CONTROL, true)
			SetPlayerAlliance(whichPlayer, indexPlayer, ALLIANCE_SHARED_ADVANCED_CONTROL, true)
		end
		playerIndex = playerIndex + 1
		if (playerIndex == bj_MAX_PLAYERS) then break end
	end
end

function ConfigureNeutralVictim()
	local index ---@type number integer
	local indexPlayer ---@type player
	local neutralVictim = Player(bj_PLAYER_NEUTRAL_VICTIM) ---@type player
	index = 0
	while(true) do
		indexPlayer = Player(index)
		SetPlayerAlliance(neutralVictim, indexPlayer, ALLIANCE_PASSIVE, true)
		SetPlayerAlliance(indexPlayer, neutralVictim, ALLIANCE_PASSIVE, false)
		index = index + 1
		if (index == bj_MAX_PLAYERS) then break end
	end
	indexPlayer = Player(PLAYER_NEUTRAL_AGGRESSIVE)
	SetPlayerAlliance(neutralVictim, indexPlayer, ALLIANCE_PASSIVE, true)
	SetPlayerAlliance(indexPlayer, neutralVictim, ALLIANCE_PASSIVE, true)
	SetPlayerState(neutralVictim, PLAYER_STATE_GIVES_BOUNTY, 0)
end

function MakeUnitsPassiveForPlayerEnum()
	SetUnitOwner(GetEnumUnit(), Player(bj_PLAYER_NEUTRAL_VICTIM), false)
end

---@param whichPlayer player
function MakeUnitsPassiveForPlayer(whichPlayer)
	local playerUnits = CreateGroup() ---@type group
	CachePlayerHeroData(whichPlayer)
	GroupEnumUnitsOfPlayer(playerUnits, whichPlayer, nil)
	ForGroup(playerUnits, MakeUnitsPassiveForPlayerEnum)
	DestroyGroup(playerUnits)
end

---@param whichPlayer player
function MakeUnitsPassiveForTeam(whichPlayer)
	local playerIndex ---@type number integer
	local indexPlayer ---@type player
	playerIndex = 0
	while(true) do
		indexPlayer = Player(playerIndex)
		if PlayersAreCoAllied(whichPlayer, indexPlayer) then
			MakeUnitsPassiveForPlayer(indexPlayer)
		end
		playerIndex = playerIndex + 1
		if (playerIndex == bj_MAX_PLAYERS) then break end
	end
end

---@param gameResult playergameresult
---@return boolean
function AllowVictoryDefeat(gameResult)
	if (gameResult == PLAYER_GAME_RESULT_VICTORY) then
		return not IsNoVictoryCheat()
	end
	if (gameResult == PLAYER_GAME_RESULT_DEFEAT) then
		return not IsNoDefeatCheat()
	end
	if (gameResult == PLAYER_GAME_RESULT_NEUTRAL) then
		return (not IsNoVictoryCheat()) and (not IsNoDefeatCheat())
	end
	return true
end

function EndGameBJ()
	EndGame(true)
end

---@param whichPlayer player
---@param leftGame boolean
function MeleeVictoryDialogBJ(whichPlayer, leftGame)
	local t = CreateTrigger() ---@type trigger
	local d = DialogCreate() ---@type dialog
	local formatString ---@type string
	if (leftGame) then
		formatString = GetLocalizedString("PLAYER_LEFT_GAME")
	else
		formatString = GetLocalizedString("PLAYER_VICTORIOUS")
	end
	DisplayTimedTextFromPlayer(whichPlayer, 0, 0, 60, formatString)
	DialogSetMessage(d, GetLocalizedString("GAMEOVER_VICTORY_MSG"))
	DialogAddButton(d, GetLocalizedString("GAMEOVER_CONTINUE_GAME"), GetLocalizedHotkey("GAMEOVER_CONTINUE_GAME"))
	t = CreateTrigger()
	TriggerRegisterDialogButtonEvent(t, DialogAddQuitButton(d, true, GetLocalizedString("GAMEOVER_QUIT_GAME"), GetLocalizedHotkey("GAMEOVER_QUIT_GAME")))
	DialogDisplay(whichPlayer, d, true)
	StartSoundForPlayerBJ(whichPlayer, bj_victoryDialogSound)
end

---@param whichPlayer player
---@param leftGame boolean
function MeleeDefeatDialogBJ(whichPlayer, leftGame)
	local t = CreateTrigger() ---@type trigger
	local d = DialogCreate() ---@type dialog
	local formatString ---@type string
	if (leftGame) then
		formatString = GetLocalizedString("PLAYER_LEFT_GAME")
	else
		formatString = GetLocalizedString("PLAYER_DEFEATED")
	end
	DisplayTimedTextFromPlayer(whichPlayer, 0, 0, 60, formatString)
	DialogSetMessage(d, GetLocalizedString("GAMEOVER_DEFEAT_MSG"))
	if (not bj_meleeGameOver and IsMapFlagSet(MAP_OBSERVERS_ON_DEATH)) then
		DialogAddButton(d, GetLocalizedString("GAMEOVER_CONTINUE_OBSERVING"), GetLocalizedHotkey("GAMEOVER_CONTINUE_OBSERVING"))
	end
	t = CreateTrigger()
	TriggerRegisterDialogButtonEvent(t, DialogAddQuitButton(d, true, GetLocalizedString("GAMEOVER_QUIT_GAME"), GetLocalizedHotkey("GAMEOVER_QUIT_GAME")))
	DialogDisplay(whichPlayer, d, true)
	StartSoundForPlayerBJ(whichPlayer, bj_defeatDialogSound)
end

---@param whichPlayer player
---@param leftGame boolean
function GameOverDialogBJ(whichPlayer, leftGame)
	local t = CreateTrigger() ---@type trigger
	local d = DialogCreate() ---@type dialog
	local s ---@type string
	DisplayTimedTextFromPlayer(whichPlayer, 0, 0, 60, GetLocalizedString("PLAYER_LEFT_GAME"))
	if (GetIntegerGameState(GAME_STATE_DISCONNECTED) ~= 0) then
		s = GetLocalizedString("GAMEOVER_DISCONNECTED")
	else
		s = GetLocalizedString("GAMEOVER_GAME_OVER")
	end
	DialogSetMessage(d, s)
	t = CreateTrigger()
	TriggerRegisterDialogButtonEvent(t, DialogAddQuitButton(d, true, GetLocalizedString("GAMEOVER_OK"), GetLocalizedHotkey("GAMEOVER_OK")))
	DialogDisplay(whichPlayer, d, true)
	StartSoundForPlayerBJ(whichPlayer, bj_defeatDialogSound)
end

---@param whichPlayer player
---@param gameResult playergameresult
---@param leftGame boolean
function RemovePlayerPreserveUnitsBJ(whichPlayer, gameResult, leftGame)
	if AllowVictoryDefeat(gameResult) then
		RemovePlayer(whichPlayer, gameResult)
		if (gameResult == PLAYER_GAME_RESULT_VICTORY) then
			MeleeVictoryDialogBJ(whichPlayer, leftGame)
			return
		elseif (gameResult == PLAYER_GAME_RESULT_VICTORY) then
			MeleeDefeatDialogBJ(whichPlayer, leftGame)
		else
			GameOverDialogBJ(whichPlayer, leftGame)
		end
	end
end

function CustomVictoryOkBJ()
	if bj_isSinglePlayer then
		PauseGame(false)
		SetGameDifficulty(GetDefaultDifficulty())
	end
	if (bj_changeLevelMapName == nil) then
		EndGame(bj_changeLevelShowScores)
	else
		ChangeLevel(bj_changeLevelMapName, bj_changeLevelShowScores)
	end
end

function CustomVictoryQuitBJ()
	if bj_isSinglePlayer then
		PauseGame(false)
		SetGameDifficulty(GetDefaultDifficulty())
	end
	EndGame(bj_changeLevelShowScores)
end

---@param whichPlayer player
function CustomVictoryDialogBJ(whichPlayer)
	local t = CreateTrigger() ---@type trigger
	local d = DialogCreate() ---@type dialog
	DialogSetMessage(d, GetLocalizedString("GAMEOVER_VICTORY_MSG"))
	t = CreateTrigger()
	TriggerRegisterDialogButtonEvent(t, DialogAddButton(d, GetLocalizedString("GAMEOVER_CONTINUE"), GetLocalizedHotkey("GAMEOVER_CONTINUE")))
	TriggerAddAction(t, CustomVictoryOkBJ)
	t = CreateTrigger()
	TriggerRegisterDialogButtonEvent(t, DialogAddButton(d, GetLocalizedString("GAMEOVER_QUIT_MISSION"), GetLocalizedHotkey("GAMEOVER_QUIT_MISSION")))
	TriggerAddAction(t, CustomVictoryQuitBJ)
	if (GetLocalPlayer() == whichPlayer) then
		EnableUserControl(true)
		if bj_isSinglePlayer then
			PauseGame(true)
		end
		EnableUserUI(false)
	end
	DialogDisplay(whichPlayer, d, true)
	VolumeGroupSetVolumeForPlayerBJ(whichPlayer, SOUND_VOLUMEGROUP_UI, 1.0)
	StartSoundForPlayerBJ(whichPlayer, bj_victoryDialogSound)
end

---@param whichPlayer player
function CustomVictorySkipBJ(whichPlayer)
	if (GetLocalPlayer() == whichPlayer) then
		if bj_isSinglePlayer then
			SetGameDifficulty(GetDefaultDifficulty())
		end
		if (bj_changeLevelMapName == nil) then
			EndGame(bj_changeLevelShowScores)
		else
			ChangeLevel(bj_changeLevelMapName, bj_changeLevelShowScores)
		end
	end
end

---@param whichPlayer player
---@param showDialog boolean
---@param showScores boolean
function CustomVictoryBJ(whichPlayer, showDialog, showScores)
	if AllowVictoryDefeat(PLAYER_GAME_RESULT_VICTORY) then
		RemovePlayer(whichPlayer, PLAYER_GAME_RESULT_VICTORY)
		if not bj_isSinglePlayer then
			DisplayTimedTextFromPlayer(whichPlayer, 0, 0, 60, GetLocalizedString("PLAYER_VICTORIOUS"))
		end
		if (GetPlayerController(whichPlayer) == MAP_CONTROL_USER) then
			bj_changeLevelShowScores = showScores
			if showDialog then
				CustomVictoryDialogBJ(whichPlayer)
			else
				CustomVictorySkipBJ(whichPlayer)
			end
		end
	end
end

function CustomDefeatRestartBJ()
	PauseGame(false)
	RestartGame(true)
end

function CustomDefeatReduceDifficultyBJ()
	local diff = GetGameDifficulty() ---@type gamedifficulty
	PauseGame(false)
	if (diff == MAP_DIFFICULTY_EASY) then
	elseif (diff == MAP_DIFFICULTY_EASY) then
		SetGameDifficulty(MAP_DIFFICULTY_EASY)
	elseif (diff == MAP_DIFFICULTY_EASY) then
		SetGameDifficulty(MAP_DIFFICULTY_NORMAL)
	else
	end
	RestartGame(true)
end

function CustomDefeatLoadBJ()
	PauseGame(false)
	DisplayLoadDialog()
end

function CustomDefeatQuitBJ()
	if bj_isSinglePlayer then
		PauseGame(false)
	end
	SetGameDifficulty(GetDefaultDifficulty())
	EndGame(true)
end

---@param whichPlayer player
---@param message string
function CustomDefeatDialogBJ(whichPlayer, message)
	local t = CreateTrigger() ---@type trigger
	local d = DialogCreate() ---@type dialog
	DialogSetMessage(d, message)
	if bj_isSinglePlayer then
		t = CreateTrigger()
		TriggerRegisterDialogButtonEvent(t, DialogAddButton(d, GetLocalizedString("GAMEOVER_RESTART"), GetLocalizedHotkey("GAMEOVER_RESTART")))
		TriggerAddAction(t, CustomDefeatRestartBJ)
		if (GetGameDifficulty() ~= MAP_DIFFICULTY_EASY) then
			t = CreateTrigger()
			TriggerRegisterDialogButtonEvent(t, DialogAddButton(d, GetLocalizedString("GAMEOVER_REDUCE_DIFFICULTY"), GetLocalizedHotkey("GAMEOVER_REDUCE_DIFFICULTY")))
			TriggerAddAction(t, CustomDefeatReduceDifficultyBJ)
		end
		t = CreateTrigger()
		TriggerRegisterDialogButtonEvent(t, DialogAddButton(d, GetLocalizedString("GAMEOVER_LOAD"), GetLocalizedHotkey("GAMEOVER_LOAD")))
		TriggerAddAction(t, CustomDefeatLoadBJ)
	end
	t = CreateTrigger()
	TriggerRegisterDialogButtonEvent(t, DialogAddButton(d, GetLocalizedString("GAMEOVER_QUIT_MISSION"), GetLocalizedHotkey("GAMEOVER_QUIT_MISSION")))
	TriggerAddAction(t, CustomDefeatQuitBJ)
	if (GetLocalPlayer() == whichPlayer) then
		EnableUserControl(true)
		if bj_isSinglePlayer then
			PauseGame(true)
		end
		EnableUserUI(false)
	end
	DialogDisplay(whichPlayer, d, true)
	VolumeGroupSetVolumeForPlayerBJ(whichPlayer, SOUND_VOLUMEGROUP_UI, 1.0)
	StartSoundForPlayerBJ(whichPlayer, bj_defeatDialogSound)
end

---@param whichPlayer player
---@param message string
function CustomDefeatBJ(whichPlayer, message)
	if AllowVictoryDefeat(PLAYER_GAME_RESULT_DEFEAT) then
		RemovePlayer(whichPlayer, PLAYER_GAME_RESULT_DEFEAT)
		if not bj_isSinglePlayer then
			DisplayTimedTextFromPlayer(whichPlayer, 0, 0, 60, GetLocalizedString("PLAYER_DEFEATED"))
		end
		if (GetPlayerController(whichPlayer) == MAP_CONTROL_USER) then
			CustomDefeatDialogBJ(whichPlayer, message)
		end
	end
end

---@param nextLevel string
function SetNextLevelBJ(nextLevel)
	if (nextLevel == "") then
		bj_changeLevelMapName = nil
	else
		bj_changeLevelMapName = nextLevel
	end
end

---@param flag boolean
---@param whichPlayer player
function SetPlayerOnScoreScreenBJ(flag, whichPlayer)
	SetPlayerOnScoreScreen(whichPlayer, flag)
end

---@param questType number integer
---@param title string
---@param description string
---@param iconPath string
---@return quest
function CreateQuestBJ(questType, title, description, iconPath)
	local required = (questType == bj_QUESTTYPE_REQ_DISCOVERED) or (questType == bj_QUESTTYPE_REQ_UNDISCOVERED) ---@type boolean
	local discovered = (questType == bj_QUESTTYPE_REQ_DISCOVERED) or (questType == bj_QUESTTYPE_OPT_DISCOVERED) ---@type boolean
	bj_lastCreatedQuest = CreateQuest()
	QuestSetTitle(bj_lastCreatedQuest, title)
	QuestSetDescription(bj_lastCreatedQuest, description)
	QuestSetIconPath(bj_lastCreatedQuest, iconPath)
	QuestSetRequired(bj_lastCreatedQuest, required)
	QuestSetDiscovered(bj_lastCreatedQuest, discovered)
	QuestSetCompleted(bj_lastCreatedQuest, false)
	return bj_lastCreatedQuest
end

---@param whichQuest quest
function DestroyQuestBJ(whichQuest)
	DestroyQuest(whichQuest)
end

---@param enabled boolean
---@param whichQuest quest
function QuestSetEnabledBJ(enabled, whichQuest)
	QuestSetEnabled(whichQuest, enabled)
end

---@param whichQuest quest
---@param title string
function QuestSetTitleBJ(whichQuest, title)
	QuestSetTitle(whichQuest, title)
end

---@param whichQuest quest
---@param description string
function QuestSetDescriptionBJ(whichQuest, description)
	QuestSetDescription(whichQuest, description)
end

---@param whichQuest quest
---@param completed boolean
function QuestSetCompletedBJ(whichQuest, completed)
	QuestSetCompleted(whichQuest, completed)
end

---@param whichQuest quest
---@param failed boolean
function QuestSetFailedBJ(whichQuest, failed)
	QuestSetFailed(whichQuest, failed)
end

---@param whichQuest quest
---@param discovered boolean
function QuestSetDiscoveredBJ(whichQuest, discovered)
	QuestSetDiscovered(whichQuest, discovered)
end

---@return quest
function GetLastCreatedQuestBJ()
	return bj_lastCreatedQuest
end

---@param whichQuest quest
---@param description string
---@return questitem
function CreateQuestItemBJ(whichQuest, description)
	bj_lastCreatedQuestItem = QuestCreateItem(whichQuest)
	QuestItemSetDescription(bj_lastCreatedQuestItem, description)
	QuestItemSetCompleted(bj_lastCreatedQuestItem, false)
	return bj_lastCreatedQuestItem
end

---@param whichQuestItem questitem
---@param description string
function QuestItemSetDescriptionBJ(whichQuestItem, description)
	QuestItemSetDescription(whichQuestItem, description)
end

---@param whichQuestItem questitem
---@param completed boolean
function QuestItemSetCompletedBJ(whichQuestItem, completed)
	QuestItemSetCompleted(whichQuestItem, completed)
end

---@return questitem
function GetLastCreatedQuestItemBJ()
	return bj_lastCreatedQuestItem
end

---@param description string
---@return defeatcondition
function CreateDefeatConditionBJ(description)
	bj_lastCreatedDefeatCondition = CreateDefeatCondition()
	DefeatConditionSetDescription(bj_lastCreatedDefeatCondition, description)
	return bj_lastCreatedDefeatCondition
end

---@param whichCondition defeatcondition
function DestroyDefeatConditionBJ(whichCondition)
	DestroyDefeatCondition(whichCondition)
end

---@param whichCondition defeatcondition
---@param description string
function DefeatConditionSetDescriptionBJ(whichCondition, description)
	DefeatConditionSetDescription(whichCondition, description)
end

---@return defeatcondition
function GetLastCreatedDefeatConditionBJ()
	return bj_lastCreatedDefeatCondition
end

function FlashQuestDialogButtonBJ()
	FlashQuestDialogButton()
end

---@param f force
---@param messageType number integer
---@param message string
function QuestMessageBJ(f, messageType, message)
	if (IsPlayerInForce(GetLocalPlayer(), f)) then
		if (messageType == bj_QUESTMESSAGE_DISCOVERED) then
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_QUEST, " ")
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_QUEST, message)
			StartSound(bj_questDiscoveredSound)
			FlashQuestDialogButton()
		elseif (messageType == bj_QUESTMESSAGE_DISCOVERED) then
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_QUESTUPDATE, " ")
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_QUESTUPDATE, message)
			StartSound(bj_questUpdatedSound)
			FlashQuestDialogButton()
		elseif (messageType == bj_QUESTMESSAGE_DISCOVERED) then
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_QUESTDONE, " ")
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_QUESTDONE, message)
			StartSound(bj_questCompletedSound)
			FlashQuestDialogButton()
		elseif (messageType == bj_QUESTMESSAGE_DISCOVERED) then
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_QUESTFAILED, " ")
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_QUESTFAILED, message)
			StartSound(bj_questFailedSound)
			FlashQuestDialogButton()
		elseif (messageType == bj_QUESTMESSAGE_DISCOVERED) then
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_QUESTREQUIREMENT, message)
		elseif (messageType == bj_QUESTMESSAGE_DISCOVERED) then
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_MISSIONFAILED, " ")
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_MISSIONFAILED, message)
			StartSound(bj_questFailedSound)
		elseif (messageType == bj_QUESTMESSAGE_DISCOVERED) then
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_HINT, " ")
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_HINT, message)
			StartSound(bj_questHintSound)
		elseif (messageType == bj_QUESTMESSAGE_DISCOVERED) then
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_ALWAYSHINT, " ")
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_ALWAYSHINT, message)
			StartSound(bj_questHintSound)
		elseif (messageType == bj_QUESTMESSAGE_DISCOVERED) then
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_SECRET, " ")
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_SECRET, message)
			StartSound(bj_questSecretSound)
		elseif (messageType == bj_QUESTMESSAGE_DISCOVERED) then
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_UNITACQUIRED, " ")
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_UNITACQUIRED, message)
			StartSound(bj_questHintSound)
		elseif (messageType == bj_QUESTMESSAGE_DISCOVERED) then
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_UNITAVAILABLE, " ")
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_UNITAVAILABLE, message)
			StartSound(bj_questHintSound)
		elseif (messageType == bj_QUESTMESSAGE_DISCOVERED) then
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_ITEMACQUIRED, " ")
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_ITEMACQUIRED, message)
			StartSound(bj_questItemAcquiredSound)
		elseif (messageType == bj_QUESTMESSAGE_DISCOVERED) then
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_WARNING, " ")
			DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_TEXT_DELAY_WARNING, message)
			StartSound(bj_questWarningSound)
		else
		end
	end
end

---@param t timer
---@param periodic boolean
---@param timeout number real
---@return timer
function StartTimerBJ(t, periodic, timeout)
	bj_lastStartedTimer = t
	TimerStart(t, timeout, periodic, nil)
	return bj_lastStartedTimer
end

---@param periodic boolean
---@param timeout number real
---@return timer
function CreateTimerBJ(periodic, timeout)
	bj_lastStartedTimer = CreateTimer()
	TimerStart(bj_lastStartedTimer, timeout, periodic, nil)
	return bj_lastStartedTimer
end

---@param whichTimer timer
function DestroyTimerBJ(whichTimer)
	DestroyTimer(whichTimer)
end

---@param pause boolean
---@param whichTimer timer
function PauseTimerBJ(pause, whichTimer)
	if pause then
		PauseTimer(whichTimer)
	else
		ResumeTimer(whichTimer)
	end
end

---@return timer
function GetLastCreatedTimerBJ()
	return bj_lastStartedTimer
end

---@param t timer
---@param title string
---@return timerdialog
function CreateTimerDialogBJ(t, title)
	bj_lastCreatedTimerDialog = CreateTimerDialog(t)
	TimerDialogSetTitle(bj_lastCreatedTimerDialog, title)
	TimerDialogDisplay(bj_lastCreatedTimerDialog, true)
	return bj_lastCreatedTimerDialog
end

---@param td timerdialog
function DestroyTimerDialogBJ(td)
	DestroyTimerDialog(td)
end

---@param td timerdialog
---@param title string
function TimerDialogSetTitleBJ(td, title)
	TimerDialogSetTitle(td, title)
end

---@param td timerdialog
---@param red number real
---@param green number real
---@param blue number real
---@param transparency number real
function TimerDialogSetTitleColorBJ(td, red, green, blue, transparency)
	TimerDialogSetTitleColor(td, PercentTo255(red), PercentTo255(green), PercentTo255(blue), PercentTo255(100.0 - transparency))
end

---@param td timerdialog
---@param red number real
---@param green number real
---@param blue number real
---@param transparency number real
function TimerDialogSetTimeColorBJ(td, red, green, blue, transparency)
	TimerDialogSetTimeColor(td, PercentTo255(red), PercentTo255(green), PercentTo255(blue), PercentTo255(100.0 - transparency))
end

---@param td timerdialog
---@param speedMultFactor number real
function TimerDialogSetSpeedBJ(td, speedMultFactor)
	TimerDialogSetSpeed(td, speedMultFactor)
end

---@param show boolean
---@param td timerdialog
---@param whichPlayer player
function TimerDialogDisplayForPlayerBJ(show, td, whichPlayer)
	if (GetLocalPlayer() == whichPlayer) then
		TimerDialogDisplay(td, show)
	end
end

---@param show boolean
---@param td timerdialog
function TimerDialogDisplayBJ(show, td)
	TimerDialogDisplay(td, show)
end

---@return timerdialog
function GetLastCreatedTimerDialogBJ()
	return bj_lastCreatedTimerDialog
end

---@param lb leaderboard
function LeaderboardResizeBJ(lb)
	local size = LeaderboardGetItemCount(lb) ---@type number integer
	if (LeaderboardGetLabelText(lb) == "") then
		size = size - 1
	end
	LeaderboardSetSizeByItemCount(lb, size)
end

---@param whichPlayer player
---@param lb leaderboard
---@param val number integer
function LeaderboardSetPlayerItemValueBJ(whichPlayer, lb, val)
	LeaderboardSetItemValue(lb, LeaderboardGetPlayerIndex(lb, whichPlayer), val)
end

---@param whichPlayer player
---@param lb leaderboard
---@param val string
function LeaderboardSetPlayerItemLabelBJ(whichPlayer, lb, val)
	LeaderboardSetItemLabel(lb, LeaderboardGetPlayerIndex(lb, whichPlayer), val)
end

---@param whichPlayer player
---@param lb leaderboard
---@param showLabel boolean
---@param showValue boolean
---@param showIcon boolean
function LeaderboardSetPlayerItemStyleBJ(whichPlayer, lb, showLabel, showValue, showIcon)
	LeaderboardSetItemStyle(lb, LeaderboardGetPlayerIndex(lb, whichPlayer), showLabel, showValue, showIcon)
end

---@param whichPlayer player
---@param lb leaderboard
---@param red number real
---@param green number real
---@param blue number real
---@param transparency number real
function LeaderboardSetPlayerItemLabelColorBJ(whichPlayer, lb, red, green, blue, transparency)
	LeaderboardSetItemLabelColor(lb, LeaderboardGetPlayerIndex(lb, whichPlayer), PercentTo255(red), PercentTo255(green), PercentTo255(blue), PercentTo255(100.0 - transparency))
end

---@param whichPlayer player
---@param lb leaderboard
---@param red number real
---@param green number real
---@param blue number real
---@param transparency number real
function LeaderboardSetPlayerItemValueColorBJ(whichPlayer, lb, red, green, blue, transparency)
	LeaderboardSetItemValueColor(lb, LeaderboardGetPlayerIndex(lb, whichPlayer), PercentTo255(red), PercentTo255(green), PercentTo255(blue), PercentTo255(100.0 - transparency))
end

---@param lb leaderboard
---@param red number real
---@param green number real
---@param blue number real
---@param transparency number real
function LeaderboardSetLabelColorBJ(lb, red, green, blue, transparency)
	LeaderboardSetLabelColor(lb, PercentTo255(red), PercentTo255(green), PercentTo255(blue), PercentTo255(100.0 - transparency))
end

---@param lb leaderboard
---@param red number real
---@param green number real
---@param blue number real
---@param transparency number real
function LeaderboardSetValueColorBJ(lb, red, green, blue, transparency)
	LeaderboardSetValueColor(lb, PercentTo255(red), PercentTo255(green), PercentTo255(blue), PercentTo255(100.0 - transparency))
end

---@param lb leaderboard
---@param label string
function LeaderboardSetLabelBJ(lb, label)
	LeaderboardSetLabel(lb, label)
	LeaderboardResizeBJ(lb)
end

---@param lb leaderboard
---@param showLabel boolean
---@param showNames boolean
---@param showValues boolean
---@param showIcons boolean
function LeaderboardSetStyleBJ(lb, showLabel, showNames, showValues, showIcons)
	LeaderboardSetStyle(lb, showLabel, showNames, showValues, showIcons)
end

---@param lb leaderboard
---@return number integer
function LeaderboardGetItemCountBJ(lb)
	return LeaderboardGetItemCount(lb)
end

---@param lb leaderboard
---@param whichPlayer player
---@return boolean
function LeaderboardHasPlayerItemBJ(lb, whichPlayer)
	return LeaderboardHasPlayerItem(lb, whichPlayer)
end

---@param lb leaderboard
---@param toForce force
function ForceSetLeaderboardBJ(lb, toForce)
	local index ---@type number integer
	local indexPlayer ---@type player
	index = 0
	while(true) do
		indexPlayer = Player(index)
		if IsPlayerInForce(indexPlayer, toForce) then
			PlayerSetLeaderboard(indexPlayer, lb)
		end
		index = index + 1
		if (index == bj_MAX_PLAYERS) then break end
	end
end

---@param toForce force
---@param label string
---@return leaderboard
function CreateLeaderboardBJ(toForce, label)
	bj_lastCreatedLeaderboard = CreateLeaderboard()
	LeaderboardSetLabel(bj_lastCreatedLeaderboard, label)
	ForceSetLeaderboardBJ(bj_lastCreatedLeaderboard, toForce)
	LeaderboardDisplay(bj_lastCreatedLeaderboard, true)
	return bj_lastCreatedLeaderboard
end

---@param lb leaderboard
function DestroyLeaderboardBJ(lb)
	DestroyLeaderboard(lb)
end

---@param show boolean
---@param lb leaderboard
function LeaderboardDisplayBJ(show, lb)
	LeaderboardDisplay(lb, show)
end

---@param whichPlayer player
---@param lb leaderboard
---@param label string
---@param value number integer
function LeaderboardAddItemBJ(whichPlayer, lb, label, value)
	if (LeaderboardHasPlayerItem(lb, whichPlayer)) then
		LeaderboardRemovePlayerItem(lb, whichPlayer)
	end
	LeaderboardAddItem(lb, label, value, whichPlayer)
	LeaderboardResizeBJ(lb)
end

---@param whichPlayer player
---@param lb leaderboard
function LeaderboardRemovePlayerItemBJ(whichPlayer, lb)
	LeaderboardRemovePlayerItem(lb, whichPlayer)
	LeaderboardResizeBJ(lb)
end

---@param lb leaderboard
---@param sortType number integer
---@param ascending boolean
function LeaderboardSortItemsBJ(lb, sortType, ascending)
	if (sortType == bj_SORTTYPE_SORTBYVALUE) then
		LeaderboardSortItemsByValue(lb, ascending)
	elseif (sortType == bj_SORTTYPE_SORTBYVALUE) then
		LeaderboardSortItemsByPlayer(lb, ascending)
	elseif (sortType == bj_SORTTYPE_SORTBYVALUE) then
		LeaderboardSortItemsByLabel(lb, ascending)
	else
	end
end

---@param lb leaderboard
---@param ascending boolean
function LeaderboardSortItemsByPlayerBJ(lb, ascending)
	LeaderboardSortItemsByPlayer(lb, ascending)
end

---@param lb leaderboard
---@param ascending boolean
function LeaderboardSortItemsByLabelBJ(lb, ascending)
	LeaderboardSortItemsByLabel(lb, ascending)
end

---@param whichPlayer player
---@param lb leaderboard
---@return number integer
function LeaderboardGetPlayerIndexBJ(whichPlayer, lb)
	return LeaderboardGetPlayerIndex(lb, whichPlayer) + 1
end

---@param position number integer
---@param lb leaderboard
---@return player
function LeaderboardGetIndexedPlayerBJ(position, lb)
	local index ---@type number integer
	local indexPlayer ---@type player
	index = 0
	while(true) do
		indexPlayer = Player(index)
		if (LeaderboardGetPlayerIndex(lb, indexPlayer) == position - 1) then
			return indexPlayer
		end
		index = index + 1
		if (index == bj_MAX_PLAYERS) then break end
	end
	return Player(PLAYER_NEUTRAL_PASSIVE)
end

---@param whichPlayer player
---@return leaderboard
function PlayerGetLeaderboardBJ(whichPlayer)
	return PlayerGetLeaderboard(whichPlayer)
end

---@return leaderboard
function GetLastCreatedLeaderboard()
	return bj_lastCreatedLeaderboard
end

---@param cols number integer
---@param rows number integer
---@param title string
---@return multiboard
function CreateMultiboardBJ(cols, rows, title)
	bj_lastCreatedMultiboard = CreateMultiboard()
	MultiboardSetRowCount(bj_lastCreatedMultiboard, rows)
	MultiboardSetColumnCount(bj_lastCreatedMultiboard, cols)
	MultiboardSetTitleText(bj_lastCreatedMultiboard, title)
	MultiboardDisplay(bj_lastCreatedMultiboard, true)
	return bj_lastCreatedMultiboard
end

---@param mb multiboard
function DestroyMultiboardBJ(mb)
	DestroyMultiboard(mb)
end

---@return multiboard
function GetLastCreatedMultiboard()
	return bj_lastCreatedMultiboard
end

---@param show boolean
---@param mb multiboard
function MultiboardDisplayBJ(show, mb)
	MultiboardDisplay(mb, show)
end

---@param minimize boolean
---@param mb multiboard
function MultiboardMinimizeBJ(minimize, mb)
	MultiboardMinimize(mb, minimize)
end

---@param mb multiboard
---@param red number real
---@param green number real
---@param blue number real
---@param transparency number real
function MultiboardSetTitleTextColorBJ(mb, red, green, blue, transparency)
	MultiboardSetTitleTextColor(mb, PercentTo255(red), PercentTo255(green), PercentTo255(blue), PercentTo255(100.0 - transparency))
end

---@param flag boolean
function MultiboardAllowDisplayBJ(flag)
	MultiboardSuppressDisplay(not flag)
end

---@param mb multiboard
---@param col number integer
---@param row number integer
---@param showValue boolean
---@param showIcon boolean
function MultiboardSetItemStyleBJ(mb, col, row, showValue, showIcon)
	local curRow = 0 ---@type number integer
	local curCol = 0 ---@type number integer
	local numRows = MultiboardGetRowCount(mb) ---@type number integer
	local numCols = MultiboardGetColumnCount(mb) ---@type number integer
	local mbitem = nil ---@type multiboarditem
	while(true) do
		curRow = curRow + 1
		if (curRow > numRows) then break end
		if (row == 0 or row == curRow) then
			curCol = 0
			while(true) do
				curCol = curCol + 1
				if (curCol > numCols) then break end
				if (col == 0 or col == curCol) then
					mbitem = MultiboardGetItem(mb, curRow - 1, curCol - 1)
					MultiboardSetItemStyle(mbitem, showValue, showIcon)
					MultiboardReleaseItem(mbitem)
				end
			end
		end
	end
end

---@param mb multiboard
---@param col number integer
---@param row number integer
---@param val string
function MultiboardSetItemValueBJ(mb, col, row, val)
	local curRow = 0 ---@type number integer
	local curCol = 0 ---@type number integer
	local numRows = MultiboardGetRowCount(mb) ---@type number integer
	local numCols = MultiboardGetColumnCount(mb) ---@type number integer
	local mbitem = nil ---@type multiboarditem
	while(true) do
		curRow = curRow + 1
		if (curRow > numRows) then break end
		if (row == 0 or row == curRow) then
			curCol = 0
			while(true) do
				curCol = curCol + 1
				if (curCol > numCols) then break end
				if (col == 0 or col == curCol) then
					mbitem = MultiboardGetItem(mb, curRow - 1, curCol - 1)
					MultiboardSetItemValue(mbitem, val)
					MultiboardReleaseItem(mbitem)
				end
			end
		end
	end
end

---@param mb multiboard
---@param col number integer
---@param row number integer
---@param red number real
---@param green number real
---@param blue number real
---@param transparency number real
function MultiboardSetItemColorBJ(mb, col, row, red, green, blue, transparency)
	local curRow = 0 ---@type number integer
	local curCol = 0 ---@type number integer
	local numRows = MultiboardGetRowCount(mb) ---@type number integer
	local numCols = MultiboardGetColumnCount(mb) ---@type number integer
	local mbitem = nil ---@type multiboarditem
	while(true) do
		curRow = curRow + 1
		if (curRow > numRows) then break end
		if (row == 0 or row == curRow) then
			curCol = 0
			while(true) do
				curCol = curCol + 1
				if (curCol > numCols) then break end
				if (col == 0 or col == curCol) then
					mbitem = MultiboardGetItem(mb, curRow - 1, curCol - 1)
					MultiboardSetItemValueColor(mbitem, PercentTo255(red), PercentTo255(green), PercentTo255(blue), PercentTo255(100.0 - transparency))
					MultiboardReleaseItem(mbitem)
				end
			end
		end
	end
end

---@param mb multiboard
---@param col number integer
---@param row number integer
---@param width number real
function MultiboardSetItemWidthBJ(mb, col, row, width)
	local curRow = 0 ---@type number integer
	local curCol = 0 ---@type number integer
	local numRows = MultiboardGetRowCount(mb) ---@type number integer
	local numCols = MultiboardGetColumnCount(mb) ---@type number integer
	local mbitem = nil ---@type multiboarditem
	while(true) do
		curRow = curRow + 1
		if (curRow > numRows) then break end
		if (row == 0 or row == curRow) then
			curCol = 0
			while(true) do
				curCol = curCol + 1
				if (curCol > numCols) then break end
				if (col == 0 or col == curCol) then
					mbitem = MultiboardGetItem(mb, curRow - 1, curCol - 1)
					MultiboardSetItemWidth(mbitem, width / 100.0)
					MultiboardReleaseItem(mbitem)
				end
			end
		end
	end
end

---@param mb multiboard
---@param col number integer
---@param row number integer
---@param iconFileName string
function MultiboardSetItemIconBJ(mb, col, row, iconFileName)
	local curRow = 0 ---@type number integer
	local curCol = 0 ---@type number integer
	local numRows = MultiboardGetRowCount(mb) ---@type number integer
	local numCols = MultiboardGetColumnCount(mb) ---@type number integer
	local mbitem = nil ---@type multiboarditem
	while(true) do
		curRow = curRow + 1
		if (curRow > numRows) then break end
		if (row == 0 or row == curRow) then
			curCol = 0
			while(true) do
				curCol = curCol + 1
				if (curCol > numCols) then break end
				if (col == 0 or col == curCol) then
					mbitem = MultiboardGetItem(mb, curRow - 1, curCol - 1)
					MultiboardSetItemIcon(mbitem, iconFileName)
					MultiboardReleaseItem(mbitem)
				end
			end
		end
	end
end

---@param size number real
---@return number real
function TextTagSize2Height(size)
	return size * 0.023 / 10
end

---@param speed number real
---@return number real
function TextTagSpeed2Velocity(speed)
	return speed * 0.071 / 128
end

---@param tt texttag
---@param red number real
---@param green number real
---@param blue number real
---@param transparency number real
function SetTextTagColorBJ(tt, red, green, blue, transparency)
	SetTextTagColor(tt, PercentTo255(red), PercentTo255(green), PercentTo255(blue), PercentTo255(100.0 - transparency))
end

---@param tt texttag
---@param speed number real
---@param angle number real
function SetTextTagVelocityBJ(tt, speed, angle)
	local vel = TextTagSpeed2Velocity(speed) ---@type number real
	local xvel = vel * Cos(angle * bj_DEGTORAD) ---@type number real
	local yvel = vel * Sin(angle * bj_DEGTORAD) ---@type number real
	SetTextTagVelocity(tt, xvel, yvel)
end

---@param tt texttag
---@param s string
---@param size number real
function SetTextTagTextBJ(tt, s, size)
	local textHeight = TextTagSize2Height(size) ---@type number real
	SetTextTagText(tt, s, textHeight)
end

---@param tt texttag
---@param loc location
---@param zOffset number real
function SetTextTagPosBJ(tt, loc, zOffset)
	SetTextTagPos(tt, GetLocationX(loc), GetLocationY(loc), zOffset)
end

---@param tt texttag
---@param whichUnit unit
---@param zOffset number real
function SetTextTagPosUnitBJ(tt, whichUnit, zOffset)
	SetTextTagPosUnit(tt, whichUnit, zOffset)
end

---@param tt texttag
---@param flag boolean
function SetTextTagSuspendedBJ(tt, flag)
	SetTextTagSuspended(tt, flag)
end

---@param tt texttag
---@param flag boolean
function SetTextTagPermanentBJ(tt, flag)
	SetTextTagPermanent(tt, flag)
end

---@param tt texttag
---@param age number real
function SetTextTagAgeBJ(tt, age)
	SetTextTagAge(tt, age)
end

---@param tt texttag
---@param lifespan number real
function SetTextTagLifespanBJ(tt, lifespan)
	SetTextTagLifespan(tt, lifespan)
end

---@param tt texttag
---@param fadepoint number real
function SetTextTagFadepointBJ(tt, fadepoint)
	SetTextTagFadepoint(tt, fadepoint)
end

---@param s string
---@param loc location
---@param zOffset number real
---@param size number real
---@param red number real
---@param green number real
---@param blue number real
---@param transparency number real
---@return texttag
function CreateTextTagLocBJ(s, loc, zOffset, size, red, green, blue, transparency)
	bj_lastCreatedTextTag = CreateTextTag()
	SetTextTagTextBJ(bj_lastCreatedTextTag, s, size)
	SetTextTagPosBJ(bj_lastCreatedTextTag, loc, zOffset)
	SetTextTagColorBJ(bj_lastCreatedTextTag, red, green, blue, transparency)
	return bj_lastCreatedTextTag
end

---@param s string
---@param whichUnit unit
---@param zOffset number real
---@param size number real
---@param red number real
---@param green number real
---@param blue number real
---@param transparency number real
---@return texttag
function CreateTextTagUnitBJ(s, whichUnit, zOffset, size, red, green, blue, transparency)
	bj_lastCreatedTextTag = CreateTextTag()
	SetTextTagTextBJ(bj_lastCreatedTextTag, s, size)
	SetTextTagPosUnitBJ(bj_lastCreatedTextTag, whichUnit, zOffset)
	SetTextTagColorBJ(bj_lastCreatedTextTag, red, green, blue, transparency)
	return bj_lastCreatedTextTag
end

---@param tt texttag
function DestroyTextTagBJ(tt)
	DestroyTextTag(tt)
end

---@param show boolean
---@param tt texttag
---@param whichForce force
function ShowTextTagForceBJ(show, tt, whichForce)
	if (IsPlayerInForce(GetLocalPlayer(), whichForce)) then
		SetTextTagVisibility(tt, show)
	end
end

---@return texttag
function GetLastCreatedTextTag()
	return bj_lastCreatedTextTag
end

function PauseGameOn()
	PauseGame(true)
end

function PauseGameOff()
	PauseGame(false)
end

---@param whichForce force
function SetUserControlForceOn(whichForce)
	if (IsPlayerInForce(GetLocalPlayer(), whichForce)) then
		EnableUserControl(true)
	end
end

---@param whichForce force
function SetUserControlForceOff(whichForce)
	if (IsPlayerInForce(GetLocalPlayer(), whichForce)) then
		EnableUserControl(false)
	end
end

---@param whichForce force
---@param fadeDuration number real
function ShowInterfaceForceOn(whichForce, fadeDuration)
	if (IsPlayerInForce(GetLocalPlayer(), whichForce)) then
		ShowInterface(true, fadeDuration)
	end
end

---@param whichForce force
---@param fadeDuration number real
function ShowInterfaceForceOff(whichForce, fadeDuration)
	if (IsPlayerInForce(GetLocalPlayer(), whichForce)) then
		ShowInterface(false, fadeDuration)
	end
end

---@param whichForce force
---@param x number real
---@param y number real
---@param duration number real
function PingMinimapForForce(whichForce, x, y, duration)
	if (IsPlayerInForce(GetLocalPlayer(), whichForce)) then
		PingMinimap(x, y, duration)
	end
end

---@param whichForce force
---@param loc location
---@param duration number real
function PingMinimapLocForForce(whichForce, loc, duration)
	PingMinimapForForce(whichForce, GetLocationX(loc), GetLocationY(loc), duration)
end

---@param whichPlayer player
---@param x number real
---@param y number real
---@param duration number real
function PingMinimapForPlayer(whichPlayer, x, y, duration)
	if (GetLocalPlayer() == whichPlayer) then
		PingMinimap(x, y, duration)
	end
end

---@param whichPlayer player
---@param loc location
---@param duration number real
function PingMinimapLocForPlayer(whichPlayer, loc, duration)
	PingMinimapForPlayer(whichPlayer, GetLocationX(loc), GetLocationY(loc), duration)
end

---@param whichForce force
---@param x number real
---@param y number real
---@param duration number real
---@param style number integer
---@param red number real
---@param green number real
---@param blue number real
function PingMinimapForForceEx(whichForce, x, y, duration, style, red, green, blue)
	local red255 = PercentTo255(red) ---@type number integer
	local green255 = PercentTo255(green) ---@type number integer
	local blue255 = PercentTo255(blue) ---@type number integer
	if (IsPlayerInForce(GetLocalPlayer(), whichForce)) then
		if (red255 == 255) and (green255 == 0) and (blue255 == 0) then
			red255 = 254
		end
		if (style == bj_MINIMAPPINGSTYLE_SIMPLE) then
			PingMinimapEx(x, y, duration, red255, green255, blue255, false)
		elseif (style == bj_MINIMAPPINGSTYLE_SIMPLE) then
			PingMinimapEx(x, y, duration, red255, green255, blue255, true)
		elseif (style == bj_MINIMAPPINGSTYLE_SIMPLE) then
			PingMinimapEx(x, y, duration, 255, 0, 0, false)
		else
		end
	end
end

---@param whichForce force
---@param loc location
---@param duration number real
---@param style number integer
---@param red number real
---@param green number real
---@param blue number real
function PingMinimapLocForForceEx(whichForce, loc, duration, style, red, green, blue)
	PingMinimapForForceEx(whichForce, GetLocationX(loc), GetLocationY(loc), duration, style, red, green, blue)
end

---@param enable boolean
---@param f force
function EnableWorldFogBoundaryBJ(enable, f)
	if (IsPlayerInForce(GetLocalPlayer(), f)) then
		EnableWorldFogBoundary(enable)
	end
end

---@param enable boolean
---@param f force
function EnableOcclusionBJ(enable, f)
	if (IsPlayerInForce(GetLocalPlayer(), f)) then
		EnableOcclusion(enable)
	end
end

function CancelCineSceneBJ()
	StopSoundBJ(bj_cineSceneLastSound, true)
	EndCinematicScene()
end

function TryInitCinematicBehaviorBJ()
	local index ---@type number integer
	if (bj_cineSceneBeingSkipped == nil) then
		bj_cineSceneBeingSkipped = CreateTrigger()
		index = 0
		while(true) do
			TriggerRegisterPlayerEvent(bj_cineSceneBeingSkipped, Player(index), EVENT_PLAYER_END_CINEMATIC)
			index = index + 1
			if (index == bj_MAX_PLAYERS) then break end
		end
		TriggerAddAction(bj_cineSceneBeingSkipped, CancelCineSceneBJ)
	end
end

---@param soundHandle sound
---@param portraitUnitId number integer
---@param color playercolor
---@param speakerTitle string
---@param text string
---@param sceneDuration number real
---@param voiceoverDuration number real
function SetCinematicSceneBJ(soundHandle, portraitUnitId, color, speakerTitle, text, sceneDuration, voiceoverDuration)
	bj_cineSceneLastSound = soundHandle
	PlaySoundBJ(soundHandle)
	SetCinematicScene(portraitUnitId, color, speakerTitle, text, sceneDuration, voiceoverDuration)
end

---@param soundHandle sound
---@param timeType number integer
---@param timeVal number real
---@return number real
function GetTransmissionDuration(soundHandle, timeType, timeVal)
	local duration ---@type number real
	if (timeType == bj_TIMETYPE_ADD) then
		duration = GetSoundDurationBJ(soundHandle) + timeVal
	elseif (timeType == bj_TIMETYPE_ADD) then
		duration = timeVal
	elseif (timeType == bj_TIMETYPE_ADD) then
		duration = GetSoundDurationBJ(soundHandle) - timeVal
	else
		duration = GetSoundDurationBJ(soundHandle)
	end
	if (duration < 0) then
		duration = 0
	end
	return duration
end

---@param soundHandle sound
---@param timeType number integer
---@param timeVal number real
function WaitTransmissionDuration(soundHandle, timeType, timeVal)
	if (timeType == bj_TIMETYPE_SET) then
		TriggerSleepAction(timeVal)
	elseif (timeType == bj_TIMETYPE_SET) then
		TriggerSleepAction(bj_NOTHING_SOUND_DURATION)
	elseif (timeType == bj_TIMETYPE_SET) then
		WaitForSoundBJ(soundHandle, timeVal)
	elseif (timeType == bj_TIMETYPE_SET) then
		WaitForSoundBJ(soundHandle, 0)
		TriggerSleepAction(timeVal)
	else
	end
end

---@param unitId number integer
---@param color playercolor
---@param x number real
---@param y number real
---@param soundHandle sound
---@param unitName string
---@param message string
---@param duration number real
function DoTransmissionBasicsXYBJ(unitId, color, x, y, soundHandle, unitName, message, duration)
	SetCinematicSceneBJ(soundHandle, unitId, color, unitName, message, duration + bj_TRANSMISSION_PORT_HANGTIME, duration)
	if (unitId ~= 0) then
		PingMinimap(x, y, bj_TRANSMISSION_PING_TIME)
	end
end

---@param toForce force
---@param whichUnit unit
---@param unitName string
---@param soundHandle sound
---@param message string
---@param timeType number integer
---@param timeVal number real
---@param wait boolean
function TransmissionFromUnitWithNameBJ(toForce, whichUnit, unitName, soundHandle, message, timeType, timeVal, wait)
	TryInitCinematicBehaviorBJ()
	timeVal = RMaxBJ(timeVal, 0)
	bj_lastTransmissionDuration = GetTransmissionDuration(soundHandle, timeType, timeVal)
	bj_lastPlayedSound = soundHandle
	if (IsPlayerInForce(GetLocalPlayer(), toForce)) then
		if (whichUnit == nil) then
			DoTransmissionBasicsXYBJ(0, PLAYER_COLOR_RED, 0, 0, soundHandle, unitName, message, bj_lastTransmissionDuration)
		else
			DoTransmissionBasicsXYBJ(GetUnitTypeId(whichUnit), GetPlayerColor(GetOwningPlayer(whichUnit)), GetUnitX(whichUnit), GetUnitY(whichUnit), soundHandle, unitName, message, bj_lastTransmissionDuration)
			if (not IsUnitHidden(whichUnit)) then
				UnitAddIndicator(whichUnit, bj_TRANSMISSION_IND_RED, bj_TRANSMISSION_IND_BLUE, bj_TRANSMISSION_IND_GREEN, bj_TRANSMISSION_IND_ALPHA)
			end
		end
	end
	if wait and (bj_lastTransmissionDuration > 0) then
		WaitTransmissionDuration(soundHandle, timeType, timeVal)
	end
end

---@param toForce force
---@param fromPlayer player
---@param unitId number integer
---@param unitName string
---@param loc location
---@param soundHandle sound
---@param message string
---@param timeType number integer
---@param timeVal number real
---@param wait boolean
function TransmissionFromUnitTypeWithNameBJ(toForce, fromPlayer, unitId, unitName, loc, soundHandle, message, timeType, timeVal, wait)
	TryInitCinematicBehaviorBJ()
	timeVal = RMaxBJ(timeVal, 0)
	bj_lastTransmissionDuration = GetTransmissionDuration(soundHandle, timeType, timeVal)
	bj_lastPlayedSound = soundHandle
	if (IsPlayerInForce(GetLocalPlayer(), toForce)) then
		DoTransmissionBasicsXYBJ(unitId, GetPlayerColor(fromPlayer), GetLocationX(loc), GetLocationY(loc), soundHandle, unitName, message, bj_lastTransmissionDuration)
	end
	if wait and (bj_lastTransmissionDuration > 0) then
		WaitTransmissionDuration(soundHandle, timeType, timeVal)
	end
end

---@return number real
function GetLastTransmissionDurationBJ()
	return bj_lastTransmissionDuration
end

---@param flag boolean
function ForceCinematicSubtitlesBJ(flag)
	ForceCinematicSubtitles(flag)
end

---@param cineMode boolean
---@param forForce force
---@param interfaceFadeTime number real
function CinematicModeExBJ(cineMode, forForce, interfaceFadeTime)
	if (not bj_gameStarted) then
		interfaceFadeTime = 0
	end
	if (cineMode) then
		if (not bj_cineModeAlreadyIn) then
			bj_cineModeAlreadyIn = true
			bj_cineModePriorSpeed = GetGameSpeed()
			bj_cineModePriorFogSetting = IsFogEnabled()
			bj_cineModePriorMaskSetting = IsFogMaskEnabled()
			bj_cineModePriorDawnDusk = IsDawnDuskEnabled()
			bj_cineModeSavedSeed = GetRandomInt(0, 1000000)
		end
		if (IsPlayerInForce(GetLocalPlayer(), forForce)) then
			ClearTextMessages()
			ShowInterface(false, interfaceFadeTime)
			EnableUserControl(false)
			EnableOcclusion(false)
			SetCineModeVolumeGroupsBJ()
		end
		SetGameSpeed(bj_CINEMODE_GAMESPEED)
		SetMapFlag(MAP_LOCK_SPEED, true)
		FogMaskEnable(false)
		FogEnable(false)
		EnableWorldFogBoundary(false)
		EnableDawnDusk(false)
		SetRandomSeed(0)
	else
		bj_cineModeAlreadyIn = false
		if (IsPlayerInForce(GetLocalPlayer(), forForce)) then
			ShowInterface(true, interfaceFadeTime)
			EnableUserControl(true)
			EnableOcclusion(true)
			VolumeGroupReset()
			EndThematicMusic()
			CameraResetSmoothingFactorBJ()
		end
		SetMapFlag(MAP_LOCK_SPEED, false)
		SetGameSpeed(bj_cineModePriorSpeed)
		FogMaskEnable(bj_cineModePriorMaskSetting)
		FogEnable(bj_cineModePriorFogSetting)
		EnableWorldFogBoundary(true)
		EnableDawnDusk(bj_cineModePriorDawnDusk)
		SetRandomSeed(bj_cineModeSavedSeed)
	end
end

---@param cineMode boolean
---@param forForce force
function CinematicModeBJ(cineMode, forForce)
	CinematicModeExBJ(cineMode, forForce, bj_CINEMODE_INTERFACEFADE)
end

---@param flag boolean
function DisplayCineFilterBJ(flag)
	DisplayCineFilter(flag)
end

---@param red number real
---@param green number real
---@param blue number real
---@param duration number real
---@param tex string
---@param startTrans number real
---@param endTrans number real
function CinematicFadeCommonBJ(red, green, blue, duration, tex, startTrans, endTrans)
	if (duration == 0) then
		startTrans = endTrans
	end
	EnableUserUI(false)
	SetCineFilterTexture(tex)
	SetCineFilterBlendMode(BLEND_MODE_BLEND)
	SetCineFilterTexMapFlags(TEXMAP_FLAG_NONE)
	SetCineFilterStartUV(0, 0, 1, 1)
	SetCineFilterEndUV(0, 0, 1, 1)
	SetCineFilterStartColor(PercentTo255(red), PercentTo255(green), PercentTo255(blue), PercentTo255(100 - startTrans))
	SetCineFilterEndColor(PercentTo255(red), PercentTo255(green), PercentTo255(blue), PercentTo255(100 - endTrans))
	SetCineFilterDuration(duration)
	DisplayCineFilter(true)
end

function FinishCinematicFadeBJ()
	DestroyTimer(bj_cineFadeFinishTimer)
	bj_cineFadeFinishTimer = nil
	DisplayCineFilter(false)
	EnableUserUI(true)
end

---@param duration number real
function FinishCinematicFadeAfterBJ(duration)
	bj_cineFadeFinishTimer = CreateTimer()
	TimerStart(bj_cineFadeFinishTimer, duration, false, FinishCinematicFadeBJ)
end

function ContinueCinematicFadeBJ()
	DestroyTimer(bj_cineFadeContinueTimer)
	bj_cineFadeContinueTimer = nil
	CinematicFadeCommonBJ(bj_cineFadeContinueRed, bj_cineFadeContinueGreen, bj_cineFadeContinueBlue, bj_cineFadeContinueDuration, bj_cineFadeContinueTex, bj_cineFadeContinueTrans, 100)
end

---@param duration number real
---@param red number real
---@param green number real
---@param blue number real
---@param trans number real
---@param tex string
function ContinueCinematicFadeAfterBJ(duration, red, green, blue, trans, tex)
	bj_cineFadeContinueRed = red
	bj_cineFadeContinueGreen = green
	bj_cineFadeContinueBlue = blue
	bj_cineFadeContinueTrans = trans
	bj_cineFadeContinueDuration = duration
	bj_cineFadeContinueTex = tex
	bj_cineFadeContinueTimer = CreateTimer()
	TimerStart(bj_cineFadeContinueTimer, duration, false, ContinueCinematicFadeBJ)
end

function AbortCinematicFadeBJ()
	if (bj_cineFadeContinueTimer ~= nil) then
		DestroyTimer(bj_cineFadeContinueTimer)
	end
	if (bj_cineFadeFinishTimer ~= nil) then
		DestroyTimer(bj_cineFadeFinishTimer)
	end
end

---@param fadetype number integer
---@param duration number real
---@param tex string
---@param red number real
---@param green number real
---@param blue number real
---@param trans number real
function CinematicFadeBJ(fadetype, duration, tex, red, green, blue, trans)
	if (fadetype == bj_CINEFADETYPE_FADEOUT) then
		AbortCinematicFadeBJ()
		CinematicFadeCommonBJ(red, green, blue, duration, tex, 100, trans)
	elseif (fadetype == bj_CINEFADETYPE_FADEOUT) then
		AbortCinematicFadeBJ()
		CinematicFadeCommonBJ(red, green, blue, duration, tex, trans, 100)
		FinishCinematicFadeAfterBJ(duration)
	elseif (fadetype == bj_CINEFADETYPE_FADEOUT) then
		if (duration > 0) then
			AbortCinematicFadeBJ()
			CinematicFadeCommonBJ(red, green, blue, duration * 0.5, tex, 100, trans)
			ContinueCinematicFadeAfterBJ(duration * 0.5, red, green, blue, trans, tex)
			FinishCinematicFadeAfterBJ(duration)
		end
	else
	end
end

---@param duration number real
---@param bmode blendmode
---@param tex string
---@param red0 number real
---@param green0 number real
---@param blue0 number real
---@param trans0 number real
---@param red1 number real
---@param green1 number real
---@param blue1 number real
---@param trans1 number real
function CinematicFilterGenericBJ(duration, bmode, tex, red0, green0, blue0, trans0, red1, green1, blue1, trans1)
	AbortCinematicFadeBJ()
	SetCineFilterTexture(tex)
	SetCineFilterBlendMode(bmode)
	SetCineFilterTexMapFlags(TEXMAP_FLAG_NONE)
	SetCineFilterStartUV(0, 0, 1, 1)
	SetCineFilterEndUV(0, 0, 1, 1)
	SetCineFilterStartColor(PercentTo255(red0), PercentTo255(green0), PercentTo255(blue0), PercentTo255(100 - trans0))
	SetCineFilterEndColor(PercentTo255(red1), PercentTo255(green1), PercentTo255(blue1), PercentTo255(100 - trans1))
	SetCineFilterDuration(duration)
	DisplayCineFilter(true)
end

---@param whichUnit unit
---@param rescuer player
---@param changeColor boolean
function RescueUnitBJ(whichUnit, rescuer, changeColor)
	if IsUnitDeadBJ(whichUnit) or (GetOwningPlayer(whichUnit) == rescuer) then
		return
	end
	StartSound(bj_rescueSound)
	SetUnitOwner(whichUnit, rescuer, changeColor)
	UnitAddIndicator(whichUnit, 0, 255, 0, 255)
	PingMinimapForPlayer(rescuer, GetUnitX(whichUnit), GetUnitY(whichUnit), bj_RESCUE_PING_TIME)
end

function TriggerActionUnitRescuedBJ()
	local theUnit = GetTriggerUnit() ---@type unit
	if IsUnitType(theUnit, UNIT_TYPE_STRUCTURE) then
		RescueUnitBJ(theUnit, GetOwningPlayer(GetRescuer()), bj_rescueChangeColorBldg)
	else
		RescueUnitBJ(theUnit, GetOwningPlayer(GetRescuer()), bj_rescueChangeColorUnit)
	end
end

function TryInitRescuableTriggersBJ()
	local index ---@type number integer
	if (bj_rescueUnitBehavior == nil) then
		bj_rescueUnitBehavior = CreateTrigger()
		index = 0
		while(true) do
			TriggerRegisterPlayerUnitEvent(bj_rescueUnitBehavior, Player(index), EVENT_PLAYER_UNIT_RESCUED, nil)
			index = index + 1
			if (index == bj_MAX_PLAYER_SLOTS) then break end
		end
		TriggerAddAction(bj_rescueUnitBehavior, TriggerActionUnitRescuedBJ)
	end
end

---@param changeColor boolean
function SetRescueUnitColorChangeBJ(changeColor)
	bj_rescueChangeColorUnit = changeColor
end

---@param changeColor boolean
function SetRescueBuildingColorChangeBJ(changeColor)
	bj_rescueChangeColorBldg = changeColor
end

function MakeUnitRescuableToForceBJEnum()
	TryInitRescuableTriggersBJ()
	SetUnitRescuable(bj_makeUnitRescuableUnit, GetEnumPlayer(), bj_makeUnitRescuableFlag)
end

---@param whichUnit unit
---@param isRescuable boolean
---@param whichForce force
function MakeUnitRescuableToForceBJ(whichUnit, isRescuable, whichForce)
	bj_makeUnitRescuableUnit = whichUnit
	bj_makeUnitRescuableFlag = isRescuable
	ForForce(whichForce, MakeUnitRescuableToForceBJEnum)
end

function InitRescuableBehaviorBJ()
	local index ---@type number integer
	index = 0
	while(true) do
		if (GetPlayerController(Player(index)) == MAP_CONTROL_RESCUABLE) then
			TryInitRescuableTriggersBJ()
			return
		end
		index = index + 1
		if (index == bj_MAX_PLAYERS) then break end
	end
end

---@param techid number integer
---@param levels number integer
---@param whichPlayer player
function SetPlayerTechResearchedSwap(techid, levels, whichPlayer)
	SetPlayerTechResearched(whichPlayer, techid, levels)
end

---@param techid number integer
---@param maximum number integer
---@param whichPlayer player
function SetPlayerTechMaxAllowedSwap(techid, maximum, whichPlayer)
	SetPlayerTechMaxAllowed(whichPlayer, techid, maximum)
end

---@param maximum number integer
---@param whichPlayer player
function SetPlayerMaxHeroesAllowed(maximum, whichPlayer)
	SetPlayerTechMaxAllowed(whichPlayer, FourCC('HERO'), maximum)
end

---@param techid number integer
---@param whichPlayer player
---@return number integer
function GetPlayerTechCountSimple(techid, whichPlayer)
	return GetPlayerTechCount(whichPlayer, techid, true)
end

---@param techid number integer
---@param whichPlayer player
---@return number integer
function GetPlayerTechMaxAllowedSwap(techid, whichPlayer)
	return GetPlayerTechMaxAllowed(whichPlayer, techid)
end

---@param avail boolean
---@param abilid number integer
---@param whichPlayer player
function SetPlayerAbilityAvailableBJ(avail, abilid, whichPlayer)
	SetPlayerAbilityAvailable(whichPlayer, abilid, avail)
end

---@param campaignNumber number integer
function SetCampaignMenuRaceBJ(campaignNumber)
	if (campaignNumber == bj_CAMPAIGN_INDEX_T) then
		SetCampaignMenuRace(RACE_OTHER)
	elseif (campaignNumber == bj_CAMPAIGN_INDEX_T) then
		SetCampaignMenuRace(RACE_HUMAN)
	elseif (campaignNumber == bj_CAMPAIGN_INDEX_T) then
		SetCampaignMenuRace(RACE_UNDEAD)
	elseif (campaignNumber == bj_CAMPAIGN_INDEX_T) then
		SetCampaignMenuRace(RACE_ORC)
	elseif (campaignNumber == bj_CAMPAIGN_INDEX_T) then
		SetCampaignMenuRace(RACE_NIGHTELF)
	elseif (campaignNumber == bj_CAMPAIGN_INDEX_T) then
		SetCampaignMenuRaceEx(bj_CAMPAIGN_OFFSET_XN)
	elseif (campaignNumber == bj_CAMPAIGN_INDEX_T) then
		SetCampaignMenuRaceEx(bj_CAMPAIGN_OFFSET_XH)
	elseif (campaignNumber == bj_CAMPAIGN_INDEX_T) then
		SetCampaignMenuRaceEx(bj_CAMPAIGN_OFFSET_XU)
	elseif (campaignNumber == bj_CAMPAIGN_INDEX_T) then
		SetCampaignMenuRaceEx(bj_CAMPAIGN_OFFSET_XO)
	else
	end
end

---@param available boolean
---@param missionIndex number integer
function SetMissionAvailableBJ(available, missionIndex)
	local campaignNumber = missionIndex / 1000 ---@type number integer
	local missionNumber = missionIndex - campaignNumber * 1000 ---@type number integer
	SetMissionAvailable(campaignNumber, missionNumber, available)
end

---@param available boolean
---@param campaignNumber number integer
function SetCampaignAvailableBJ(available, campaignNumber)
	local campaignOffset ---@type number integer
	if (campaignNumber == bj_CAMPAIGN_INDEX_H) then
		SetTutorialCleared(true)
	end
	if (campaignNumber == bj_CAMPAIGN_INDEX_XN) then
		campaignOffset = bj_CAMPAIGN_OFFSET_XN
	elseif (campaignNumber == bj_CAMPAIGN_INDEX_XN) then
		campaignOffset = bj_CAMPAIGN_OFFSET_XH
	elseif (campaignNumber == bj_CAMPAIGN_INDEX_XN) then
		campaignOffset = bj_CAMPAIGN_OFFSET_XU
	elseif (campaignNumber == bj_CAMPAIGN_INDEX_XN) then
		campaignOffset = bj_CAMPAIGN_OFFSET_XO
	else
		campaignOffset = campaignNumber
	end
	SetCampaignAvailable(campaignOffset, available)
	SetCampaignMenuRaceBJ(campaignNumber)
	ForceCampaignSelectScreen()
end

---@param available boolean
---@param cinematicIndex number integer
function SetCinematicAvailableBJ(available, cinematicIndex)
	if (cinematicIndex == bj_CINEMATICINDEX_TOP) then
		SetOpCinematicAvailable(bj_CAMPAIGN_INDEX_T, available)
		PlayCinematic("TutorialOp")
	elseif (cinematicIndex == bj_CINEMATICINDEX_TOP) then
		SetOpCinematicAvailable(bj_CAMPAIGN_INDEX_H, available)
		PlayCinematic("HumanOp")
	elseif (cinematicIndex == bj_CINEMATICINDEX_TOP) then
		SetEdCinematicAvailable(bj_CAMPAIGN_INDEX_H, available)
		PlayCinematic("HumanEd")
	elseif (cinematicIndex == bj_CINEMATICINDEX_TOP) then
		SetOpCinematicAvailable(bj_CAMPAIGN_INDEX_O, available)
		PlayCinematic("OrcOp")
	elseif (cinematicIndex == bj_CINEMATICINDEX_TOP) then
		SetEdCinematicAvailable(bj_CAMPAIGN_INDEX_O, available)
		PlayCinematic("OrcEd")
	elseif (cinematicIndex == bj_CINEMATICINDEX_TOP) then
		SetEdCinematicAvailable(bj_CAMPAIGN_INDEX_U, available)
		PlayCinematic("UndeadOp")
	elseif (cinematicIndex == bj_CINEMATICINDEX_TOP) then
		SetEdCinematicAvailable(bj_CAMPAIGN_INDEX_U, available)
		PlayCinematic("UndeadEd")
	elseif (cinematicIndex == bj_CINEMATICINDEX_TOP) then
		SetEdCinematicAvailable(bj_CAMPAIGN_INDEX_N, available)
		PlayCinematic("NightElfOp")
	elseif (cinematicIndex == bj_CINEMATICINDEX_TOP) then
		SetEdCinematicAvailable(bj_CAMPAIGN_INDEX_N, available)
		PlayCinematic("NightElfEd")
	elseif (cinematicIndex == bj_CINEMATICINDEX_TOP) then
		SetOpCinematicAvailable(bj_CAMPAIGN_OFFSET_XN, available)
		PlayCinematic("IntroX")
	elseif (cinematicIndex == bj_CINEMATICINDEX_TOP) then
		SetEdCinematicAvailable(bj_CAMPAIGN_OFFSET_XU, available)
		PlayCinematic("OutroX")
	else
	end
end

---@param campaignFile string
---@return gamecache
function InitGameCacheBJ(campaignFile)
	bj_lastCreatedGameCache = InitGameCache(campaignFile)
	return bj_lastCreatedGameCache
end

---@param cache gamecache
---@return boolean
function SaveGameCacheBJ(cache)
	return SaveGameCache(cache)
end

---@return gamecache
function GetLastCreatedGameCacheBJ()
	return bj_lastCreatedGameCache
end

---@return hashtable
function InitHashtableBJ()
	bj_lastCreatedHashtable = InitHashtable()
	return bj_lastCreatedHashtable
end

---@return hashtable
function GetLastCreatedHashtableBJ()
	return bj_lastCreatedHashtable
end

---@param value number real
---@param key string
---@param missionKey string
---@param cache gamecache
function StoreRealBJ(value, key, missionKey, cache)
	StoreReal(cache, missionKey, key, value)
end

---@param value number integer
---@param key string
---@param missionKey string
---@param cache gamecache
function StoreIntegerBJ(value, key, missionKey, cache)
	StoreInteger(cache, missionKey, key, value)
end

---@param value boolean
---@param key string
---@param missionKey string
---@param cache gamecache
function StoreBooleanBJ(value, key, missionKey, cache)
	StoreBoolean(cache, missionKey, key, value)
end

---@param value string
---@param key string
---@param missionKey string
---@param cache gamecache
---@return boolean
function StoreStringBJ(value, key, missionKey, cache)
	return StoreString(cache, missionKey, key, value)
end

---@param whichUnit unit
---@param key string
---@param missionKey string
---@param cache gamecache
---@return boolean
function StoreUnitBJ(whichUnit, key, missionKey, cache)
	return StoreUnit(cache, missionKey, key, whichUnit)
end

---@param value number real
---@param key number integer
---@param missionKey number integer
---@param table hashtable
function SaveRealBJ(value, key, missionKey, table)
	SaveReal(table, missionKey, key, value)
end

---@param value number integer
---@param key number integer
---@param missionKey number integer
---@param table hashtable
function SaveIntegerBJ(value, key, missionKey, table)
	SaveInteger(table, missionKey, key, value)
end

---@param value boolean
---@param key number integer
---@param missionKey number integer
---@param table hashtable
function SaveBooleanBJ(value, key, missionKey, table)
	SaveBoolean(table, missionKey, key, value)
end

---@param value string
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveStringBJ(value, key, missionKey, table)
	return SaveStr(table, missionKey, key, value)
end

---@param whichPlayer player
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SavePlayerHandleBJ(whichPlayer, key, missionKey, table)
	return SavePlayerHandle(table, missionKey, key, whichPlayer)
end

---@param whichWidget widget
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveWidgetHandleBJ(whichWidget, key, missionKey, table)
	return SaveWidgetHandle(table, missionKey, key, whichWidget)
end

---@param whichDestructable destructable
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveDestructableHandleBJ(whichDestructable, key, missionKey, table)
	return SaveDestructableHandle(table, missionKey, key, whichDestructable)
end

---@param whichItem item
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveItemHandleBJ(whichItem, key, missionKey, table)
	return SaveItemHandle(table, missionKey, key, whichItem)
end

---@param whichUnit unit
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveUnitHandleBJ(whichUnit, key, missionKey, table)
	return SaveUnitHandle(table, missionKey, key, whichUnit)
end

---@param whichAbility ability
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveAbilityHandleBJ(whichAbility, key, missionKey, table)
	return SaveAbilityHandle(table, missionKey, key, whichAbility)
end

---@param whichTimer timer
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveTimerHandleBJ(whichTimer, key, missionKey, table)
	return SaveTimerHandle(table, missionKey, key, whichTimer)
end

---@param whichTrigger trigger
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveTriggerHandleBJ(whichTrigger, key, missionKey, table)
	return SaveTriggerHandle(table, missionKey, key, whichTrigger)
end

---@param whichTriggercondition triggercondition
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveTriggerConditionHandleBJ(whichTriggercondition, key, missionKey, table)
	return SaveTriggerConditionHandle(table, missionKey, key, whichTriggercondition)
end

---@param whichTriggeraction triggeraction
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveTriggerActionHandleBJ(whichTriggeraction, key, missionKey, table)
	return SaveTriggerActionHandle(table, missionKey, key, whichTriggeraction)
end

---@param whichEvent event
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveTriggerEventHandleBJ(whichEvent, key, missionKey, table)
	return SaveTriggerEventHandle(table, missionKey, key, whichEvent)
end

---@param whichForce force
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveForceHandleBJ(whichForce, key, missionKey, table)
	return SaveForceHandle(table, missionKey, key, whichForce)
end

---@param whichGroup group
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveGroupHandleBJ(whichGroup, key, missionKey, table)
	return SaveGroupHandle(table, missionKey, key, whichGroup)
end

---@param whichLocation location
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveLocationHandleBJ(whichLocation, key, missionKey, table)
	return SaveLocationHandle(table, missionKey, key, whichLocation)
end

---@param whichRect rect
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveRectHandleBJ(whichRect, key, missionKey, table)
	return SaveRectHandle(table, missionKey, key, whichRect)
end

---@param whichBoolexpr boolexpr
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveBooleanExprHandleBJ(whichBoolexpr, key, missionKey, table)
	return SaveBooleanExprHandle(table, missionKey, key, whichBoolexpr)
end

---@param whichSound sound
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveSoundHandleBJ(whichSound, key, missionKey, table)
	return SaveSoundHandle(table, missionKey, key, whichSound)
end

---@param whichEffect effect
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveEffectHandleBJ(whichEffect, key, missionKey, table)
	return SaveEffectHandle(table, missionKey, key, whichEffect)
end

---@param whichUnitpool unitpool
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveUnitPoolHandleBJ(whichUnitpool, key, missionKey, table)
	return SaveUnitPoolHandle(table, missionKey, key, whichUnitpool)
end

---@param whichItempool itempool
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveItemPoolHandleBJ(whichItempool, key, missionKey, table)
	return SaveItemPoolHandle(table, missionKey, key, whichItempool)
end

---@param whichQuest quest
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveQuestHandleBJ(whichQuest, key, missionKey, table)
	return SaveQuestHandle(table, missionKey, key, whichQuest)
end

---@param whichQuestitem questitem
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveQuestItemHandleBJ(whichQuestitem, key, missionKey, table)
	return SaveQuestItemHandle(table, missionKey, key, whichQuestitem)
end

---@param whichDefeatcondition defeatcondition
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveDefeatConditionHandleBJ(whichDefeatcondition, key, missionKey, table)
	return SaveDefeatConditionHandle(table, missionKey, key, whichDefeatcondition)
end

---@param whichTimerdialog timerdialog
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveTimerDialogHandleBJ(whichTimerdialog, key, missionKey, table)
	return SaveTimerDialogHandle(table, missionKey, key, whichTimerdialog)
end

---@param whichLeaderboard leaderboard
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveLeaderboardHandleBJ(whichLeaderboard, key, missionKey, table)
	return SaveLeaderboardHandle(table, missionKey, key, whichLeaderboard)
end

---@param whichMultiboard multiboard
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveMultiboardHandleBJ(whichMultiboard, key, missionKey, table)
	return SaveMultiboardHandle(table, missionKey, key, whichMultiboard)
end

---@param whichMultiboarditem multiboarditem
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveMultiboardItemHandleBJ(whichMultiboarditem, key, missionKey, table)
	return SaveMultiboardItemHandle(table, missionKey, key, whichMultiboarditem)
end

---@param whichTrackable trackable
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveTrackableHandleBJ(whichTrackable, key, missionKey, table)
	return SaveTrackableHandle(table, missionKey, key, whichTrackable)
end

---@param whichDialog dialog
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveDialogHandleBJ(whichDialog, key, missionKey, table)
	return SaveDialogHandle(table, missionKey, key, whichDialog)
end

---@param whichButton button
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveButtonHandleBJ(whichButton, key, missionKey, table)
	return SaveButtonHandle(table, missionKey, key, whichButton)
end

---@param whichTexttag texttag
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveTextTagHandleBJ(whichTexttag, key, missionKey, table)
	return SaveTextTagHandle(table, missionKey, key, whichTexttag)
end

---@param whichLightning lightning
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveLightningHandleBJ(whichLightning, key, missionKey, table)
	return SaveLightningHandle(table, missionKey, key, whichLightning)
end

---@param whichImage image
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveImageHandleBJ(whichImage, key, missionKey, table)
	return SaveImageHandle(table, missionKey, key, whichImage)
end

---@param whichUbersplat ubersplat
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveUbersplatHandleBJ(whichUbersplat, key, missionKey, table)
	return SaveUbersplatHandle(table, missionKey, key, whichUbersplat)
end

---@param whichRegion region
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveRegionHandleBJ(whichRegion, key, missionKey, table)
	return SaveRegionHandle(table, missionKey, key, whichRegion)
end

---@param whichFogState fogstate
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveFogStateHandleBJ(whichFogState, key, missionKey, table)
	return SaveFogStateHandle(table, missionKey, key, whichFogState)
end

---@param whichFogModifier fogmodifier
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveFogModifierHandleBJ(whichFogModifier, key, missionKey, table)
	return SaveFogModifierHandle(table, missionKey, key, whichFogModifier)
end

---@param whichAgent agent
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveAgentHandleBJ(whichAgent, key, missionKey, table)
	return SaveAgentHandle(table, missionKey, key, whichAgent)
end

---@param whichHashtable hashtable
---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function SaveHashtableHandleBJ(whichHashtable, key, missionKey, table)
	return SaveHashtableHandle(table, missionKey, key, whichHashtable)
end

---@param key string
---@param missionKey string
---@param cache gamecache
---@return number real
function GetStoredRealBJ(key, missionKey, cache)
	return GetStoredReal(cache, missionKey, key)
end

---@param key string
---@param missionKey string
---@param cache gamecache
---@return number integer
function GetStoredIntegerBJ(key, missionKey, cache)
	return GetStoredInteger(cache, missionKey, key)
end

---@param key string
---@param missionKey string
---@param cache gamecache
---@return boolean
function GetStoredBooleanBJ(key, missionKey, cache)
	return GetStoredBoolean(cache, missionKey, key)
end

---@param key string
---@param missionKey string
---@param cache gamecache
---@return string
function GetStoredStringBJ(key, missionKey, cache)
	local s ---@type string
	s = GetStoredString(cache, missionKey, key)
	if (s == nil) then
		return ""
	else
		return s
	end
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return number real
function LoadRealBJ(key, missionKey, table)
	return LoadReal(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return number integer
function LoadIntegerBJ(key, missionKey, table)
	return LoadInteger(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function LoadBooleanBJ(key, missionKey, table)
	return LoadBoolean(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return string
function LoadStringBJ(key, missionKey, table)
	local s ---@type string
	s = LoadStr(table, missionKey, key)
	if (s == nil) then
		return ""
	else
		return s
	end
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return player
function LoadPlayerHandleBJ(key, missionKey, table)
	return LoadPlayerHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return widget
function LoadWidgetHandleBJ(key, missionKey, table)
	return LoadWidgetHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return destructable
function LoadDestructableHandleBJ(key, missionKey, table)
	return LoadDestructableHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return item
function LoadItemHandleBJ(key, missionKey, table)
	return LoadItemHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return unit
function LoadUnitHandleBJ(key, missionKey, table)
	return LoadUnitHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return ability
function LoadAbilityHandleBJ(key, missionKey, table)
	return LoadAbilityHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return timer
function LoadTimerHandleBJ(key, missionKey, table)
	return LoadTimerHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return trigger
function LoadTriggerHandleBJ(key, missionKey, table)
	return LoadTriggerHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return triggercondition
function LoadTriggerConditionHandleBJ(key, missionKey, table)
	return LoadTriggerConditionHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return triggeraction
function LoadTriggerActionHandleBJ(key, missionKey, table)
	return LoadTriggerActionHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return event
function LoadTriggerEventHandleBJ(key, missionKey, table)
	return LoadTriggerEventHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return force
function LoadForceHandleBJ(key, missionKey, table)
	return LoadForceHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return group
function LoadGroupHandleBJ(key, missionKey, table)
	return LoadGroupHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return location
function LoadLocationHandleBJ(key, missionKey, table)
	return LoadLocationHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return rect
function LoadRectHandleBJ(key, missionKey, table)
	return LoadRectHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return boolexpr
function LoadBooleanExprHandleBJ(key, missionKey, table)
	return LoadBooleanExprHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return sound
function LoadSoundHandleBJ(key, missionKey, table)
	return LoadSoundHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return effect
function LoadEffectHandleBJ(key, missionKey, table)
	return LoadEffectHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return unitpool
function LoadUnitPoolHandleBJ(key, missionKey, table)
	return LoadUnitPoolHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return itempool
function LoadItemPoolHandleBJ(key, missionKey, table)
	return LoadItemPoolHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return quest
function LoadQuestHandleBJ(key, missionKey, table)
	return LoadQuestHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return questitem
function LoadQuestItemHandleBJ(key, missionKey, table)
	return LoadQuestItemHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return defeatcondition
function LoadDefeatConditionHandleBJ(key, missionKey, table)
	return LoadDefeatConditionHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return timerdialog
function LoadTimerDialogHandleBJ(key, missionKey, table)
	return LoadTimerDialogHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return leaderboard
function LoadLeaderboardHandleBJ(key, missionKey, table)
	return LoadLeaderboardHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return multiboard
function LoadMultiboardHandleBJ(key, missionKey, table)
	return LoadMultiboardHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return multiboarditem
function LoadMultiboardItemHandleBJ(key, missionKey, table)
	return LoadMultiboardItemHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return trackable
function LoadTrackableHandleBJ(key, missionKey, table)
	return LoadTrackableHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return dialog
function LoadDialogHandleBJ(key, missionKey, table)
	return LoadDialogHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return button
function LoadButtonHandleBJ(key, missionKey, table)
	return LoadButtonHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return texttag
function LoadTextTagHandleBJ(key, missionKey, table)
	return LoadTextTagHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return lightning
function LoadLightningHandleBJ(key, missionKey, table)
	return LoadLightningHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return image
function LoadImageHandleBJ(key, missionKey, table)
	return LoadImageHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return ubersplat
function LoadUbersplatHandleBJ(key, missionKey, table)
	return LoadUbersplatHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return region
function LoadRegionHandleBJ(key, missionKey, table)
	return LoadRegionHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return fogstate
function LoadFogStateHandleBJ(key, missionKey, table)
	return LoadFogStateHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return fogmodifier
function LoadFogModifierHandleBJ(key, missionKey, table)
	return LoadFogModifierHandle(table, missionKey, key)
end

---@param key number integer
---@param missionKey number integer
---@param table hashtable
---@return hashtable
function LoadHashtableHandleBJ(key, missionKey, table)
	return LoadHashtableHandle(table, missionKey, key)
end

---@param key string
---@param missionKey string
---@param cache gamecache
---@param forWhichPlayer player
---@param loc location
---@param facing number real
---@return unit
function RestoreUnitLocFacingAngleBJ(key, missionKey, cache, forWhichPlayer, loc, facing)
	bj_lastLoadedUnit = RestoreUnit(cache, missionKey, key, forWhichPlayer, GetLocationX(loc), GetLocationY(loc), facing)
	return bj_lastLoadedUnit
end

---@param key string
---@param missionKey string
---@param cache gamecache
---@param forWhichPlayer player
---@param loc location
---@param lookAt location
---@return unit
function RestoreUnitLocFacingPointBJ(key, missionKey, cache, forWhichPlayer, loc, lookAt)
	return RestoreUnitLocFacingAngleBJ(key, missionKey, cache, forWhichPlayer, loc, AngleBetweenPoints(loc, lookAt))
end

---@return unit
function GetLastRestoredUnitBJ()
	return bj_lastLoadedUnit
end

---@param cache gamecache
function FlushGameCacheBJ(cache)
	FlushGameCache(cache)
end

---@param missionKey string
---@param cache gamecache
function FlushStoredMissionBJ(missionKey, cache)
	FlushStoredMission(cache, missionKey)
end

---@param table hashtable
function FlushParentHashtableBJ(table)
	FlushParentHashtable(table)
end

---@param missionKey number integer
---@param table hashtable
function FlushChildHashtableBJ(missionKey, table)
	FlushChildHashtable(table, missionKey)
end

---@param key string
---@param valueType number integer
---@param missionKey string
---@param cache gamecache
---@return boolean
function HaveStoredValue(key, valueType, missionKey, cache)
	if (valueType == bj_GAMECACHE_BOOLEAN) then
		return HaveStoredBoolean(cache, missionKey, key)
	elseif (valueType == bj_GAMECACHE_BOOLEAN) then
		return HaveStoredInteger(cache, missionKey, key)
	elseif (valueType == bj_GAMECACHE_BOOLEAN) then
		return HaveStoredReal(cache, missionKey, key)
	elseif (valueType == bj_GAMECACHE_BOOLEAN) then
		return HaveStoredUnit(cache, missionKey, key)
	elseif (valueType == bj_GAMECACHE_BOOLEAN) then
		return HaveStoredString(cache, missionKey, key)
	else
		return false
	end
end

---@param key number integer
---@param valueType number integer
---@param missionKey number integer
---@param table hashtable
---@return boolean
function HaveSavedValue(key, valueType, missionKey, table)
	if (valueType == bj_HASHTABLE_BOOLEAN) then
		return HaveSavedBoolean(table, missionKey, key)
	elseif (valueType == bj_HASHTABLE_BOOLEAN) then
		return HaveSavedInteger(table, missionKey, key)
	elseif (valueType == bj_HASHTABLE_BOOLEAN) then
		return HaveSavedReal(table, missionKey, key)
	elseif (valueType == bj_HASHTABLE_BOOLEAN) then
		return HaveSavedString(table, missionKey, key)
	elseif (valueType == bj_HASHTABLE_BOOLEAN) then
		return HaveSavedHandle(table, missionKey, key)
	else
		return false
	end
end

---@param show boolean
---@param whichButton number integer
function ShowCustomCampaignButton(show, whichButton)
	SetCustomCampaignButtonVisible(whichButton - 1, show)
end

---@param whichButton number integer
---@return boolean
function IsCustomCampaignButtonVisibile(whichButton)
	return GetCustomCampaignButtonVisible(whichButton - 1)
end

---@param loadFileName string
---@param doScoreScreen boolean
function LoadGameBJ(loadFileName, doScoreScreen)
	LoadGame(loadFileName, doScoreScreen)
end

---@param saveFileName string
---@param newLevel string
---@param doScoreScreen boolean
function SaveAndChangeLevelBJ(saveFileName, newLevel, doScoreScreen)
	SaveGame(saveFileName)
	ChangeLevel(newLevel, doScoreScreen)
end

---@param saveFileName string
---@param loadFileName string
---@param doScoreScreen boolean
function SaveAndLoadGameBJ(saveFileName, loadFileName, doScoreScreen)
	SaveGame(saveFileName)
	LoadGame(loadFileName, doScoreScreen)
end

---@param sourceDirName string
---@param destDirName string
---@return boolean
function RenameSaveDirectoryBJ(sourceDirName, destDirName)
	return RenameSaveDirectory(sourceDirName, destDirName)
end

---@param sourceDirName string
---@return boolean
function RemoveSaveDirectoryBJ(sourceDirName)
	return RemoveSaveDirectory(sourceDirName)
end

---@param sourceSaveName string
---@param destSaveName string
---@return boolean
function CopySaveGameBJ(sourceSaveName, destSaveName)
	return CopySaveGame(sourceSaveName, destSaveName)
end

---@param whichPlayer player
---@return number real
function GetPlayerStartLocationX(whichPlayer)
	return GetStartLocationX(GetPlayerStartLocation(whichPlayer))
end

---@param whichPlayer player
---@return number real
function GetPlayerStartLocationY(whichPlayer)
	return GetStartLocationY(GetPlayerStartLocation(whichPlayer))
end

---@param whichPlayer player
---@return location
function GetPlayerStartLocationLoc(whichPlayer)
	return GetStartLocationLoc(GetPlayerStartLocation(whichPlayer))
end

---@param whichRect rect
---@return location
function GetRectCenter(whichRect)
	return Location(GetRectCenterX(whichRect), GetRectCenterY(whichRect))
end

---@param whichPlayer player
---@param whichState playerslotstate
---@return boolean
function IsPlayerSlotState(whichPlayer, whichState)
	return GetPlayerSlotState(whichPlayer) == whichState
end

---@param seconds number real
---@return number integer
function GetFadeFromSeconds(seconds)
	if (seconds ~= 0) then
		return 128 / R2I(seconds)
	end
	return 10000
end

---@param seconds number real
---@return number real
function GetFadeFromSecondsAsReal(seconds)
	if (seconds ~= 0) then
		return 128.00 / seconds
	end
	return 10000.00
end

---@param whichPlayer player
---@param whichPlayerState playerstate
---@param delta number integer
function AdjustPlayerStateSimpleBJ(whichPlayer, whichPlayerState, delta)
	SetPlayerState(whichPlayer, whichPlayerState, GetPlayerState(whichPlayer, whichPlayerState) + delta)
end

---@param delta number integer
---@param whichPlayer player
---@param whichPlayerState playerstate
function AdjustPlayerStateBJ(delta, whichPlayer, whichPlayerState)
	if (delta > 0) then
		if (whichPlayerState == PLAYER_STATE_RESOURCE_GOLD) then
			AdjustPlayerStateSimpleBJ(whichPlayer, PLAYER_STATE_GOLD_GATHERED, delta)
		elseif (whichPlayerState == PLAYER_STATE_RESOURCE_GOLD) then
			AdjustPlayerStateSimpleBJ(whichPlayer, PLAYER_STATE_LUMBER_GATHERED, delta)
		end
	end
	AdjustPlayerStateSimpleBJ(whichPlayer, whichPlayerState, delta)
end

---@param whichPlayer player
---@param whichPlayerState playerstate
---@param value number integer
function SetPlayerStateBJ(whichPlayer, whichPlayerState, value)
	local oldValue = GetPlayerState(whichPlayer, whichPlayerState) ---@type number integer
	AdjustPlayerStateBJ(value - oldValue, whichPlayer, whichPlayerState)
end

---@param whichPlayerFlag playerstate
---@param flag boolean
---@param whichPlayer player
function SetPlayerFlagBJ(whichPlayerFlag, flag, whichPlayer)
	SetPlayerState(whichPlayer, whichPlayerFlag, IntegerTertiaryOp(flag, 1, 0))
end

---@param rate number integer
---@param whichResource playerstate
---@param sourcePlayer player
---@param otherPlayer player
function SetPlayerTaxRateBJ(rate, whichResource, sourcePlayer, otherPlayer)
	SetPlayerTaxRate(sourcePlayer, otherPlayer, whichResource, rate)
end

---@param whichResource playerstate
---@param sourcePlayer player
---@param otherPlayer player
---@return number integer
function GetPlayerTaxRateBJ(whichResource, sourcePlayer, otherPlayer)
	return GetPlayerTaxRate(sourcePlayer, otherPlayer, whichResource)
end

---@param whichPlayerFlag playerstate
---@param whichPlayer player
---@return boolean
function IsPlayerFlagSetBJ(whichPlayerFlag, whichPlayer)
	return GetPlayerState(whichPlayer, whichPlayerFlag) == 1
end

---@param delta number integer
---@param whichUnit unit
function AddResourceAmountBJ(delta, whichUnit)
	AddResourceAmount(whichUnit, delta)
end

---@param whichPlayer player
---@return number integer
function GetConvertedPlayerId(whichPlayer)
	return GetPlayerId(whichPlayer) + 1
end

---@param convertedPlayerId number integer
---@return player
function ConvertedPlayer(convertedPlayerId)
	return Player(convertedPlayerId - 1)
end

---@param r rect
---@return number real
function GetRectWidthBJ(r)
	return GetRectMaxX(r) - GetRectMinX(r)
end

---@param r rect
---@return number real
function GetRectHeightBJ(r)
	return GetRectMaxY(r) - GetRectMinY(r)
end

---@param goldMine unit
---@param whichPlayer player
---@return unit
function BlightGoldMineForPlayerBJ(goldMine, whichPlayer)
	local mineX ---@type number real
	local mineY ---@type number real
	local mineGold ---@type number integer
	local newMine ---@type unit
	if GetUnitTypeId(goldMine) ~= FourCC('ngol') then
		return nil
	end
	mineX = GetUnitX(goldMine)
	mineY = GetUnitY(goldMine)
	mineGold = GetResourceAmount(goldMine)
	RemoveUnit(goldMine)
	newMine = CreateBlightedGoldmine(whichPlayer, mineX, mineY, bj_UNIT_FACING)
	SetResourceAmount(newMine, mineGold)
	return newMine
end

---@param goldMine unit
---@param whichPlayer player
---@return unit
function BlightGoldMineForPlayer(goldMine, whichPlayer)
	bj_lastHauntedGoldMine = BlightGoldMineForPlayerBJ(goldMine, whichPlayer)
	return bj_lastHauntedGoldMine
end

---@return unit
function GetLastHauntedGoldMine()
	return bj_lastHauntedGoldMine
end

---@param where location
---@return boolean
function IsPointBlightedBJ(where)
	return IsPointBlighted(GetLocationX(where), GetLocationY(where))
end

function SetPlayerColorBJEnum()
	SetUnitColor(GetEnumUnit(), bj_setPlayerTargetColor)
end

---@param whichPlayer player
---@param color playercolor
---@param changeExisting boolean
function SetPlayerColorBJ(whichPlayer, color, changeExisting)
	local g ---@type group
	SetPlayerColor(whichPlayer, color)
	if changeExisting then
		bj_setPlayerTargetColor = color
		g = CreateGroup()
		GroupEnumUnitsOfPlayer(g, whichPlayer, nil)
		ForGroup(g, SetPlayerColorBJEnum)
		DestroyGroup(g)
	end
end

---@param unitId number integer
---@param allowed boolean
---@param whichPlayer player
function SetPlayerUnitAvailableBJ(unitId, allowed, whichPlayer)
	if allowed then
		SetPlayerTechMaxAllowed(whichPlayer, unitId, -1)
	else
		SetPlayerTechMaxAllowed(whichPlayer, unitId, 0)
	end
end

function LockGameSpeedBJ()
	SetMapFlag(MAP_LOCK_SPEED, true)
end

function UnlockGameSpeedBJ()
	SetMapFlag(MAP_LOCK_SPEED, false)
end

---@param whichUnit unit
---@param order string
---@param targetWidget widget
---@return boolean
function IssueTargetOrderBJ(whichUnit, order, targetWidget)
	return IssueTargetOrder(whichUnit, order, targetWidget)
end

---@param whichUnit unit
---@param order string
---@param whichLocation location
---@return boolean
function IssuePointOrderLocBJ(whichUnit, order, whichLocation)
	return IssuePointOrderLoc(whichUnit, order, whichLocation)
end

---@param whichUnit unit
---@param order string
---@param targetWidget widget
---@return boolean
function IssueTargetDestructableOrder(whichUnit, order, targetWidget)
	return IssueTargetOrder(whichUnit, order, targetWidget)
end

---@param whichUnit unit
---@param order string
---@param targetWidget widget
---@return boolean
function IssueTargetItemOrder(whichUnit, order, targetWidget)
	return IssueTargetOrder(whichUnit, order, targetWidget)
end

---@param whichUnit unit
---@param order string
---@return boolean
function IssueImmediateOrderBJ(whichUnit, order)
	return IssueImmediateOrder(whichUnit, order)
end

---@param whichGroup group
---@param order string
---@param targetWidget widget
---@return boolean
function GroupTargetOrderBJ(whichGroup, order, targetWidget)
	return GroupTargetOrder(whichGroup, order, targetWidget)
end

---@param whichGroup group
---@param order string
---@param whichLocation location
---@return boolean
function GroupPointOrderLocBJ(whichGroup, order, whichLocation)
	return GroupPointOrderLoc(whichGroup, order, whichLocation)
end

---@param whichGroup group
---@param order string
---@return boolean
function GroupImmediateOrderBJ(whichGroup, order)
	return GroupImmediateOrder(whichGroup, order)
end

---@param whichGroup group
---@param order string
---@param targetWidget widget
---@return boolean
function GroupTargetDestructableOrder(whichGroup, order, targetWidget)
	return GroupTargetOrder(whichGroup, order, targetWidget)
end

---@param whichGroup group
---@param order string
---@param targetWidget widget
---@return boolean
function GroupTargetItemOrder(whichGroup, order, targetWidget)
	return GroupTargetOrder(whichGroup, order, targetWidget)
end

---@return destructable
function GetDyingDestructable()
	return GetTriggerDestructable()
end

---@param whichUnit unit
---@param targPos location
function SetUnitRallyPoint(whichUnit, targPos)
	IssuePointOrderLocBJ(whichUnit, "setrally", targPos)
end

---@param whichUnit unit
---@param targUnit unit
function SetUnitRallyUnit(whichUnit, targUnit)
	IssueTargetOrder(whichUnit, "setrally", targUnit)
end

---@param whichUnit unit
---@param targDest destructable
function SetUnitRallyDestructable(whichUnit, targDest)
	IssueTargetOrder(whichUnit, "setrally", targDest)
end

function SaveDyingWidget()
	bj_lastDyingWidget = GetTriggerWidget()
end

---@param addBlight boolean
---@param whichPlayer player
---@param r rect
function SetBlightRectBJ(addBlight, whichPlayer, r)
	SetBlightRect(whichPlayer, r, addBlight)
end

---@param addBlight boolean
---@param whichPlayer player
---@param loc location
---@param radius number real
function SetBlightRadiusLocBJ(addBlight, whichPlayer, loc, radius)
	SetBlightLoc(whichPlayer, loc, radius, addBlight)
end

---@param abilcode number integer
---@return string
function GetAbilityName(abilcode)
	return GetObjectName(abilcode)
end

function MeleeStartingVisibility()
	SetFloatGameState(GAME_STATE_TIME_OF_DAY, bj_MELEE_STARTING_TOD)
end

function MeleeStartingResources()
	local index ---@type number integer
	local indexPlayer ---@type player
	local v ---@type version
	local startingGold ---@type number integer
	local startingLumber ---@type number integer
	v = VersionGet()
	if (v == VERSION_REIGN_OF_CHAOS) then
		startingGold = bj_MELEE_STARTING_GOLD_V0
		startingLumber = bj_MELEE_STARTING_LUMBER_V0
	else
		startingGold = bj_MELEE_STARTING_GOLD_V1
		startingLumber = bj_MELEE_STARTING_LUMBER_V1
	end
	index = 0
	while(true) do
		indexPlayer = Player(index)
		if (GetPlayerSlotState(indexPlayer) == PLAYER_SLOT_STATE_PLAYING) then
			SetPlayerState(indexPlayer, PLAYER_STATE_RESOURCE_GOLD, startingGold)
			SetPlayerState(indexPlayer, PLAYER_STATE_RESOURCE_LUMBER, startingLumber)
		end
		index = index + 1
		if (index == bj_MAX_PLAYERS) then break end
	end
end

---@param whichPlayer player
---@param techId number integer
---@param limit number integer
function ReducePlayerTechMaxAllowed(whichPlayer, techId, limit)
	local oldMax = GetPlayerTechMaxAllowed(whichPlayer, techId) ---@type number integer
	if (oldMax < 0 or oldMax > limit) then
		SetPlayerTechMaxAllowed(whichPlayer, techId, limit)
	end
end

function MeleeStartingHeroLimit()
	local index ---@type number integer
	index = 0
	while(true) do
		SetPlayerMaxHeroesAllowed(bj_MELEE_HERO_LIMIT, Player(index))
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Hamg'), bj_MELEE_HERO_TYPE_LIMIT)
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Hmkg'), bj_MELEE_HERO_TYPE_LIMIT)
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Hpal'), bj_MELEE_HERO_TYPE_LIMIT)
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Hblm'), bj_MELEE_HERO_TYPE_LIMIT)
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Obla'), bj_MELEE_HERO_TYPE_LIMIT)
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Ofar'), bj_MELEE_HERO_TYPE_LIMIT)
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Otch'), bj_MELEE_HERO_TYPE_LIMIT)
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Oshd'), bj_MELEE_HERO_TYPE_LIMIT)
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Edem'), bj_MELEE_HERO_TYPE_LIMIT)
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Ekee'), bj_MELEE_HERO_TYPE_LIMIT)
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Emoo'), bj_MELEE_HERO_TYPE_LIMIT)
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Ewar'), bj_MELEE_HERO_TYPE_LIMIT)
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Udea'), bj_MELEE_HERO_TYPE_LIMIT)
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Udre'), bj_MELEE_HERO_TYPE_LIMIT)
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Ulic'), bj_MELEE_HERO_TYPE_LIMIT)
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Ucrl'), bj_MELEE_HERO_TYPE_LIMIT)
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Npbm'), bj_MELEE_HERO_TYPE_LIMIT)
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Nbrn'), bj_MELEE_HERO_TYPE_LIMIT)
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Nngs'), bj_MELEE_HERO_TYPE_LIMIT)
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Nplh'), bj_MELEE_HERO_TYPE_LIMIT)
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Nbst'), bj_MELEE_HERO_TYPE_LIMIT)
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Nalc'), bj_MELEE_HERO_TYPE_LIMIT)
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Ntin'), bj_MELEE_HERO_TYPE_LIMIT)
		ReducePlayerTechMaxAllowed(Player(index), FourCC('Nfir'), bj_MELEE_HERO_TYPE_LIMIT)
		index = index + 1
		if (index == bj_MAX_PLAYERS) then break end
	end
end

---@return boolean
function MeleeTrainedUnitIsHeroBJFilter()
	return IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO)
end

---@param whichUnit unit
function MeleeGrantItemsToHero(whichUnit)
	local owner = GetPlayerId(GetOwningPlayer(whichUnit)) ---@type number integer
	if (bj_meleeTwinkedHeroes[owner] < bj_MELEE_MAX_TWINKED_HEROES) then
		UnitAddItemById(whichUnit, FourCC('stwp'))
		bj_meleeTwinkedHeroes[owner] = bj_meleeTwinkedHeroes[owner] + 1
	end
end

function MeleeGrantItemsToTrainedHero()
	MeleeGrantItemsToHero(GetTrainedUnit())
end

function MeleeGrantItemsToHiredHero()
	MeleeGrantItemsToHero(GetSoldUnit())
end

function MeleeGrantHeroItems()
	local index ---@type number integer
	local trig ---@type trigger
	index = 0
	while(true) do
		bj_meleeTwinkedHeroes[index] = 0
		index = index + 1
		if (index == bj_MAX_PLAYER_SLOTS) then break end
	end
	index = 0
	while(true) do
		trig = CreateTrigger()
		TriggerRegisterPlayerUnitEvent(trig, Player(index), EVENT_PLAYER_UNIT_TRAIN_FINISH, filterMeleeTrainedUnitIsHeroBJ)
		TriggerAddAction(trig, MeleeGrantItemsToTrainedHero)
		index = index + 1
		if (index == bj_MAX_PLAYERS) then break end
	end
	trig = CreateTrigger()
	TriggerRegisterPlayerUnitEvent(trig, Player(PLAYER_NEUTRAL_PASSIVE), EVENT_PLAYER_UNIT_SELL, filterMeleeTrainedUnitIsHeroBJ)
	TriggerAddAction(trig, MeleeGrantItemsToHiredHero)
	bj_meleeGrantHeroItems = true
end

function MeleeClearExcessUnit()
	local theUnit = GetEnumUnit() ---@type unit
	local owner = GetPlayerId(GetOwningPlayer(theUnit)) ---@type number integer
	if (owner == PLAYER_NEUTRAL_AGGRESSIVE) then
		RemoveUnit(GetEnumUnit())
	elseif (owner == PLAYER_NEUTRAL_AGGRESSIVE) then
		if not IsUnitType(theUnit, UNIT_TYPE_STRUCTURE) then
			RemoveUnit(GetEnumUnit())
		end
	end
end

---@param x number real
---@param y number real
---@param range number real
function MeleeClearNearbyUnits(x, y, range)
	local nearbyUnits ---@type group
	nearbyUnits = CreateGroup()
	GroupEnumUnitsInRange(nearbyUnits, x, y, range, nil)
	ForGroup(nearbyUnits, MeleeClearExcessUnit)
	DestroyGroup(nearbyUnits)
end

function MeleeClearExcessUnits()
	local index ---@type number integer
	local locX ---@type number real
	local locY ---@type number real
	local indexPlayer ---@type player
	index = 0
	while(true) do
		indexPlayer = Player(index)
		if (GetPlayerSlotState(indexPlayer) == PLAYER_SLOT_STATE_PLAYING) then
			locX = GetStartLocationX(GetPlayerStartLocation(indexPlayer))
			locY = GetStartLocationY(GetPlayerStartLocation(indexPlayer))
			MeleeClearNearbyUnits(locX, locY, bj_MELEE_CLEAR_UNITS_RADIUS)
		end
		index = index + 1
		if (index == bj_MAX_PLAYERS) then break end
	end
end

function MeleeEnumFindNearestMine()
	local enumUnit = GetEnumUnit() ---@type unit
	local dist ---@type number real
	local unitLoc ---@type location
	if (GetUnitTypeId(enumUnit) == FourCC('ngol')) then
		unitLoc = GetUnitLoc(enumUnit)
		dist = DistanceBetweenPoints(unitLoc, bj_meleeNearestMineToLoc)
		RemoveLocation(unitLoc)
		if (bj_meleeNearestMineDist < 0) or (dist < bj_meleeNearestMineDist) then
			bj_meleeNearestMine = enumUnit
			bj_meleeNearestMineDist = dist
		end
	end
end

---@param src location
---@param range number real
---@return unit
function MeleeFindNearestMine(src, range)
	local nearbyMines ---@type group
	bj_meleeNearestMine = nil
	bj_meleeNearestMineDist = -1
	bj_meleeNearestMineToLoc = src
	nearbyMines = CreateGroup()
	GroupEnumUnitsInRangeOfLoc(nearbyMines, src, range, nil)
	ForGroup(nearbyMines, MeleeEnumFindNearestMine)
	DestroyGroup(nearbyMines)
	return bj_meleeNearestMine
end

---@param p player
---@param id1 number integer
---@param id2 number integer
---@param id3 number integer
---@param id4 number integer
---@param loc location
---@return unit
function MeleeRandomHeroLoc(p, id1, id2, id3, id4, loc)
	local hero = nil ---@type unit
	local roll ---@type number integer
	local pick ---@type number integer
	local v ---@type version
	v = VersionGet()
	if (v == VERSION_REIGN_OF_CHAOS) then
		roll = GetRandomInt(1, 3)
	else
		roll = GetRandomInt(1, 4)
	end
	if roll == 1 then
		pick = id1
	elseif roll == 1 then
		pick = id2
	elseif roll == 1 then
		pick = id3
	elseif roll == 1 then
		pick = id4
	else
		pick = id1
	end
	hero = CreateUnitAtLoc(p, pick, loc, bj_UNIT_FACING)
	if bj_meleeGrantHeroItems then
		MeleeGrantItemsToHero(hero)
	end
	return hero
end

---@param src location
---@param targ location
---@param distance number real
---@param deltaAngle number real
---@return location
function MeleeGetProjectedLoc(src, targ, distance, deltaAngle)
	local srcX = GetLocationX(src) ---@type number real
	local srcY = GetLocationY(src) ---@type number real
	local direction = Atan2(GetLocationY(targ) - srcY, GetLocationX(targ) - srcX) + deltaAngle ---@type number real
	return Location(srcX + distance * Cos(direction), srcY + distance * Sin(direction))
end

---@param val number real
---@param minVal number real
---@param maxVal number real
---@return number real
function MeleeGetNearestValueWithin(val, minVal, maxVal)
	if (val < minVal) then
		return minVal
	elseif (val < minVal) then
		return maxVal
	else
		return val
	end
end

---@param src location
---@param r rect
---@return location
function MeleeGetLocWithinRect(src, r)
	local withinX = MeleeGetNearestValueWithin(GetLocationX(src), GetRectMinX(r), GetRectMaxX(r)) ---@type number real
	local withinY = MeleeGetNearestValueWithin(GetLocationY(src), GetRectMinY(r), GetRectMaxY(r)) ---@type number real
	return Location(withinX, withinY)
end

---@param whichPlayer player
---@param startLoc location
---@param doHeroes boolean
---@param doCamera boolean
---@param doPreload boolean
function MeleeStartingUnitsHuman(whichPlayer, startLoc, doHeroes, doCamera, doPreload)
	local useRandomHero = IsMapFlagSet(MAP_RANDOM_HERO) ---@type boolean
	local unitSpacing = 64.00 ---@type number real
	local nearestMine ---@type unit
	local nearMineLoc ---@type location
	local heroLoc ---@type location
	local peonX ---@type number real
	local peonY ---@type number real
	local townHall = nil ---@type unit
	if (doPreload) then
		Preloader("scripts\\HumanMelee.pld")
	end
	nearestMine = MeleeFindNearestMine(startLoc, bj_MELEE_MINE_SEARCH_RADIUS)
	if (nearestMine ~= nil) then
		townHall = CreateUnitAtLoc(whichPlayer, FourCC('htow'), startLoc, bj_UNIT_FACING)
		nearMineLoc = MeleeGetProjectedLoc(GetUnitLoc(nearestMine), startLoc, 320, 0)
		peonX = GetLocationX(nearMineLoc)
		peonY = GetLocationY(nearMineLoc)
		CreateUnit(whichPlayer, FourCC('hpea'), peonX + 0.00 * unitSpacing, peonY + 1.00 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('hpea'), peonX + 1.00 * unitSpacing, peonY + 0.15 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('hpea'), peonX - 1.00 * unitSpacing, peonY + 0.15 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('hpea'), peonX + 0.60 * unitSpacing, peonY - 1.00 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('hpea'), peonX - 0.60 * unitSpacing, peonY - 1.00 * unitSpacing, bj_UNIT_FACING)
		heroLoc = MeleeGetProjectedLoc(GetUnitLoc(nearestMine), startLoc, 384, 45)
	else
		townHall = CreateUnitAtLoc(whichPlayer, FourCC('htow'), startLoc, bj_UNIT_FACING)
		peonX = GetLocationX(startLoc)
		peonY = GetLocationY(startLoc) - 224.00
		CreateUnit(whichPlayer, FourCC('hpea'), peonX + 2.00 * unitSpacing, peonY + 0.00 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('hpea'), peonX + 1.00 * unitSpacing, peonY + 0.00 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('hpea'), peonX + 0.00 * unitSpacing, peonY + 0.00 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('hpea'), peonX - 1.00 * unitSpacing, peonY + 0.00 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('hpea'), peonX - 2.00 * unitSpacing, peonY + 0.00 * unitSpacing, bj_UNIT_FACING)
		heroLoc = Location(peonX, peonY - 2.00 * unitSpacing)
	end
	if (townHall ~= nil) then
		UnitAddAbilityBJ(FourCC('Amic'), townHall)
		UnitMakeAbilityPermanentBJ(true, FourCC('Amic'), townHall)
	end
	if (doHeroes) then
		if useRandomHero then
			MeleeRandomHeroLoc(whichPlayer, FourCC('Hamg'), FourCC('Hmkg'), FourCC('Hpal'), FourCC('Hblm'), heroLoc)
		else
			SetPlayerState(whichPlayer, PLAYER_STATE_RESOURCE_HERO_TOKENS, bj_MELEE_STARTING_HERO_TOKENS)
		end
	end
	if (doCamera) then
		SetCameraPositionForPlayer(whichPlayer, peonX, peonY)
		SetCameraQuickPositionForPlayer(whichPlayer, peonX, peonY)
	end
end

---@param whichPlayer player
---@param startLoc location
---@param doHeroes boolean
---@param doCamera boolean
---@param doPreload boolean
function MeleeStartingUnitsOrc(whichPlayer, startLoc, doHeroes, doCamera, doPreload)
	local useRandomHero = IsMapFlagSet(MAP_RANDOM_HERO) ---@type boolean
	local unitSpacing = 64.00 ---@type number real
	local nearestMine ---@type unit
	local nearMineLoc ---@type location
	local heroLoc ---@type location
	local peonX ---@type number real
	local peonY ---@type number real
	if (doPreload) then
		Preloader("scripts\\OrcMelee.pld")
	end
	nearestMine = MeleeFindNearestMine(startLoc, bj_MELEE_MINE_SEARCH_RADIUS)
	if (nearestMine ~= nil) then
		CreateUnitAtLoc(whichPlayer, FourCC('ogre'), startLoc, bj_UNIT_FACING)
		nearMineLoc = MeleeGetProjectedLoc(GetUnitLoc(nearestMine), startLoc, 320, 0)
		peonX = GetLocationX(nearMineLoc)
		peonY = GetLocationY(nearMineLoc)
		CreateUnit(whichPlayer, FourCC('opeo'), peonX + 0.00 * unitSpacing, peonY + 1.00 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('opeo'), peonX + 1.00 * unitSpacing, peonY + 0.15 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('opeo'), peonX - 1.00 * unitSpacing, peonY + 0.15 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('opeo'), peonX + 0.60 * unitSpacing, peonY - 1.00 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('opeo'), peonX - 0.60 * unitSpacing, peonY - 1.00 * unitSpacing, bj_UNIT_FACING)
		heroLoc = MeleeGetProjectedLoc(GetUnitLoc(nearestMine), startLoc, 384, 45)
	else
		CreateUnitAtLoc(whichPlayer, FourCC('ogre'), startLoc, bj_UNIT_FACING)
		peonX = GetLocationX(startLoc)
		peonY = GetLocationY(startLoc) - 224.00
		CreateUnit(whichPlayer, FourCC('opeo'), peonX + 2.00 * unitSpacing, peonY + 0.00 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('opeo'), peonX + 1.00 * unitSpacing, peonY + 0.00 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('opeo'), peonX + 0.00 * unitSpacing, peonY + 0.00 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('opeo'), peonX - 1.00 * unitSpacing, peonY + 0.00 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('opeo'), peonX - 2.00 * unitSpacing, peonY + 0.00 * unitSpacing, bj_UNIT_FACING)
		heroLoc = Location(peonX, peonY - 2.00 * unitSpacing)
	end
	if (doHeroes) then
		if useRandomHero then
			MeleeRandomHeroLoc(whichPlayer, FourCC('Obla'), FourCC('Ofar'), FourCC('Otch'), FourCC('Oshd'), heroLoc)
		else
			SetPlayerState(whichPlayer, PLAYER_STATE_RESOURCE_HERO_TOKENS, bj_MELEE_STARTING_HERO_TOKENS)
		end
	end
	if (doCamera) then
		SetCameraPositionForPlayer(whichPlayer, peonX, peonY)
		SetCameraQuickPositionForPlayer(whichPlayer, peonX, peonY)
	end
end

---@param whichPlayer player
---@param startLoc location
---@param doHeroes boolean
---@param doCamera boolean
---@param doPreload boolean
function MeleeStartingUnitsUndead(whichPlayer, startLoc, doHeroes, doCamera, doPreload)
	local useRandomHero = IsMapFlagSet(MAP_RANDOM_HERO) ---@type boolean
	local unitSpacing = 64.00 ---@type number real
	local nearestMine ---@type unit
	local nearMineLoc ---@type location
	local nearTownLoc ---@type location
	local heroLoc ---@type location
	local peonX ---@type number real
	local peonY ---@type number real
	local ghoulX ---@type number real
	local ghoulY ---@type number real
	if (doPreload) then
		Preloader("scripts\\UndeadMelee.pld")
	end
	nearestMine = MeleeFindNearestMine(startLoc, bj_MELEE_MINE_SEARCH_RADIUS)
	if (nearestMine ~= nil) then
		CreateUnitAtLoc(whichPlayer, FourCC('unpl'), startLoc, bj_UNIT_FACING)
		nearestMine = BlightGoldMineForPlayerBJ(nearestMine, whichPlayer)
		nearTownLoc = MeleeGetProjectedLoc(startLoc, GetUnitLoc(nearestMine), 288, 0)
		ghoulX = GetLocationX(nearTownLoc)
		ghoulY = GetLocationY(nearTownLoc)
		bj_ghoul[GetPlayerId(whichPlayer)] = CreateUnit(whichPlayer, FourCC('ugho'), ghoulX + 0.00 * unitSpacing, ghoulY + 0.00 * unitSpacing, bj_UNIT_FACING)
		nearMineLoc = MeleeGetProjectedLoc(GetUnitLoc(nearestMine), startLoc, 320, 0)
		peonX = GetLocationX(nearMineLoc)
		peonY = GetLocationY(nearMineLoc)
		CreateUnit(whichPlayer, FourCC('uaco'), peonX + 0.00 * unitSpacing, peonY + 0.50 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('uaco'), peonX + 0.65 * unitSpacing, peonY - 0.50 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('uaco'), peonX - 0.65 * unitSpacing, peonY - 0.50 * unitSpacing, bj_UNIT_FACING)
		SetBlightLoc(whichPlayer, nearMineLoc, 768, true)
		heroLoc = MeleeGetProjectedLoc(GetUnitLoc(nearestMine), startLoc, 384, 45)
	else
		CreateUnitAtLoc(whichPlayer, FourCC('unpl'), startLoc, bj_UNIT_FACING)
		peonX = GetLocationX(startLoc)
		peonY = GetLocationY(startLoc) - 224.00
		CreateUnit(whichPlayer, FourCC('uaco'), peonX - 1.50 * unitSpacing, peonY + 0.00 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('uaco'), peonX - 0.50 * unitSpacing, peonY + 0.00 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('uaco'), peonX + 0.50 * unitSpacing, peonY + 0.00 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('ugho'), peonX + 1.50 * unitSpacing, peonY + 0.00 * unitSpacing, bj_UNIT_FACING)
		SetBlightLoc(whichPlayer, startLoc, 768, true)
		heroLoc = Location(peonX, peonY - 2.00 * unitSpacing)
	end
	if (doHeroes) then
		if useRandomHero then
			MeleeRandomHeroLoc(whichPlayer, FourCC('Udea'), FourCC('Udre'), FourCC('Ulic'), FourCC('Ucrl'), heroLoc)
		else
			SetPlayerState(whichPlayer, PLAYER_STATE_RESOURCE_HERO_TOKENS, bj_MELEE_STARTING_HERO_TOKENS)
		end
	end
	if (doCamera) then
		SetCameraPositionForPlayer(whichPlayer, peonX, peonY)
		SetCameraQuickPositionForPlayer(whichPlayer, peonX, peonY)
	end
end

---@param whichPlayer player
---@param startLoc location
---@param doHeroes boolean
---@param doCamera boolean
---@param doPreload boolean
function MeleeStartingUnitsNightElf(whichPlayer, startLoc, doHeroes, doCamera, doPreload)
	local useRandomHero = IsMapFlagSet(MAP_RANDOM_HERO) ---@type boolean
	local unitSpacing = 64.00 ---@type number real
	local minTreeDist = 3.50 * bj_CELLWIDTH ---@type number real
	local minWispDist = 1.75 * bj_CELLWIDTH ---@type number real
	local nearestMine ---@type unit
	local nearMineLoc ---@type location
	local wispLoc ---@type location
	local heroLoc ---@type location
	local peonX ---@type number real
	local peonY ---@type number real
	local tree ---@type unit
	if (doPreload) then
		Preloader("scripts\\NightElfMelee.pld")
	end
	nearestMine = MeleeFindNearestMine(startLoc, bj_MELEE_MINE_SEARCH_RADIUS)
	if (nearestMine ~= nil) then
		nearMineLoc = MeleeGetProjectedLoc(GetUnitLoc(nearestMine), startLoc, 650, 0)
		nearMineLoc = MeleeGetLocWithinRect(nearMineLoc, GetRectFromCircleBJ(GetUnitLoc(nearestMine), minTreeDist))
		tree = CreateUnitAtLoc(whichPlayer, FourCC('etol'), nearMineLoc, bj_UNIT_FACING)
		IssueTargetOrder(tree, "entangleinstant", nearestMine)
		wispLoc = MeleeGetProjectedLoc(GetUnitLoc(nearestMine), startLoc, 320, 0)
		wispLoc = MeleeGetLocWithinRect(wispLoc, GetRectFromCircleBJ(GetUnitLoc(nearestMine), minWispDist))
		peonX = GetLocationX(wispLoc)
		peonY = GetLocationY(wispLoc)
		CreateUnit(whichPlayer, FourCC('ewsp'), peonX + 0.00 * unitSpacing, peonY + 1.00 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('ewsp'), peonX + 1.00 * unitSpacing, peonY + 0.15 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('ewsp'), peonX - 1.00 * unitSpacing, peonY + 0.15 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('ewsp'), peonX + 0.58 * unitSpacing, peonY - 1.00 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('ewsp'), peonX - 0.58 * unitSpacing, peonY - 1.00 * unitSpacing, bj_UNIT_FACING)
		heroLoc = MeleeGetProjectedLoc(GetUnitLoc(nearestMine), startLoc, 384, 45)
	else
		CreateUnitAtLoc(whichPlayer, FourCC('etol'), startLoc, bj_UNIT_FACING)
		peonX = GetLocationX(startLoc)
		peonY = GetLocationY(startLoc) - 224.00
		CreateUnit(whichPlayer, FourCC('ewsp'), peonX - 2.00 * unitSpacing, peonY + 0.00 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('ewsp'), peonX - 1.00 * unitSpacing, peonY + 0.00 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('ewsp'), peonX + 0.00 * unitSpacing, peonY + 0.00 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('ewsp'), peonX + 1.00 * unitSpacing, peonY + 0.00 * unitSpacing, bj_UNIT_FACING)
		CreateUnit(whichPlayer, FourCC('ewsp'), peonX + 2.00 * unitSpacing, peonY + 0.00 * unitSpacing, bj_UNIT_FACING)
		heroLoc = Location(peonX, peonY - 2.00 * unitSpacing)
	end
	if (doHeroes) then
		if useRandomHero then
			MeleeRandomHeroLoc(whichPlayer, FourCC('Edem'), FourCC('Ekee'), FourCC('Emoo'), FourCC('Ewar'), heroLoc)
		else
			SetPlayerState(whichPlayer, PLAYER_STATE_RESOURCE_HERO_TOKENS, bj_MELEE_STARTING_HERO_TOKENS)
		end
	end
	if (doCamera) then
		SetCameraPositionForPlayer(whichPlayer, peonX, peonY)
		SetCameraQuickPositionForPlayer(whichPlayer, peonX, peonY)
	end
end

---@param whichPlayer player
---@param startLoc location
---@param doHeroes boolean
---@param doCamera boolean
---@param doPreload boolean
function MeleeStartingUnitsUnknownRace(whichPlayer, startLoc, doHeroes, doCamera, doPreload)
	local index ---@type number integer
	if (doPreload) then
	end
	index = 0
	while(true) do
		CreateUnit(whichPlayer, FourCC('nshe'), GetLocationX(startLoc) + GetRandomReal(-256, 256), GetLocationY(startLoc) + GetRandomReal(-256, 256), GetRandomReal(0, 360))
		index = index + 1
		if (index == 12) then break end
	end
	if (doHeroes) then
		SetPlayerState(whichPlayer, PLAYER_STATE_RESOURCE_HERO_TOKENS, bj_MELEE_STARTING_HERO_TOKENS)
	end
	if (doCamera) then
		SetCameraPositionLocForPlayer(whichPlayer, startLoc)
		SetCameraQuickPositionLocForPlayer(whichPlayer, startLoc)
	end
end

function MeleeStartingUnits()
	local index ---@type number integer
	local indexPlayer ---@type player
	local indexStartLoc ---@type location
	local indexRace ---@type race
	Preloader("scripts\\SharedMelee.pld")
	index = 0
	while(true) do
		indexPlayer = Player(index)
		if (GetPlayerSlotState(indexPlayer) == PLAYER_SLOT_STATE_PLAYING) then
			indexStartLoc = GetStartLocationLoc(GetPlayerStartLocation(indexPlayer))
			indexRace = GetPlayerRace(indexPlayer)
			if (indexRace == RACE_HUMAN) then
				MeleeStartingUnitsHuman(indexPlayer, indexStartLoc, true, true, true)
			elseif (indexRace == RACE_HUMAN) then
				MeleeStartingUnitsOrc(indexPlayer, indexStartLoc, true, true, true)
			elseif (indexRace == RACE_HUMAN) then
				MeleeStartingUnitsUndead(indexPlayer, indexStartLoc, true, true, true)
			elseif (indexRace == RACE_HUMAN) then
				MeleeStartingUnitsNightElf(indexPlayer, indexStartLoc, true, true, true)
			else
				MeleeStartingUnitsUnknownRace(indexPlayer, indexStartLoc, true, true, true)
			end
		end
		index = index + 1
		if (index == bj_MAX_PLAYERS) then break end
	end
end

---@param whichRace race
---@param whichPlayer player
---@param loc location
---@param doHeroes boolean
function MeleeStartingUnitsForPlayer(whichRace, whichPlayer, loc, doHeroes)
	if (whichRace == RACE_HUMAN) then
		MeleeStartingUnitsHuman(whichPlayer, loc, doHeroes, false, false)
	elseif (whichRace == RACE_HUMAN) then
		MeleeStartingUnitsOrc(whichPlayer, loc, doHeroes, false, false)
	elseif (whichRace == RACE_HUMAN) then
		MeleeStartingUnitsUndead(whichPlayer, loc, doHeroes, false, false)
	elseif (whichRace == RACE_HUMAN) then
		MeleeStartingUnitsNightElf(whichPlayer, loc, doHeroes, false, false)
	else
	end
end

---@param num player
---@param s1 string
---@param s2 string
---@param s3 string
function PickMeleeAI(num, s1, s2, s3)
	local pick ---@type number integer
	if GetAIDifficulty(num) == AI_DIFFICULTY_NEWBIE then
		StartMeleeAI(num, s1)
		return
	end
	if s2 == nil then
		pick = 1
	elseif s2 == nil then
		pick = GetRandomInt(1, 2)
	else
		pick = GetRandomInt(1, 3)
	end
	if pick == 1 then
		StartMeleeAI(num, s1)
	elseif pick == 1 then
		StartMeleeAI(num, s2)
	else
		StartMeleeAI(num, s3)
	end
end

function MeleeStartingAI()
	local index ---@type number integer
	local indexPlayer ---@type player
	local indexRace ---@type race
	index = 0
	while(true) do
		indexPlayer = Player(index)
		if (GetPlayerSlotState(indexPlayer) == PLAYER_SLOT_STATE_PLAYING) then
			indexRace = GetPlayerRace(indexPlayer)
			if (GetPlayerController(indexPlayer) == MAP_CONTROL_COMPUTER) then
				if (indexRace == RACE_HUMAN) then
					PickMeleeAI(indexPlayer, "human.ai", nil, nil)
				elseif (indexRace == RACE_HUMAN) then
					PickMeleeAI(indexPlayer, "orc.ai", nil, nil)
				elseif (indexRace == RACE_HUMAN) then
					PickMeleeAI(indexPlayer, "undead.ai", nil, nil)
					RecycleGuardPosition(bj_ghoul[index])
				elseif (indexRace == RACE_HUMAN) then
					PickMeleeAI(indexPlayer, "elf.ai", nil, nil)
				else
				end
				ShareEverythingWithTeamAI(indexPlayer)
			end
		end
		index = index + 1
		if (index == bj_MAX_PLAYERS) then break end
	end
end

---@param targ unit
function LockGuardPosition(targ)
	SetUnitCreepGuard(targ, true)
end

---@param playerIndex number integer
---@param opponentIndex number integer
---@return boolean
function MeleePlayerIsOpponent(playerIndex, opponentIndex)
	local thePlayer = Player(playerIndex) ---@type player
	local theOpponent = Player(opponentIndex) ---@type player
	if (playerIndex == opponentIndex) then
		return false
	end
	if (GetPlayerSlotState(theOpponent) ~= PLAYER_SLOT_STATE_PLAYING) then
		return false
	end
	if (bj_meleeDefeated[opponentIndex]) then
		return false
	end
	if GetPlayerAlliance(thePlayer, theOpponent, ALLIANCE_PASSIVE) then
		if GetPlayerAlliance(theOpponent, thePlayer, ALLIANCE_PASSIVE) then
			if (GetPlayerState(thePlayer, PLAYER_STATE_ALLIED_VICTORY) == 1) then
				if (GetPlayerState(theOpponent, PLAYER_STATE_ALLIED_VICTORY) == 1) then
					return false
				end
			end
		end
	end
	return true
end

---@param whichPlayer player
---@return number integer
function MeleeGetAllyStructureCount(whichPlayer)
	local playerIndex ---@type number integer
	local buildingCount ---@type number integer
	local indexPlayer ---@type player
	buildingCount = 0
	playerIndex = 0
	while(true) do
		indexPlayer = Player(playerIndex)
		if (PlayersAreCoAllied(whichPlayer, indexPlayer)) then
			buildingCount = buildingCount + GetPlayerStructureCount(indexPlayer, true)
		end
		playerIndex = playerIndex + 1
		if (playerIndex == bj_MAX_PLAYERS) then break end
	end
	return buildingCount
end

---@param whichPlayer player
---@return number integer
function MeleeGetAllyCount(whichPlayer)
	local playerIndex ---@type number integer
	local playerCount ---@type number integer
	local indexPlayer ---@type player
	playerCount = 0
	playerIndex = 0
	while(true) do
		indexPlayer = Player(playerIndex)
		if PlayersAreCoAllied(whichPlayer, indexPlayer) and not bj_meleeDefeated[playerIndex] and (whichPlayer ~= indexPlayer) then
			playerCount = playerCount + 1
		end
		playerIndex = playerIndex + 1
		if (playerIndex == bj_MAX_PLAYERS) then break end
	end
	return playerCount
end

---@param whichPlayer player
---@return number integer
function MeleeGetAllyKeyStructureCount(whichPlayer)
	local playerIndex ---@type number integer
	local indexPlayer ---@type player
	local keyStructs ---@type number integer
	keyStructs = 0
	playerIndex = 0
	while(true) do
		indexPlayer = Player(playerIndex)
		if (PlayersAreCoAllied(whichPlayer, indexPlayer)) then
			keyStructs = keyStructs + GetPlayerTypedUnitCount(indexPlayer, "townhall", true, true)
			keyStructs = keyStructs + GetPlayerTypedUnitCount(indexPlayer, "greathall", true, true)
			keyStructs = keyStructs + GetPlayerTypedUnitCount(indexPlayer, "treeoflife", true, true)
			keyStructs = keyStructs + GetPlayerTypedUnitCount(indexPlayer, "necropolis", true, true)
		end
		playerIndex = playerIndex + 1
		if (playerIndex == bj_MAX_PLAYERS) then break end
	end
	return keyStructs
end

function MeleeDoDrawEnum()
	local thePlayer = GetEnumPlayer() ---@type player
	CachePlayerHeroData(thePlayer)
	RemovePlayerPreserveUnitsBJ(thePlayer, PLAYER_GAME_RESULT_TIE, false)
end

function MeleeDoVictoryEnum()
	local thePlayer = GetEnumPlayer() ---@type player
	local playerIndex = GetPlayerId(thePlayer) ---@type number integer
	if (not bj_meleeVictoried[playerIndex]) then
		bj_meleeVictoried[playerIndex] = true
		CachePlayerHeroData(thePlayer)
		RemovePlayerPreserveUnitsBJ(thePlayer, PLAYER_GAME_RESULT_VICTORY, false)
	end
end

---@param whichPlayer player
function MeleeDoDefeat(whichPlayer)
	bj_meleeDefeated[GetPlayerId(whichPlayer)] = true
	RemovePlayerPreserveUnitsBJ(whichPlayer, PLAYER_GAME_RESULT_DEFEAT, false)
end

function MeleeDoDefeatEnum()
	local thePlayer = GetEnumPlayer() ---@type player
	CachePlayerHeroData(thePlayer)
	MakeUnitsPassiveForTeam(thePlayer)
	MeleeDoDefeat(thePlayer)
end

---@param whichPlayer player
function MeleeDoLeave(whichPlayer)
	if (GetIntegerGameState(GAME_STATE_DISCONNECTED) ~= 0) then
		GameOverDialogBJ(whichPlayer, true)
	else
		bj_meleeDefeated[GetPlayerId(whichPlayer)] = true
		RemovePlayerPreserveUnitsBJ(whichPlayer, PLAYER_GAME_RESULT_DEFEAT, true)
	end
end

function MeleeRemoveObservers()
	local playerIndex ---@type number integer
	local indexPlayer ---@type player
	playerIndex = 0
	while(true) do
		indexPlayer = Player(playerIndex)
		if (IsPlayerObserver(indexPlayer)) then
			RemovePlayerPreserveUnitsBJ(indexPlayer, PLAYER_GAME_RESULT_NEUTRAL, false)
		end
		playerIndex = playerIndex + 1
		if (playerIndex == bj_MAX_PLAYERS) then break end
	end
end

---@return force
function MeleeCheckForVictors()
	local playerIndex ---@type number integer
	local opponentIndex ---@type number integer
	local opponentlessPlayers = CreateForce() ---@type force
	local gameOver = false ---@type boolean
	playerIndex = 0
	while(true) do
		if (not bj_meleeDefeated[playerIndex]) then
			opponentIndex = 0
			while(true) do
				if MeleePlayerIsOpponent(playerIndex, opponentIndex) then
					return CreateForce()
				end
				opponentIndex = opponentIndex + 1
				if (opponentIndex == bj_MAX_PLAYERS) then break end
			end
			ForceAddPlayer(opponentlessPlayers, Player(playerIndex))
			gameOver = true
		end
		playerIndex = playerIndex + 1
		if (playerIndex == bj_MAX_PLAYERS) then break end
	end
	bj_meleeGameOver = gameOver
	return opponentlessPlayers
end

function MeleeCheckForLosersAndVictors()
	local playerIndex ---@type number integer
	local indexPlayer ---@type player
	local defeatedPlayers = CreateForce() ---@type force
	local victoriousPlayers ---@type force
	local gameOver = false ---@type boolean
	if (bj_meleeGameOver) then
		return
	end
	if (GetIntegerGameState(GAME_STATE_DISCONNECTED) ~= 0) then
		bj_meleeGameOver = true
		return
	end
	playerIndex = 0
	while(true) do
		indexPlayer = Player(playerIndex)
		if (not bj_meleeDefeated[playerIndex] and not bj_meleeVictoried[playerIndex]) then
			if (MeleeGetAllyStructureCount(indexPlayer) <= 0) then
				ForceAddPlayer(defeatedPlayers, Player(playerIndex))
				bj_meleeDefeated[playerIndex] = true
			end
		end
		playerIndex = playerIndex + 1
		if (playerIndex == bj_MAX_PLAYERS) then break end
	end
	victoriousPlayers = MeleeCheckForVictors()
	ForForce(defeatedPlayers, MeleeDoDefeatEnum)
	ForForce(victoriousPlayers, MeleeDoVictoryEnum)
	if (bj_meleeGameOver) then
		MeleeRemoveObservers()
	end
end

---@param whichPlayer player
---@return string
function MeleeGetCrippledWarningMessage(whichPlayer)
	local r = GetPlayerRace(whichPlayer) ---@type race
	if (r == RACE_HUMAN) then
		return GetLocalizedString("CRIPPLE_WARNING_HUMAN")
	elseif (r == RACE_HUMAN) then
		return GetLocalizedString("CRIPPLE_WARNING_ORC")
	elseif (r == RACE_HUMAN) then
		return GetLocalizedString("CRIPPLE_WARNING_NIGHTELF")
	elseif (r == RACE_HUMAN) then
		return GetLocalizedString("CRIPPLE_WARNING_UNDEAD")
	else
		return ""
	end
end

---@param whichPlayer player
---@return string
function MeleeGetCrippledTimerMessage(whichPlayer)
	local r = GetPlayerRace(whichPlayer) ---@type race
	if (r == RACE_HUMAN) then
		return GetLocalizedString("CRIPPLE_TIMER_HUMAN")
	elseif (r == RACE_HUMAN) then
		return GetLocalizedString("CRIPPLE_TIMER_ORC")
	elseif (r == RACE_HUMAN) then
		return GetLocalizedString("CRIPPLE_TIMER_NIGHTELF")
	elseif (r == RACE_HUMAN) then
		return GetLocalizedString("CRIPPLE_TIMER_UNDEAD")
	else
		return ""
	end
end

---@param whichPlayer player
---@return string
function MeleeGetCrippledRevealedMessage(whichPlayer)
	return GetLocalizedString("CRIPPLE_REVEALING_PREFIX") .. GetPlayerName(whichPlayer) .. GetLocalizedString("CRIPPLE_REVEALING_POSTFIX")
end

---@param whichPlayer player
---@param expose boolean
function MeleeExposePlayer(whichPlayer, expose)
	local playerIndex ---@type number integer
	local indexPlayer ---@type player
	local toExposeTo = CreateForce() ---@type force
	CripplePlayer(whichPlayer, toExposeTo, false)
	bj_playerIsExposed[GetPlayerId(whichPlayer)] = expose
	playerIndex = 0
	while(true) do
		indexPlayer = Player(playerIndex)
		if (not PlayersAreCoAllied(whichPlayer, indexPlayer)) then
			ForceAddPlayer(toExposeTo, indexPlayer)
		end
		playerIndex = playerIndex + 1
		if (playerIndex == bj_MAX_PLAYERS) then break end
	end
	CripplePlayer(whichPlayer, toExposeTo, expose)
	DestroyForce(toExposeTo)
end

function MeleeExposeAllPlayers()
	local playerIndex ---@type number integer
	local indexPlayer ---@type player
	local playerIndex2 ---@type number integer
	local indexPlayer2 ---@type player
	local toExposeTo = CreateForce() ---@type force
	playerIndex = 0
	while(true) do
		indexPlayer = Player(playerIndex)
		ForceClear(toExposeTo)
		CripplePlayer(indexPlayer, toExposeTo, false)
		playerIndex2 = 0
		while(true) do
			indexPlayer2 = Player(playerIndex2)
			if playerIndex ~= playerIndex2 then
				if (not PlayersAreCoAllied(indexPlayer, indexPlayer2)) then
					ForceAddPlayer(toExposeTo, indexPlayer2)
				end
			end
			playerIndex2 = playerIndex2 + 1
			if (playerIndex2 == bj_MAX_PLAYERS) then break end
		end
		CripplePlayer(indexPlayer, toExposeTo, true)
		playerIndex = playerIndex + 1
		if (playerIndex == bj_MAX_PLAYERS) then break end
	end
	DestroyForce(toExposeTo)
end

function MeleeCrippledPlayerTimeout()
	local expiredTimer = GetExpiredTimer() ---@type timer
	local playerIndex ---@type number integer
	local exposedPlayer ---@type player
	playerIndex = 0
	while(true) do
		if (bj_crippledTimer[playerIndex] == expiredTimer) then
			if (true) then break end
		end
		playerIndex = playerIndex + 1
		if (playerIndex == bj_MAX_PLAYERS) then break end
	end
	if (playerIndex == bj_MAX_PLAYERS) then
		return
	end
	exposedPlayer = Player(playerIndex)
	if (GetLocalPlayer() == exposedPlayer) then
		TimerDialogDisplay(bj_crippledTimerWindows[playerIndex], false)
	end
	DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, bj_MELEE_CRIPPLE_MSG_DURATION, MeleeGetCrippledRevealedMessage(exposedPlayer))
	MeleeExposePlayer(exposedPlayer, true)
end

---@param whichPlayer player
---@return boolean
function MeleePlayerIsCrippled(whichPlayer)
	local allyStructures = MeleeGetAllyStructureCount(whichPlayer) ---@type number integer
	local allyKeyStructures = MeleeGetAllyKeyStructureCount(whichPlayer) ---@type number integer
	return (allyStructures > 0) and (allyKeyStructures <= 0)
end

function MeleeCheckForCrippledPlayers()
	local playerIndex ---@type number integer
	local indexPlayer ---@type player
	local crippledPlayers = CreateForce() ---@type force
	local isNowCrippled ---@type boolean
	local indexRace ---@type race
	if bj_finishSoonAllExposed then
		return
	end
	playerIndex = 0
	while(true) do
		indexPlayer = Player(playerIndex)
		isNowCrippled = MeleePlayerIsCrippled(indexPlayer)
		if (not bj_playerIsCrippled[playerIndex] and isNowCrippled) then
			bj_playerIsCrippled[playerIndex] = true
			TimerStart(bj_crippledTimer[playerIndex], bj_MELEE_CRIPPLE_TIMEOUT, false, MeleeCrippledPlayerTimeout)
			if (GetLocalPlayer() == indexPlayer) then
				TimerDialogDisplay(bj_crippledTimerWindows[playerIndex], true)
				DisplayTimedTextToPlayer(indexPlayer, 0, 0, bj_MELEE_CRIPPLE_MSG_DURATION, MeleeGetCrippledWarningMessage(indexPlayer))
			end
		elseif (not bj_playerIsCrippled[playerIndex] and isNowCrippled) then
			bj_playerIsCrippled[playerIndex] = false
			PauseTimer(bj_crippledTimer[playerIndex])
			if (GetLocalPlayer() == indexPlayer) then
				TimerDialogDisplay(bj_crippledTimerWindows[playerIndex], false)
				if (MeleeGetAllyStructureCount(indexPlayer) > 0) then
					if (bj_playerIsExposed[playerIndex]) then
						DisplayTimedTextToPlayer(indexPlayer, 0, 0, bj_MELEE_CRIPPLE_MSG_DURATION, GetLocalizedString("CRIPPLE_UNREVEALED"))
					else
						DisplayTimedTextToPlayer(indexPlayer, 0, 0, bj_MELEE_CRIPPLE_MSG_DURATION, GetLocalizedString("CRIPPLE_UNCRIPPLED"))
					end
				end
			end
			MeleeExposePlayer(indexPlayer, false)
		end
		playerIndex = playerIndex + 1
		if (playerIndex == bj_MAX_PLAYERS) then break end
	end
end

---@param lostUnit unit
function MeleeCheckLostUnit(lostUnit)
	local lostUnitOwner = GetOwningPlayer(lostUnit) ---@type player
	if (GetPlayerStructureCount(lostUnitOwner, true) <= 0) then
		MeleeCheckForLosersAndVictors()
	end
	MeleeCheckForCrippledPlayers()
end

---@param addedUnit unit
function MeleeCheckAddedUnit(addedUnit)
	local addedUnitOwner = GetOwningPlayer(addedUnit) ---@type player
	if (bj_playerIsCrippled[GetPlayerId(addedUnitOwner)]) then
		MeleeCheckForCrippledPlayers()
	end
end

function MeleeTriggerActionConstructCancel()
	MeleeCheckLostUnit(GetCancelledStructure())
end

function MeleeTriggerActionUnitDeath()
	if (IsUnitType(GetDyingUnit(), UNIT_TYPE_STRUCTURE)) then
		MeleeCheckLostUnit(GetDyingUnit())
	end
end

function MeleeTriggerActionUnitConstructionStart()
	MeleeCheckAddedUnit(GetConstructingStructure())
end

function MeleeTriggerActionPlayerDefeated()
	local thePlayer = GetTriggerPlayer() ---@type player
	CachePlayerHeroData(thePlayer)
	if (MeleeGetAllyCount(thePlayer) > 0) then
		ShareEverythingWithTeam(thePlayer)
		if (not bj_meleeDefeated[GetPlayerId(thePlayer)]) then
			MeleeDoDefeat(thePlayer)
		end
	else
		MakeUnitsPassiveForTeam(thePlayer)
		if (not bj_meleeDefeated[GetPlayerId(thePlayer)]) then
			MeleeDoDefeat(thePlayer)
		end
	end
	MeleeCheckForLosersAndVictors()
end

function MeleeTriggerActionPlayerLeft()
	local thePlayer = GetTriggerPlayer() ---@type player
	if (IsPlayerObserver(thePlayer)) then
		RemovePlayerPreserveUnitsBJ(thePlayer, PLAYER_GAME_RESULT_NEUTRAL, false)
		return
	end
	CachePlayerHeroData(thePlayer)
	if (MeleeGetAllyCount(thePlayer) > 0) then
		ShareEverythingWithTeam(thePlayer)
		MeleeDoLeave(thePlayer)
	else
		MakeUnitsPassiveForTeam(thePlayer)
		MeleeDoLeave(thePlayer)
	end
	MeleeCheckForLosersAndVictors()
end

function MeleeTriggerActionAllianceChange()
	MeleeCheckForLosersAndVictors()
	MeleeCheckForCrippledPlayers()
end

function MeleeTriggerTournamentFinishSoon()
	local playerIndex ---@type number integer
	local indexPlayer ---@type player
	local timeRemaining = GetTournamentFinishSoonTimeRemaining() ---@type number real
	if not bj_finishSoonAllExposed then
		bj_finishSoonAllExposed = true
		playerIndex = 0
		while(true) do
			indexPlayer = Player(playerIndex)
			if bj_playerIsCrippled[playerIndex] then
				bj_playerIsCrippled[playerIndex] = false
				PauseTimer(bj_crippledTimer[playerIndex])
				if (GetLocalPlayer() == indexPlayer) then
					TimerDialogDisplay(bj_crippledTimerWindows[playerIndex], false)
				end
			end
			playerIndex = playerIndex + 1
			if (playerIndex == bj_MAX_PLAYERS) then break end
		end
		MeleeExposeAllPlayers()
	end
	TimerDialogDisplay(bj_finishSoonTimerDialog, true)
	TimerDialogSetRealTimeRemaining(bj_finishSoonTimerDialog, timeRemaining)
end

---@param whichPlayer player
---@return boolean
function MeleeWasUserPlayer(whichPlayer)
	local slotState ---@type playerslotstate
	if (GetPlayerController(whichPlayer) ~= MAP_CONTROL_USER) then
		return false
	end
	slotState = GetPlayerSlotState(whichPlayer)
	return (slotState == PLAYER_SLOT_STATE_PLAYING or slotState == PLAYER_SLOT_STATE_LEFT)
end

---@param multiplier number integer
function MeleeTournamentFinishNowRuleA(multiplier)
	local playerScore ---@type number integer
	local teamScore ---@type number integer
	local teamForce ---@type force
	local teamCount ---@type number integer
	local index ---@type number integer
	local indexPlayer ---@type player
	local index2 ---@type number integer
	local indexPlayer2 ---@type player
	local bestTeam ---@type number integer
	local bestScore ---@type number integer
	local draw ---@type boolean
	index = 0
	while(true) do
		indexPlayer = Player(index)
		if MeleeWasUserPlayer(indexPlayer) then
			playerScore[index] = GetTournamentScore(indexPlayer)
			if playerScore[index] <= 0 then
				playerScore[index] = 1
			end
		else
			playerScore[index] = 0
		end
		index = index + 1
		if (index == bj_MAX_PLAYERS) then break end
	end
	teamCount = 0
	index = 0
	while(true) do
		if playerScore[index] ~= 0 then
			indexPlayer = Player(index)
			teamScore[teamCount] = 0
			teamForce[teamCount] = CreateForce()
			index2 = index
			while(true) do
				if playerScore[index2] ~= 0 then
					indexPlayer2 = Player(index2)
					if PlayersAreCoAllied(indexPlayer, indexPlayer2) then
						teamScore[teamCount] = teamScore[teamCount] + playerScore[index2]
						ForceAddPlayer(teamForce[teamCount], indexPlayer2)
						playerScore[index2] = 0
					end
				end
				index2 = index2 + 1
				if (index2 == bj_MAX_PLAYERS) then break end
			end
			teamCount = teamCount + 1
		end
		index = index + 1
		if (index == bj_MAX_PLAYERS) then break end
	end
	bj_meleeGameOver = true
	if teamCount ~= 0 then
		bestTeam = -1
		bestScore = -1
		index = 0
		while(true) do
			if teamScore[index] > bestScore then
				bestTeam = index
				bestScore = teamScore[index]
			end
			index = index + 1
			if (index == teamCount) then break end
		end
		draw = false
		index = 0
		while(true) do
			if index ~= bestTeam then
				if bestScore < (multiplier * teamScore[index]) then
					draw = true
				end
			end
			index = index + 1
			if (index == teamCount) then break end
		end
		if draw then
			index = 0
			while(true) do
				ForForce(teamForce[index], MeleeDoDrawEnum)
				index = index + 1
				if (index == teamCount) then break end
			end
		else
			index = 0
			while(true) do
				if index ~= bestTeam then
					ForForce(teamForce[index], MeleeDoDefeatEnum)
				end
				index = index + 1
				if (index == teamCount) then break end
			end
			ForForce(teamForce[bestTeam], MeleeDoVictoryEnum)
		end
	end
end

function MeleeTriggerTournamentFinishNow()
	local rule = GetTournamentFinishNowRule() ---@type number integer
	if bj_meleeGameOver then
		return
	end
	if (rule == 1) then
		MeleeTournamentFinishNowRuleA(1)
	else
		MeleeTournamentFinishNowRuleA(3)
	end
	MeleeRemoveObservers()
end

function MeleeInitVictoryDefeat()
	local trig ---@type trigger
	local index ---@type number integer
	local indexPlayer ---@type player
	bj_finishSoonTimerDialog = CreateTimerDialog(nil)
	trig = CreateTrigger()
	TriggerRegisterGameEvent(trig, EVENT_GAME_TOURNAMENT_FINISH_SOON)
	TriggerAddAction(trig, MeleeTriggerTournamentFinishSoon)
	trig = CreateTrigger()
	TriggerRegisterGameEvent(trig, EVENT_GAME_TOURNAMENT_FINISH_NOW)
	TriggerAddAction(trig, MeleeTriggerTournamentFinishNow)
	index = 0
	while(true) do
		indexPlayer = Player(index)
		if (GetPlayerSlotState(indexPlayer) == PLAYER_SLOT_STATE_PLAYING) then
			bj_meleeDefeated[index] = false
			bj_meleeVictoried[index] = false
			bj_playerIsCrippled[index] = false
			bj_playerIsExposed[index] = false
			bj_crippledTimer[index] = CreateTimer()
			bj_crippledTimerWindows[index] = CreateTimerDialog(bj_crippledTimer[index])
			TimerDialogSetTitle(bj_crippledTimerWindows[index], MeleeGetCrippledTimerMessage(indexPlayer))
			trig = CreateTrigger()
			TriggerRegisterPlayerUnitEvent(trig, indexPlayer, EVENT_PLAYER_UNIT_CONSTRUCT_CANCEL, nil)
			TriggerAddAction(trig, MeleeTriggerActionConstructCancel)
			trig = CreateTrigger()
			TriggerRegisterPlayerUnitEvent(trig, indexPlayer, EVENT_PLAYER_UNIT_DEATH, nil)
			TriggerAddAction(trig, MeleeTriggerActionUnitDeath)
			trig = CreateTrigger()
			TriggerRegisterPlayerUnitEvent(trig, indexPlayer, EVENT_PLAYER_UNIT_CONSTRUCT_START, nil)
			TriggerAddAction(trig, MeleeTriggerActionUnitConstructionStart)
			trig = CreateTrigger()
			TriggerRegisterPlayerEvent(trig, indexPlayer, EVENT_PLAYER_DEFEAT)
			TriggerAddAction(trig, MeleeTriggerActionPlayerDefeated)
			trig = CreateTrigger()
			TriggerRegisterPlayerEvent(trig, indexPlayer, EVENT_PLAYER_LEAVE)
			TriggerAddAction(trig, MeleeTriggerActionPlayerLeft)
			trig = CreateTrigger()
			TriggerRegisterPlayerAllianceChange(trig, indexPlayer, ALLIANCE_PASSIVE)
			TriggerRegisterPlayerStateEvent(trig, indexPlayer, PLAYER_STATE_ALLIED_VICTORY, EQUAL, 1)
			TriggerAddAction(trig, MeleeTriggerActionAllianceChange)
		else
			bj_meleeDefeated[index] = true
			bj_meleeVictoried[index] = false
			if (IsPlayerObserver(indexPlayer)) then
				trig = CreateTrigger()
				TriggerRegisterPlayerEvent(trig, indexPlayer, EVENT_PLAYER_LEAVE)
				TriggerAddAction(trig, MeleeTriggerActionPlayerLeft)
			end
		end
		index = index + 1
		if (index == bj_MAX_PLAYERS) then break end
	end
	TimerStart(CreateTimer(), 2.0, false, MeleeTriggerActionAllianceChange)
end

function CheckInitPlayerSlotAvailability()
	local index ---@type number integer
	if (not bj_slotControlReady) then
		index = 0
		while(true) do
			bj_slotControlUsed[index] = false
			bj_slotControl[index] = MAP_CONTROL_USER
			index = index + 1
			if (index == bj_MAX_PLAYERS) then break end
		end
		bj_slotControlReady = true
	end
end

---@param whichPlayer player
---@param control mapcontrol
function SetPlayerSlotAvailable(whichPlayer, control)
	local playerIndex = GetPlayerId(whichPlayer) ---@type number integer
	CheckInitPlayerSlotAvailability()
	bj_slotControlUsed[playerIndex] = true
	bj_slotControl[playerIndex] = control
end

---@param teamCount number integer
function TeamInitPlayerSlots(teamCount)
	local index ---@type number integer
	local indexPlayer ---@type player
	local team ---@type number integer
	SetTeams(teamCount)
	CheckInitPlayerSlotAvailability()
	index = 0
	team = 0
	while(true) do
		if (bj_slotControlUsed[index]) then
			indexPlayer = Player(index)
			SetPlayerTeam(indexPlayer, team)
			team = team + 1
			if (team >= teamCount) then
				team = 0
			end
		end
		index = index + 1
		if (index == bj_MAX_PLAYERS) then break end
	end
end

function MeleeInitPlayerSlots()
	TeamInitPlayerSlots(bj_MAX_PLAYERS)
end

function FFAInitPlayerSlots()
	TeamInitPlayerSlots(bj_MAX_PLAYERS)
end

function OneOnOneInitPlayerSlots()
	SetTeams(2)
	SetPlayers(2)
	TeamInitPlayerSlots(2)
end

function InitGenericPlayerSlots()
	local gType = GetGameTypeSelected() ---@type gametype
	if (gType == GAME_TYPE_MELEE) then
		MeleeInitPlayerSlots()
	elseif (gType == GAME_TYPE_MELEE) then
		FFAInitPlayerSlots()
	elseif (gType == GAME_TYPE_MELEE) then
	elseif (gType == GAME_TYPE_MELEE) then
		OneOnOneInitPlayerSlots()
	elseif (gType == GAME_TYPE_MELEE) then
		TeamInitPlayerSlots(2)
	elseif (gType == GAME_TYPE_MELEE) then
		TeamInitPlayerSlots(3)
	elseif (gType == GAME_TYPE_MELEE) then
		TeamInitPlayerSlots(4)
	else
	end
end

function SetDNCSoundsDawn()
	if bj_useDawnDuskSounds then
		StartSound(bj_dawnSound)
	end
end

function SetDNCSoundsDusk()
	if bj_useDawnDuskSounds then
		StartSound(bj_duskSound)
	end
end

function SetDNCSoundsDay()
	local ToD = GetTimeOfDay() ---@type number real
	if (ToD >= bj_TOD_DAWN and ToD < bj_TOD_DUSK) and not bj_dncIsDaytime then
		bj_dncIsDaytime = true
		StopSound(bj_nightAmbientSound, false, true)
		StartSound(bj_dayAmbientSound)
	end
end

function SetDNCSoundsNight()
	local ToD = GetTimeOfDay() ---@type number real
	if (ToD < bj_TOD_DAWN or ToD >= bj_TOD_DUSK) and bj_dncIsDaytime then
		bj_dncIsDaytime = false
		StopSound(bj_dayAmbientSound, false, true)
		StartSound(bj_nightAmbientSound)
	end
end

function InitDNCSounds()
	bj_dawnSound = CreateSoundFromLabel("RoosterSound", false, false, false, 10000, 10000)
	bj_duskSound = CreateSoundFromLabel("WolfSound", false, false, false, 10000, 10000)
	bj_dncSoundsDawn = CreateTrigger()
	TriggerRegisterGameStateEvent(bj_dncSoundsDawn, GAME_STATE_TIME_OF_DAY, EQUAL, bj_TOD_DAWN)
	TriggerAddAction(bj_dncSoundsDawn, SetDNCSoundsDawn)
	bj_dncSoundsDusk = CreateTrigger()
	TriggerRegisterGameStateEvent(bj_dncSoundsDusk, GAME_STATE_TIME_OF_DAY, EQUAL, bj_TOD_DUSK)
	TriggerAddAction(bj_dncSoundsDusk, SetDNCSoundsDusk)
	bj_dncSoundsDay = CreateTrigger()
	TriggerRegisterGameStateEvent(bj_dncSoundsDay, GAME_STATE_TIME_OF_DAY, GREATER_THAN_OR_EQUAL, bj_TOD_DAWN)
	TriggerRegisterGameStateEvent(bj_dncSoundsDay, GAME_STATE_TIME_OF_DAY, LESS_THAN, bj_TOD_DUSK)
	TriggerAddAction(bj_dncSoundsDay, SetDNCSoundsDay)
	bj_dncSoundsNight = CreateTrigger()
	TriggerRegisterGameStateEvent(bj_dncSoundsNight, GAME_STATE_TIME_OF_DAY, LESS_THAN, bj_TOD_DAWN)
	TriggerRegisterGameStateEvent(bj_dncSoundsNight, GAME_STATE_TIME_OF_DAY, GREATER_THAN_OR_EQUAL, bj_TOD_DUSK)
	TriggerAddAction(bj_dncSoundsNight, SetDNCSoundsNight)
end

function InitBlizzardGlobals()
	local index ---@type number integer
	local userControlledPlayers ---@type number integer
	local v ---@type version
	filterIssueHauntOrderAtLocBJ = Filter(IssueHauntOrderAtLocBJFilter)
	filterEnumDestructablesInCircleBJ = Filter(EnumDestructablesInCircleBJFilter)
	filterGetUnitsInRectOfPlayer = Filter(GetUnitsInRectOfPlayerFilter)
	filterGetUnitsOfTypeIdAll = Filter(GetUnitsOfTypeIdAllFilter)
	filterGetUnitsOfPlayerAndTypeId = Filter(GetUnitsOfPlayerAndTypeIdFilter)
	filterMeleeTrainedUnitIsHeroBJ = Filter(MeleeTrainedUnitIsHeroBJFilter)
	filterLivingPlayerUnitsOfTypeId = Filter(LivingPlayerUnitsOfTypeIdFilter)
	index = 0
	while(true) do
		if (index == bj_MAX_PLAYER_SLOTS) then break end
		bj_FORCE_PLAYER[index] = CreateForce()
		ForceAddPlayer(bj_FORCE_PLAYER[index], Player(index))
		index = index + 1
	end
	bj_FORCE_ALL_PLAYERS = CreateForce()
	ForceEnumPlayers(bj_FORCE_ALL_PLAYERS, nil)
	bj_cineModePriorSpeed = GetGameSpeed()
	bj_cineModePriorFogSetting = IsFogEnabled()
	bj_cineModePriorMaskSetting = IsFogMaskEnabled()
	index = 0
	while(true) do
		if (index >= bj_MAX_QUEUED_TRIGGERS) then break end
		bj_queuedExecTriggers[index] = nil
		bj_queuedExecUseConds[index] = false
		index = index + 1
	end
	bj_isSinglePlayer = false
	userControlledPlayers = 0
	index = 0
	while(true) do
		if (index >= bj_MAX_PLAYERS) then break end
		if (GetPlayerController(Player(index)) == MAP_CONTROL_USER and GetPlayerSlotState(Player(index)) == PLAYER_SLOT_STATE_PLAYING) then
			userControlledPlayers = userControlledPlayers + 1
		end
		index = index + 1
	end
	bj_isSinglePlayer = (userControlledPlayers == 1)
	bj_rescueSound = CreateSoundFromLabel("Rescue", false, false, false, 10000, 10000)
	bj_questDiscoveredSound = CreateSoundFromLabel("QuestNew", false, false, false, 10000, 10000)
	bj_questUpdatedSound = CreateSoundFromLabel("QuestUpdate", false, false, false, 10000, 10000)
	bj_questCompletedSound = CreateSoundFromLabel("QuestCompleted", false, false, false, 10000, 10000)
	bj_questFailedSound = CreateSoundFromLabel("QuestFailed", false, false, false, 10000, 10000)
	bj_questHintSound = CreateSoundFromLabel("Hint", false, false, false, 10000, 10000)
	bj_questSecretSound = CreateSoundFromLabel("SecretFound", false, false, false, 10000, 10000)
	bj_questItemAcquiredSound = CreateSoundFromLabel("ItemReward", false, false, false, 10000, 10000)
	bj_questWarningSound = CreateSoundFromLabel("Warning", false, false, false, 10000, 10000)
	bj_victoryDialogSound = CreateSoundFromLabel("QuestCompleted", false, false, false, 10000, 10000)
	bj_defeatDialogSound = CreateSoundFromLabel("QuestFailed", false, false, false, 10000, 10000)
	DelayedSuspendDecayCreate()
	v = VersionGet()
	if (v == VERSION_REIGN_OF_CHAOS) then
		bj_MELEE_MAX_TWINKED_HEROES = bj_MELEE_MAX_TWINKED_HEROES_V0
	else
		bj_MELEE_MAX_TWINKED_HEROES = bj_MELEE_MAX_TWINKED_HEROES_V1
	end
end

function InitQueuedTriggers()
	bj_queuedExecTimeout = CreateTrigger()
	TriggerRegisterTimerExpireEvent(bj_queuedExecTimeout, bj_queuedExecTimeoutTimer)
	TriggerAddAction(bj_queuedExecTimeout, QueuedTriggerDoneBJ)
end

function InitMapRects()
	bj_mapInitialPlayableArea = Rect(GetCameraBoundMinX() - GetCameraMargin(CAMERA_MARGIN_LEFT), GetCameraBoundMinY() - GetCameraMargin(CAMERA_MARGIN_BOTTOM), GetCameraBoundMaxX() + GetCameraMargin(CAMERA_MARGIN_RIGHT), GetCameraBoundMaxY() + GetCameraMargin(CAMERA_MARGIN_TOP))
	bj_mapInitialCameraBounds = GetCurrentCameraBoundsMapRectBJ()
end

function InitSummonableCaps()
	local index ---@type number integer
	index = 0
	while(true) do
		if (not GetPlayerTechResearched(Player(index), FourCC('Rhrt'), true)) then
			SetPlayerTechMaxAllowed(Player(index), FourCC('hrtt'), 0)
		end
		if (not GetPlayerTechResearched(Player(index), FourCC('Robk'), true)) then
			SetPlayerTechMaxAllowed(Player(index), FourCC('otbk'), 0)
		end
		SetPlayerTechMaxAllowed(Player(index), FourCC('uske'), bj_MAX_SKELETONS)
		index = index + 1
		if (index == bj_MAX_PLAYERS) then break end
	end
end

---@param whichItem item
function UpdateStockAvailability(whichItem)
	local iType = GetItemType(whichItem) ---@type itemtype
	local iLevel = GetItemLevel(whichItem) ---@type number integer
	if (iType == ITEM_TYPE_PERMANENT) then
		bj_stockAllowedPermanent[iLevel] = true
	elseif (iType == ITEM_TYPE_PERMANENT) then
		bj_stockAllowedCharged[iLevel] = true
	elseif (iType == ITEM_TYPE_PERMANENT) then
		bj_stockAllowedArtifact[iLevel] = true
	else
	end
end

function UpdateEachStockBuildingEnum()
	local iteration = 0 ---@type number integer
	local pickedItemId ---@type number integer
	while(true) do
		pickedItemId = ChooseRandomItemEx(bj_stockPickedItemType, bj_stockPickedItemLevel)
		if (IsItemIdSellable(pickedItemId)) then break end
		iteration = iteration + 1
		if (iteration > bj_STOCK_MAX_ITERATIONS) then
			return
		end
	end
	AddItemToStock(GetEnumUnit(), pickedItemId, 1, 1)
end

---@param iType itemtype
---@param iLevel number integer
function UpdateEachStockBuilding(iType, iLevel)
	local g ---@type group
	bj_stockPickedItemType = iType
	bj_stockPickedItemLevel = iLevel
	g = CreateGroup()
	GroupEnumUnitsOfType(g, "marketplace", nil)
	ForGroup(g, UpdateEachStockBuildingEnum)
	DestroyGroup(g)
end

function PerformStockUpdates()
	local pickedItemId ---@type number integer
	local pickedItemType ---@type itemtype
	local pickedItemLevel = 0 ---@type number integer
	local allowedCombinations = 0 ---@type number integer
	local iLevel ---@type number integer
	iLevel = 1
	while(true) do
		if (bj_stockAllowedPermanent[iLevel]) then
			allowedCombinations = allowedCombinations + 1
			if (GetRandomInt(1, allowedCombinations) == 1) then
				pickedItemType = ITEM_TYPE_PERMANENT
				pickedItemLevel = iLevel
			end
		end
		if (bj_stockAllowedCharged[iLevel]) then
			allowedCombinations = allowedCombinations + 1
			if (GetRandomInt(1, allowedCombinations) == 1) then
				pickedItemType = ITEM_TYPE_CHARGED
				pickedItemLevel = iLevel
			end
		end
		if (bj_stockAllowedArtifact[iLevel]) then
			allowedCombinations = allowedCombinations + 1
			if (GetRandomInt(1, allowedCombinations) == 1) then
				pickedItemType = ITEM_TYPE_ARTIFACT
				pickedItemLevel = iLevel
			end
		end
		iLevel = iLevel + 1
		if (iLevel > bj_MAX_ITEM_LEVEL) then break end
	end
	if (allowedCombinations == 0) then
		return
	end
	UpdateEachStockBuilding(pickedItemType, pickedItemLevel)
end

function StartStockUpdates()
	PerformStockUpdates()
	TimerStart(bj_stockUpdateTimer, bj_STOCK_RESTOCK_INTERVAL, true, PerformStockUpdates)
end

function RemovePurchasedItem()
	RemoveItemFromStock(GetSellingUnit(), GetItemTypeId(GetSoldItem()))
end

function InitNeutralBuildings()
	local iLevel ---@type number integer
	iLevel = 0
	while(true) do
		bj_stockAllowedPermanent[iLevel] = false
		bj_stockAllowedCharged[iLevel] = false
		bj_stockAllowedArtifact[iLevel] = false
		iLevel = iLevel + 1
		if (iLevel > bj_MAX_ITEM_LEVEL) then break end
	end
	SetAllItemTypeSlots(bj_MAX_STOCK_ITEM_SLOTS)
	SetAllUnitTypeSlots(bj_MAX_STOCK_UNIT_SLOTS)
	bj_stockUpdateTimer = CreateTimer()
	TimerStart(bj_stockUpdateTimer, bj_STOCK_RESTOCK_INITIAL_DELAY, false, StartStockUpdates)
	bj_stockItemPurchased = CreateTrigger()
	TriggerRegisterPlayerUnitEvent(bj_stockItemPurchased, Player(PLAYER_NEUTRAL_PASSIVE), EVENT_PLAYER_UNIT_SELL_ITEM, nil)
	TriggerAddAction(bj_stockItemPurchased, RemovePurchasedItem)
end

function MarkGameStarted()
	bj_gameStarted = true
	DestroyTimer(bj_gameStartedTimer)
end

function DetectGameStarted()
	bj_gameStartedTimer = CreateTimer()
	TimerStart(bj_gameStartedTimer, bj_GAME_STARTED_THRESHOLD, false, MarkGameStarted)
end

function InitBlizzard()
	ConfigureNeutralVictim()
	InitBlizzardGlobals()
	InitQueuedTriggers()
	InitRescuableBehaviorBJ()
	InitDNCSounds()
	InitMapRects()
	InitSummonableCaps()
	InitNeutralBuildings()
	DetectGameStarted()
end

function RandomDistReset()
	bj_randDistCount = 0
end

---@param inID number integer
---@param inChance number integer
function RandomDistAddItem(inID, inChance)
	bj_randDistID[bj_randDistCount] = inID
	bj_randDistChance[bj_randDistCount] = inChance
	bj_randDistCount = bj_randDistCount + 1
end

---@return number integer
function RandomDistChoose()
	local sum = 0 ---@type number integer
	local chance = 0 ---@type number integer
	local index ---@type number integer
	local foundID = -1 ---@type number integer
	local done ---@type boolean
	if (bj_randDistCount == 0) then
		return -1
	end
	index = 0
	while(true) do
		sum = sum + bj_randDistChance[index]
		index = index + 1
		if (index == bj_randDistCount) then break end
	end
	chance = GetRandomInt(1, sum)
	index = 0
	sum = 0
	done = false
	while(true) do
		sum = sum + bj_randDistChance[index]
		if (chance <= sum) then
			foundID = bj_randDistID[index]
			done = true
		end
		index = index + 1
		if (index == bj_randDistCount) then
			done = true
		end
		if (done == true) then break end
	end
	return foundID
end

---@param inUnit unit
---@param inItemID number integer
---@return item
function UnitDropItem(inUnit, inItemID)
	local x ---@type number real
	local y ---@type number real
	local radius = 32 ---@type number real
	local unitX ---@type number real
	local unitY ---@type number real
	local droppedItem ---@type item
	if (inItemID == -1) then
		return nil
	end
	unitX = GetUnitX(inUnit)
	unitY = GetUnitY(inUnit)
	x = GetRandomReal(unitX - radius, unitX + radius)
	y = GetRandomReal(unitY - radius, unitY + radius)
	droppedItem = CreateItem(inItemID, x, y)
	SetItemDropID(droppedItem, GetUnitTypeId(inUnit))
	UpdateStockAvailability(droppedItem)
	return droppedItem
end

---@param inWidget widget
---@param inItemID number integer
---@return item
function WidgetDropItem(inWidget, inItemID)
	local x ---@type number real
	local y ---@type number real
	local radius = 32 ---@type number real
	local widgetX ---@type number real
	local widgetY ---@type number real
	if (inItemID == -1) then
		return nil
	end
	widgetX = GetWidgetX(inWidget)
	widgetY = GetWidgetY(inWidget)
	x = GetRandomReal(widgetX - radius, widgetX + radius)
	y = GetRandomReal(widgetY - radius, widgetY + radius)
	return CreateItem(inItemID, x, y)
end